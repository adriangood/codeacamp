define(["external/flash_detect","external/keymaster","external/modernizr","external/plupload_dev","external/purify","external/react","external/react-dom","external/underscore","jquery","libs","modules/clean/account/email","modules/clean/account/email_verify_reasons","modules/clean/ajax","modules/clean/analytics","modules/clean/avatar/stacked_avatars","modules/clean/base64","modules/clean/browse_interface","modules/clean/clipboard","modules/clean/contacts/cache_store","modules/clean/contacts/facebook_modal","modules/clean/contacts/facebook_oauth","modules/clean/contacts/list","modules/clean/contacts/types","modules/clean/css","modules/clean/datetime","modules/clean/dbmodal","modules/clean/deprecated/dbmodal_loading","modules/clean/deprecated/uirequest","modules/clean/display_format","modules/clean/downloads","modules/clean/em_string","modules/clean/event_load","modules/clean/events/rollback","modules/clean/file_events","modules/clean/filepath","modules/clean/flux/dispatcher","modules/clean/form","modules/clean/frame_messenger","modules/clean/groups/api","modules/clean/history","modules/clean/image_size","modules/clean/job_progress","modules/clean/legacy_pyxl_controllers/ajax_form","modules/clean/legacy_pyxl_controllers/bubble_picker","modules/clean/legacy_pyxl_controllers/role_picker","modules/clean/multiaccount_login","modules/clean/notserver","modules/clean/page_role_observer","modules/clean/payments/cash","modules/clean/payments/dfb_util","modules/clean/photos/legacy_thumb_loader","modules/clean/previews/pdf_loader","modules/clean/previews/util","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/clean/react/browse/constants","modules/clean/react/file_viewer/controller","modules/clean/react/modal","modules/clean/react/previews/image_helpers","modules/clean/react/previews/preview_linkfile","modules/clean/search/search_helpers","modules/clean/sharing/api","modules/clean/sharing/api/client","modules/clean/sharing/constants","modules/clean/sharing/content_info","modules/clean/sharing/share_modal_util","modules/clean/sharing/shared_content_link_sync_modal","modules/clean/sharing/shared_content_link_sync_utils","modules/clean/sharing/ui_util","modules/clean/sprite","modules/clean/sso_login_checks","modules/clean/static_urls","modules/clean/teams/modals/suggest_team_invite_modal","modules/clean/top_notif","modules/clean/undo","modules/clean/viewer","modules/clean/web_timing_logger","modules/constants/debug","modules/constants/env","modules/constants/file_viewer","modules/constants/legacy","modules/constants/page_load","modules/constants/python","modules/constants/request","modules/constants/static","modules/constants/teams","modules/constants/time","modules/core/browser","modules/core/controller_helpers","modules/core/cookies","modules/core/dom","modules/core/exception","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","require"],function(e,t,n,i,o,s,r,a,l,u,_,c,d,h,m,f,p,g,v,w,b,y,k,x,E,C,T,S,D,A,N,I,R,O,L,M,j,U,F,q,P,z,B,H,Y,W,V,K,G,J,X,Z,Q,ee,te,ne,ie,oe,se,re,ae,le,ue,_e,ce,de,he,me,fe,pe,ge,ve,we,be,ye,ke,xe,Ee,Ce,Te,Se,$e,De,Ae,Ne,Ie,Re,Oe,Le,Me,je,Ue,Fe,qe,Pe,ze,Be){var He,Ye={},We=_.EmailVerification,Ve=v.DefaultContactsCacheStore,Ke=v.LegacyContactsCacheStore,Ge=C.DBModal,Je=C.DBModalStack,Xe=(C.DBUserModal,P.image_best_fit_size,z.Job),Ze=z.ModalProgress,Qe=Y.RolePickerState,et=(V.NotServer,V.NotClients,G.CashUtil,J.DfBTransitionInfoFetcher,te.LinkedProfileServices),tt=te.ProfileServicesLinkingHandler,nt=(ne.FileTypes,ne.SharedWithActionTypes,oe.SimpleModal,re.PreviewLinkfile,le.SharingApi,ue.FolderShareApiClient,ce.ContentInfo,de.showShareModal),assert=(be.TopNotificationBar,Ue.SEVERITY,Ue.assert),reportStack=Ue.reportStack,reportException=Ue.reportException,it=qe.ungettext,ot=qe._;qe.N_,qe.E_,qe.render_sentences;INLINE_JS.$=$,INLINE_JS.$u=a,Function.prototype.defer=Function.prototype.defer.wrap(function(e){var t;return t=$A(arguments).slice(1),e.apply(this,t)}),String.prototype.evalScripts=String.prototype.evalScripts.wrap(function(e){var t,n;t=$A(arguments).slice(1);try{return e.apply(this,t)}catch(e){return n=e,assert(0,n.toString())}}),He={cache:{},set:function(e,t,n){var i;return i=He.cache[e],null==i&&(i=He.cache[e]={}),i.value=t,i.expires=n?(new Date).getTime()+n:0},get:function(e){var t;return t=He.cache[e],null==t||(new Date).getTime()>t.expires?(delete He.cache[e],!1):t.value}},Function.prototype.cached=function(e){var t,n;return monkey_check(),n=Math.random(),t=this,function(){var i;return i=He.get(n),i!==!1?i:(i=t(),He.set(n,i,e),i)}},Array.prototype.sort_by_key=function(e,t){var n;return null==t&&(t=!1),monkey_check(),n=t?-1:1,this.sort(function(t,i){return t=e(t),i=e(i),t<i?n*-1:t>i?1*n:0})},Array.prototype.contains=function(e){return monkey_check(),this.indexOf(e)!==-1},Array.prototype.remove=function(e,t){return monkey_check(),t=t||e+1,this.splice(e,t-e)},Array.prototype.removeItem=function(e){var t;return monkey_check(),t=this.indexOf(e),t>=0&&this.remove(t)},Array.prototype.dict_by=function(e){var t,n,i,o;for(monkey_check(),o={},t=n=0,i=this.length;n<i;t=++n)this[t],o[this[t][e]]=this[t];return o},Array.prototype.unique=function(){var e,t,n,i,o;for(monkey_check(),e={},n=0,i=this.length;n<i;n++){if(t=this[n],"string"!=typeof t)return this;e[t]=0}o=[];for(t in e)o.push(t);return o},String.prototype.widthSplit=function(e){var t,n,i,o;for(null==e&&(e=15),monkey_check(),t=[],n=this,o=0,i=n.substring(o,o+e);""!==i;)t.push(i),o+=e,i=n.substring(o,o+e);return t},Object.extend(Effect.Transitions,{EaseIn:function(e){return Math.pow(e,2)},EaseOut:function(e){return Math.pow(e,.5)}}),(function(e){var t;return t=function(e){var t,n,i,o,s,r,a,l,u;if(e)if(Object.isArray(e)){for(t=[],i=0,s=e.length;i<s;i++)n=e[i],t.push(Fe.escape(n).toHTML());e=new Fe(t.join(""))}else if(e.top||e.bottom||e.before||e.after)for(l=["top","bottom","before","after"],o=0,r=l.length;o<r;o++)a=l[o],u=e[a],u&&(e[a]=arguments.callee(u));else rt.isElm(e)||e.toElement||e.toHTML||(e=Fe.escape(e));return e},Element.addMethods({db_observe:function(e,t,n){return monkey_check(),e.observe(t,function(t){return n(t,e)})},smoothScrollIntoView:function(e,t){var n,i,o,s,r,a;if(null==t&&(t={}),monkey_check(),n={duration:.3,offset:0,padding:0,transition:Effect.Transitions.EaseOut},t=Object.extend(n,t),o=e.viewportOffset(e),i=e.getDimensions(),a=document.viewport.getDimensions(),r=t.padding||0,!(o.top>r&&o.top+i.height<a.height-r))return s=o.top<r?-1*Math.floor(a.height/4):-1*Math.floor(3*a.height/4),t.offset=t.offset||s,new Effect.ScrollTo(e,t)},__sert:function(e,n){return Element.insert(e,t(n))},__date:function(e,n){return Element.update(e,t(n))},replace:function(n,i){return e(n,t(i))}})})(Element.replace),String.prototype.lpad=function(e,t){var n;for(null==t&&(t="0"),monkey_check(),n=this;n.length<e;)n=t+n;return n.toString()},String.prototype.reverse=function(){var e,t;return monkey_check(),t=this.split(""),e=t.reverse(),e.join("")},String.prototype.count=function(e){return monkey_check(),(this.length-this.gsub(e,"").length)/e.length},String.prototype.repeat=function(e){return monkey_check(),new Array(e+1).join(this)},String.prototype.title=function(){return monkey_check(),this.charAt(0).toUpperCase()+this.substr(1)},Ajax.DBRequest=Class.create(Ajax.Request,{initialize:function($super,e,t){var n,i,o,s,r,a,u,_,c,d,h,m,f,p,g;if(null==t&&(t={}),monkey_check(),this.orig_req={url:e,options:t},this.start_time=E.time(),t.method=t.method||"post",t.evalJS=!1,t.suppress_nonstandard_headers=!0,t.parameters=t.parameters||{},t.parameters.t=Me.read("__Host-js_csrf"),t.parameters.is_xhr=!0,("post"===t.method.toLowerCase()||Ee.CPROFILE_ENABLED)&&(t.parameters.parent_request_id=Ae.REQUEST_ID),Ee.CPROFILE_ENABLED&&(t.parameters.cProfile=Ee.CPROFILE_PARAMETER),$e.PUBLIC_MODE_OVERRIDE&&(t.parameters.public_mode_override="1"),$e.COUNTRY_OVERRIDE&&(t.parameters.public_mode_override=$e.COUNTRY_OVERRIDE),Ajax.DBRequest.restrict&&(t.parameters.restrict=Ajax.DBRequest.restrict),i=t.cleanUp||function(){},this.subject_user=t.subject_user||t.job_user,t.job&&(this.job_id=rt.nonce(),t.parameters.job_id=this.job_id,sn.watch(this,t.dont_hide_progress_on_complete)),t.no_watch||lt.watch(this,!!t.job),d=t.onFailure,h=t.onSuccess,c=t.onComplete,_=(function(e){return function(n){var i;return!(t.parameters.xhr_retry||!t.allow_retries)&&((0===(i=n.status)||500===i||502===i||503===i)&&(e.orig_req.options.parameters.xhr_retry=!0,e.orig_req.options.onFailure=d,e.orig_req.options.onSuccess=h,new Ajax.DBRequest(e.orig_req.url,e.orig_req.options),!0))}})(this),t.onFailure=function(e){var n,o;if(!Xe.handled(e.request.job_id)&&!_(e))return t.noAutonotify||Pe.error(ot("There was a problem completing this request.")),i(!1),d&&d(e),403===e.status&&(o=rt.session_storage_get("reload-timestamp"),(!o||E.time()-o>3e4)&&(rt.session_storage_set("reload-timestamp",E.time()),location.reload(!0))),assert(t.noAutonotify||403===(n=e.status)||404===n||502===n,"Ajax "+e.status+" on "+e.request.url)},t.onComplete=(function(e){return function(e){if(e.responseText.length&&c&&0!==e.responseText.indexOf("async_task_started:"))return c(e)}})(this),t.onSuccess=(function(n){return function(o){var s,r,a,u,c,m,f,p,g,v,w,b,y,k,x,C,T;if(T=E.time()-o.request.start_time,!Xe.handled(o.request.job_id)){if(o.responseText.length){if(0===o.responseText.indexOf("err:"))t.noAutonotify||(p=o.responseText.substr(4),t.html_in_error_msg&&(p=new Fe(p)),Pe.error(p)),d&&d(o);else if(0===o.responseText.indexOf("async_task_started:")?(n.async_task_id=o.responseText.split(":")[1],sn.watch(n)):h&&(0===o.responseText.indexOf("ok:")&&Pe.success(o.responseText.substr(3)),h(o)),C=o.getHeader("X-Server-Response-Time")||"-1",t.log_timing&&xe.log_ajax_transition.defer(T,void 0,void 0,void 0,C,e=st.absolutize(n.url)),r=l("#cprofile"),!t.no_watch&&r.length){if(y=Ae.REQUEST_ID+"-"+o.getHeader("X-Dropbox-Request-Id"),e=o.request.url.replace(/[^\/]*\/\/[^\/]+/,"").replace(/\?.*$/,""),v={request_id:y},b=o.request.url,b.indexOf("dl-web.dropbox.com")!==-1)v.block=1;else for(w=Ce.BATCH_THUMB_ENDPOINTS,m=0,f=w.length;m<f;m++)if(c=w[m],b.indexOf(c)!==-1){v.block=1;break}s=function(e,t,n,i){var o;return o=l(i?'<a target="_blank" />':"<a />"),o.attr("href",String(ze({authority:"www.dropbox.com",path:t,query:n}))).text(e+" ")},g=[["svg","/profile/cprofile/svg",!0],["pstats","/profile/cprofile/pstats",!1],["callgrind","/profile/cprofile/callgrind",!1],["IO","/profile/ioprofile",!0],["DB","/profile/dbprofile",!0]],x=(function(){var e,t,n;for(n=[],e=0,t=g.length;e<t;e++)a=g[e],n.push(s(a[0],a[1],v,a[2]));return n})(),k=l('<div class="ajax">').text("Ajax: "+e+" ("+C+"ms)").prepend(x),u=r.find(".ajax"),u.length>=10&&u.last().remove(),r.prepend(k)}}else if(!t.job){if(_(o))return;p=ot("There was a problem completing this request."),t.noAutonotify||o&&0===o.status||Pe.error(p),d&&d(o)}return i(!0)}}})(this),t.onException=function(t,n){if(window.console)throw n;return"Error with AJAX callback for: "+e+" :::: "+n.toString(),reportException({err:n})},t.job&&(e+=(e.indexOf("?")===-1?"?":"&")+"long_running=1"),t.subject_user&&!(null!=(f=t.parameters)?f._subject_uid:void 0)&&(e=ze.parse(e).updateQuery("_subject_uid",t.subject_user).toString()),n=$H({url:e}),t.parameters){for(n.update(t.parameters),p=n.keys(),o=0,a=p.length;o<a;o++)for(r=p[o],g=["passwd","password","oauth","ccn","host_id"],s=0,u=g.length;s<u;s++)m=g[s],r.indexOf(m)!==-1&&n.unset(r);n.unset("t")}return t.onSuccess.__tb_ajax_info__=t.onFailure.__tb_ajax_info__=Object.toJSON(n),$super(e,t)}}),void 0!==t&&null!==t&&Object.extend(t,{main_modifier:function(){return monkey_check(),rt.is_mac()?decodeURIComponent("%E2%8C%98"):"ctrl"}});var st,rt;rt=INLINE_JS.Util=Ye.Util={scroll_to_thumb:function(e){var t,n,i,o;if(n=e.cumulativeOffset().top,t=e.getHeight(),o=je.scroll_offsets().top,i=je.viewport_dimensions().height,n<o||n+t>o+i)return je.scroll_to(0,n-i/2)},decode_sort_key:function(e){var t,n,i,o;for(o=[],n=0,i=e.length;n<i;n++)t=e[n],"string"==typeof t?o.push(f.decode(t)):o.push(t);return o},sort_by_rank_or_key:function(e,t){return null!=e.sort_rank&&null!=t.sort_rank?e.sort_rank-t.sort_rank:(assert(null!=e.sort_key&&null!=t.sort_key,"expected sort keys on both elms"),this._sort_by_key(e,t))},sort_by_key:function(e,t){return this._sort_by_key(e,t)},_sort_by_key:function(e,t){var n,i,o,s,r;for(s=e.sort_key,r=t.sort_key,n=i=0,o=s.length;0<=o?i<o:i>o;n=0<=o?++i:--i){if(null==r[n])return 1;if(typeof s[n]!=typeof r[n])return"string"==typeof s[n]?1:-1;if(s[n]!==r[n])return s[n]>r[n]?1:-1}return r.length>s.length?-1:0},add_sort_arrow_mouseover:function(e,t,n,i){var o,s,r,a,l;for(a=$$(n),l=[],o=0,s=a.length;o<s;o++)r=a[o],l.push((function(n){var i;if(e!==n)return pe.src(n.down("img"),"web","downtick-spacer"),n.removeClassName("bolded");if(n.addClassName("bolded"),!n.hasClassName("noarrow"))return i=t?"arrow-up-gray":"arrow-down-gray",pe.src(n.down("img"),"web",i)})(r));return l},add_sort_arrow_mouseover_j:function(e,t,n,i){var o,s,r,a,u;for(a=l(n),u=[],o=0,s=a.length;o<s;o++)r=a[o],u.push((function(n){var i;if(e.attr("data-sort")!==l(n).attr("data-sort"))return pe.src(l(n).find("img")[0],"web","downtick-spacer"),l(n).removeClass("bolded");if(l(n).addClass("bolded"),!l(n).hasClass("noarrow"))return i=t?"arrow-up-gray":"arrow-down-gray",pe.src(l(n).find("img")[0],"web",i)})(r));return u},one_line_fit:function(e){var t,n;if(t=$$(e),!(t.length<2))return(n=(function(e){return function(){var e,i,o,s,r,a,l,u,_;if(o=t[0],a=t[t.length-1],s=o.cumulativeOffset().top,l=a.cumulativeOffset().top,s!==l){if(e=parseInt(o.getStyle("font-size"),10),_=e-1,_<8)return;for(r=0,u=t.length;r<u;r++)i=t[r],i.style.fontSize=_+"px";return n()}}})(this))()},nice_list:function(e){var t,n,i,o,s;return e?1===e.length?e[0]:2===e.length?ot("%(x)s and %(y)s").format({x:e[0],y:e[1]}):(s=ot("%(x)s, %(y)s, and %(z)s").split(/%\(x\)s|%\(y\)s|%\(z\)s/),assert(4===s.length,"bad item list format %(x)s, %(y)s, and %(z)s"),n=s[0],i=s[1],o=s[2],t=s[3],[n,e.slice(0,-1).join(i),o,e[e.length-1],t].join("")):""},list_em_snippet:function(e,t){var n,i,o,s,r,a;for(s="",t-=new N("...").length,i=o=0,r=e.length;(0<=r?o<r:o>r)&&(a=e[i],0!==i&&(a=", "+a),n=new N(a).length,!(n>t));i=0<=r?++o:--o)t-=n,s+=a;return{str:s,snipped:e.length-i}},start_of_day:function(e){var t;return t=new Date,t.setTime(e.getTime()),t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t},to_iso8601_date:function(e,t,n){var i;return null==t&&(t=!1),null==n&&(n=!1),t?(i=e.getUTCFullYear().toString()+"-"+(e.getUTCMonth()+1).toString().lpad(2)+"-"+e.getUTCDate().toString().lpad(2),n&&(i+=" "+e.getUTCHours().toString().lpad(2)+":"+e.getUTCMinutes().toString().lpad(2)+":"+e.getUTCSeconds().toString().lpad(2))):(i=e.getFullYear().toString()+"-"+(e.getMonth()+1).toString().lpad(2)+"-"+e.getDate().toString().lpad(2),n&&(i+=" "+e.getHours().toString().lpad(2)+":"+e.getMinutes().toString().lpad(2)+":"+e.getSeconds().toString().lpad(2))),i},to_mysql_date:function(e,t,n){var i,o,s;return i=e.getFullYear().toString()+"-"+(e.getMonth()+1).toString().lpad(2)+"-"+e.getDate().toString().lpad(2),s=e.getHours().toString().lpad(2)+":"+e.getMinutes().toString().lpad(2)+":"+e.getSeconds().toString().lpad(2),o="."+e.getMilliseconds().toString().lpad(3),t?n?i+" "+s+o:i+" "+s:i},from_mysql_date:function(e){var t,n,i,o,s,r,a;return o=e.split(" "),t=o[0],r=o.length>1&&o[1],n=t.split("-"),assert(3===n.length,"weird date format on "+this+", expected yyyy-mm-dd"),i=new Date(n[0],parseInt(n[1],10)-1,n[2]),r&&(a=r.split(":"),assert(3===a.length,"weird time format on "+this+", expected hh:mm:ss.ms"),i.setHours(a[0]),i.setMinutes(a[1]),s=a[2].split("."),i.setSeconds(s[0]),s.length>1&&i.setMilliseconds(s[1])),i},make_table:function(e,t){var n,i,o,s,r,a,l;o=new Element("table",t),s=new Element("tbody"),o.__sert(s);for(i in e)l=e[i],a=new Element("tr"),r=new Element("td").insert(i),n=new Element("td").insert(l),a.__sert(r),a.__sert(n),s.__sert(a);return o},validate_email:function(e){var t;return t=new RegExp("^['&A-Z0-9._%+-]+@[A-Z0-9-][A-Z0-9.-]*\\.[A-Z]{2,15}$","i"),t.test(e)},scrollTop:function(){return window.scrollY||document.documentElement.scrollTop||0},scrollLeft:function(){return window.scrollX||document.documentElement.scrollLeft||0},scried:{},scry:function(e){var t,n;return n=this.scried,t=n[e],t||(t=$(e),n[e]=t),t},urlquote:function(e){return e.split("/").map(encodeURIComponent).join("/")},ie:Prototype.Browser.IE,log:function(){},childElement:function(e,t){var n;return n=this.childElementWithIndex(e,t),n[0]},childElementWithIndex:function(e,t){var n,i,o,s,r,a;for(n=0,a=e.childNodes,o=s=0,r=a.length;s<r;o=++s)if(i=a[o],1===i.nodeType&&n++===t)return[i,o];return[!1,!1]},disableSelection:function(e){return e.onselectstart=function(){return!1},e.unselectable="on",e.style.MozUserSelect="none",e.style.cursor="default"},enableSelection:function(e){return e.onselectstart=function(){return!0},e.unselectable="off",e.style.MozUserSelect="",e.style.cursor=""},disable_ie_image_dragging:function(){if(Prototype.Browser.IE&&Prototype.Browser.IEV<9)return document.ondragstart=function(){return!1}},bsearch:function(e,t,n,i){var o,s,r,a;for(n||(n=function(e,t){return e-t}),o=e.length,s=0;o>s;)if(r=Math.floor(o/2+s/2),a=n(e[r],t),a>0)o=r;else{if(!(a<0))return r;s=r+1}return i?s:-1},nonce:function(){var e,t,n;return e=new Date,n=e.getTime().toString(),t=Math.floor(1e6*Math.random()).toString().lpad(6),n+t},focus:function(e){if(e){e=$(e);try{return e.focus()}catch(e){}}},sumStyles:function(e,t){var n,i,o,s;if(i=0,e)for(o=0,s=t.length;o<s;o++)n=t[o],i+=parseInt(e.getStyle(n),10)||0;return i},smart_window_load:function(e){return"complete"===document.readyState?e.defer():Event.observe(window,"load",e)},isNumber:function(e){return!isNaN(Number(e,10))},shorten_url:function(e,t){return new Ajax.DBRequest("/shorten_url",{parameters:{url:e},onSuccess:function(e){return t(e.responseText)}})},falsy_to_empty:function(e){return e||""},preloaded_images:{},preload_image:function(e,t,n){var i;if(!this.preloaded_images[e])return i=new Image,null!=t&&Element.extend(i).observe("error",t),null!=n&&Element.extend(i).observe("load",n),i.src=e,this.preloaded_images[e]=i},get_preloaded_image:function(e){return this.preloaded_images[e]?this.preloaded_images[e].clone():new Element("img",{src:e})},clear_selected:function(){var e;if(window.getSelection){if(e=window.getSelection(),e.removeAllRanges)return e.removeAllRanges()}else if(document.selection)return document.selection.empty()},is_mac:function(){return navigator.appVersion.indexOf("Mac")!==-1},is_windows:function(){return navigator.appVersion.indexOf("Windows")!==-1},in_scrollbar:function(e){var t,n;return t=20,n=je.viewport_dimensions(),e>n.width-t},freshbutton_overlay:function(e,t){var n,i;return i=e instanceof l&&e||l(e),n=t instanceof l&&t||l(t),i.on("mouseover",(function(e){return function(){return n.addClass("hovered")}})(this)),i.on("mouseout",(function(e){return function(){return n.removeClass("hovered"),n.removeClass("pressed")}})(this)),i.on("mousedown",(function(e){return function(){return n.removeClass("hovered"),n.addClass("pressed")}})(this)),i.on("mouseup",(function(e){return function(){return n.removeClass("pressed")}})(this))},isElm:function(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&1===e.nodeType&&"string"==typeof e.nodeName},_track_twitter_chars_left:function(e,t){var n;return clearInterval(this.chars_left_interval),n=(function(n){return function(){var n,i;return n=$("twitter-chars"),i=t-$F(e).trim().length,i<0?n.addClassName("too-long"):n.removeClassName("too-long"),n.__date(i)}})(this),this.chars_left_interval=setInterval(n,250)},session_storage_set:function(e,t){if(window.sessionStorage&&window.JSON)return window.sessionStorage.setItem(e,JSON.stringify(t))},session_storage_get:function(e){if(window.sessionStorage&&window.JSON)return JSON.parse(window.sessionStorage.getItem(e))},pdf_plugins:function(){var e,t;return t=/Chrome PDF|Adobe Reader|Adobe PDF|Acrobat/gi,(function(){var n,i,o,s;for(o=window.navigator.plugins,s=[],n=0,i=o.length;n<i;n++)e=o[n],t.test(e.name)&&s.push(e);return s})()},get_window_location:function(){return window.location}},rt.scrollLeft=rt.scrollLeft.cached(50),rt.scrollTop=rt.scrollTop.cached(50),null==window.console&&(window.console={log:function(){},profile:function(){},profileEnd:function(){}}),st=Ye.URLUtil={absolutize:function(e){return e.startsWith("https://")||e.startsWith("http://")?e:"/"===e.charAt(0)?window.location.protocol+"//"+window.location.host+e:assert(0,"absolutize is confused by "+e)}},Ye.Velocity={scroll_container:null,velocity:0,last_nonzero_velocity:0,old_y:0,max_delta_y:0,calculate_velocity:function(){return this.velocity=this.max_delta_y,0!==this.velocity&&(this.last_nonzero_velocity=this.velocity),this.max_delta_y=0},capture_new_y_pos:function(){var e,t;return null==this.old_y?void(this.old_y=null!=this.scroll_container?this.scroll_container.scrollTop:je.scroll_offsets().top):null==this.max_delta_y?void(this.max_delta_y=0):(t=null!=this.scroll_container?this.scroll_container.scrollTop:je.scroll_offsets().top,e=Math.abs(this.max_delta_y)<Math.abs(t-this.old_y),e?(this.max_delta_y=t-this.old_y,this.old_y=t):void 0)},start_capture:function(e){return this.scroll_container=e,this.velocity_calculator_interval=setInterval(this.calculate_velocity.bind(this,500)),null!=this.scroll_container?this.scroll_container.observe("scroll",this.capture_new_y_pos.bind(this)):Event.observe(window,"scroll",this.capture_new_y_pos.bind(this))},get:function(e){return null==e&&(e=!1),assert(null!=this.velocity_calculator_interval,"Haven't started capturing velocity"),e?this.last_nonzero_velocity:this.velocity}};var at;at=Ye.DomUtil={fromElm:function(e){return $(e).innerHTML},updateFromElm:function(e,t){return e=$(e),t=$(t),e.update(this.fromElm(t))},fillVal:function(e,t){var n,i,o,s,r,a;for(o=$$("."+t),r=[],n=0,i=o.length;n<i;n++)a=o[n],a=$(a),"INPUT"===a.tagName?(a.value=e,r.push(a.defaultValue=e)):(""!==a.innerHTML||"A"!==(s=a.tagName)&&"B"!==s&&"INPUT"!==s&&"I"!==s&&"LABEL"!==s&&"SELECT"!==s&&"SPAN"!==s&&"TEXTAREA"!==s||rt.log("Filling an empty value; this may look broken in IE7",a),r.push(a.innerHTML=e));return r}};var lt;lt=Ye.RequestWatcher={reqs:[],working_msg:ot("Still working...",{comment:"Comment about waiting for a process to complete"}),last_notification:null,TIMEOUT:10,watch:function(e,t){var n;return n=this.reqs,n.length||(this.int_id=setInterval(this.check_up.bind(this),500)),t&&(e.skip_message=!0),n.push([e,E.time()])},check_up:function(){return this.scan(!1)},remove:function(e){return this.scan(e)},scan:function(e){var t,n,i,o,s,r,a,l,u;for(o=E.time(),s=[],a=this.reqs,n=0,i=a.length;n<i;n++)r=a[n],l=r[0],u=r[1],t=o-u,4!==l.transport.readyState?(t>4e3&&!l.skip_message&&(l.skip_message=!0,Pe.isShown()&&Pe.current()===!ye.undo_notification&&(this.last_notification=Pe.success(this.working_msg))),t>1e3*this.TIMEOUT&&l.job&&l.transport.abort(),l!==e?s.push([l,u]):l.transport.abort()):this.clearWorkingMessage();if(this.reqs=s,!s.length)return clearInterval(this.int_id)},clearWorkingMessage:function(){if(Pe.isShown()&&Pe.current()===this.last_notification)return Pe.clear()}},l(function(){var e,t,n,i;n=Prototype.Browser,i=[];for(e in n)t=n[e],t===!0&&i.push(l(document.body).addClass(e.toLowerCase()));return i});var ut=[].slice;l((function(e){return function(){return q.init()}})(this)),Ye.HashRouter={watch_timer:null,callback_map:{},last_hash:"",last_prefix:"",_get_location:function(){return window.location.href},_set_location:function(e){return window.location.href=e},_replace_location:function(e){return window.location.replace(e)},init:function(){return this.watch_timer=setInterval(this.check_hash.bind(this),300)},watch:function(e,t){if(this.callback_map[e]=t,!this.watch_timer)return this.init()},check_hash:function(){var e,t,n,i,o,s;if(i=this._get_location().split("#")[1],null!=i&&(i=i.replace(/%27/g,"'")),this.last_hash!==i){if(this.last_hash=i,this.last_prefix&&""===i)i=this.last_prefix+":";else if(!i)return;return s=i.split(":"),o=s.first(),this.last_prefix=o,n=this.callback_map[o],null!=n&&(t=(function(){var t,n,i,o;for(i=s.slice(1),o=[],t=0,n=i.length;t<n;t++)e=i[t],o.push(decodeURIComponent(e));return o})(),n.apply(null,t)),$(document).fire("db:hash_change",{hash:i})}},_prepare_hash:function(e){var t,n;return n=$A(e).map(rt.falsy_to_empty),t=n.map(encodeURIComponent),t.join(":")},set_hash:function(){var e,t;return e=1<=arguments.length?ut.call(arguments,0):[],t=this._prepare_hash(e),this._set_hash(t)},replace_hash:function(){var e,t;return e=1<=arguments.length?ut.call(arguments,0):[],t=this._prepare_hash(e),this._set_hash(t,!0)},_set_hash:function(e,t){return""===e&&(e="/"),this.last_hash=e,t?this._replace_location("#"+e):this._set_location("#"+e)}};var _t;_t=Ye.SharingUtil=(function(){function e(){}return e.success_string_for_recipients=function(e){return 1===e.length?e[0].indexOf("@")===-1?ot("Sent to %(recipient)s.",{comment:"Recipient is a user's name"}).format({recipient:e[0]}):ot("Sent to %(recipient)s.",{comment:"Recipient is an email address"}).format({recipient:e[0]}):2===e.length?e[0].indexOf("@")===-1?e[1].indexOf("@")===-1?ot("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"Recipients are users' names."}).format({recipient_first:e[0],recipient_second:e[1]}):ot("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"First recipient is a user's name, second is an email address"}).format({recipient_first:e[0],recipient_second:e[1]}):e[1].indexOf("@")===-1?ot("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"First recipient is an email address, second is a user's name"}).format({recipient_first:e[0],recipient_second:e[1]}):ot("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"Recipients are email addresses"}).format({recipient_first:e[0],recipient_second:e[1]}):(e[0].indexOf("@"),ot("Sent to %(recipient)s and %(num_others)s others.",{comment:"num_others is 2 or more"}).format({recipient:e[0],num_others:e.length-1}))},e.truncate_emails=function(e){var t;return e.length<=1500?e:(t=e.lastIndexOf(",",1500),t===-1?"":e.slice(0,t))},e})();var ct;Autocompleter.Contacts=Class.create(Autocompleter.Base,{initialize:function(e,t,n,i){var o,s,r,a,u;return this.user=e,h.LegacySharingVortexLogger.log("initialize-autocompleter-contacts"),this.baseInitialize(t,n,i),this.options.array=!1,this.options.larray=!1,this.options.frequency=.1,this._num_contacts_shown=0,this._num_query_results=0,s=this.options.include_fb===!0,null==this.options.include_team&&(this.options.include_team=!0),u=this.options.include_team===!0,a=this.options.include_new_style_groups===!0,r=this.options.include_me===!0,this.profile_services=et.get_linked_profile_services_for_user(this.user.id,this.update_import_contacts_link),this.link_handler=new tt,this._autocompleter_profile_services_item_tmpl=Fe.tmpl("autocompleter_item_tmpl"),this.listen(),this.possible_email_pattern=/[.@_-]/,o=(function(e){return function(t){return t=e.options.include_from_linked_accounts&&e.options.viewer?t.includeForViewer(e.options.viewer):t.includeForUser(e.user.id),e.options.contact_filter?t=e.options.contact_filter(t):(s||(t=t.excludeFacebook()),a||(t=t.excludeNewStyleGroups()),u||(t=t.excludeTeamMembers()),r||(t=t.excludeMe())),e.setContacts(t)}})(this),function(){var e;return e=Ke.getOrCreateForViewer(),e.load_contacts(!1,function(t){return o(t),e.register_for_updates("autocompleter_contacts",o)})}.defer(),this.options.onShow=function(e,t){return t.style.position&&"absolute"!==t.style.position||(t.style.position="absolute",je.clone_position(l(t),l(e),{setHeight:!1,setTop:!1,setLeft:!1})),l(t).fadeTo(150,1)}},link_callback:function(e){return tt.show_import_notifications(e)},getToken:function(){var e;return e=this.getTokenBounds(),this.element.value.substring(e[0],e[1])},listen:function(){var e;return this.install_profile_services_link_listener(),e=(function(e){return function(t){if(!e.profile_services.has_connected_services()&&!l(e.element).val())return e.activate(),setTimeout(function(){var t;return null!=(t=e.get_entry_container())?t.show():void 0},300),!0}})(this),l(this.element).click(e)},install_profile_services_link_listener:function(){var e;return Event.stopObserving(this.element,"blur"),e=(function(e){return function(t){var n;if(!l(t.target).closest("li").hasClass("profile-services-link-handler"))return null!=(n=e.get_entry_container())?n.hide():void 0}})(this),l(this.element).closest(".db-modal-box").click(e),l(this.element).closest("#modal-box").click(e)},get_entry_container:function(){var e;return null!=(e=this.element.up(".tokenized_autocompleter_container"))?e.down(".autocomplete"):void 0},profile_services_show:function(){var e,t,n,i;return e=this.get_entry_container(),(null!=(t=e.firstChild)&&null!=(n=t.firstChild)?n.value:void 0)>0?this.old_display=e.style.display:(this.old_contents="<ul></ul>",this.old_display="none"),this.profile_services_render_buttons(),null!=(i=$("flash_copy_container"))&&i.hide(),this.element.focus()},profile_services_render_buttons:function(){var e;return e=this.get_profile_services_button_list(),this.hasFocus=!0,this.updateChoices("<ul>"+e.join("")+"</ul>")},get_profile_services_button_list:function(){var e,t,n,i,o,s;for(s=[],o=ee.importable_contact_services(),t=0,n=o.length;t<n;t++)i=o[t],assert(this.profile_services.is_updated,"profile_services has not been updated"),e="",this.profile_services.service_is_connected(i)?e=ot("Connected"):this.profile_services.service_was_connected(i)&&(e=ot("Reconnect")),s.push(this._autocompleter_profile_services_item_tmpl({email_provider_num:i,email_provider_img:ee.to_img(i)[0],email_provider_name:ee.to_name(i),bottom_text:e}).toHTML());return s},update_import_contacts_link:(function(e){return function(t){return e.profile_services=t,e.profile_services.has_unconnected_services(!0)?l(e.element).closest("form").find(".import-contacts-link").show():l(e.element).closest("form").find(".import-contacts-link").hide()}})(this),hide_containing_modal:function(){return this.$hidden_modals=l(".db-modal-wrapper:visible").first(),this.$hidden_modals.length?this.$hidden_modals.css("display","none"):(this.$hidden_modals=l("#modal:visible, #modal-overlay:visible"),this.$hidden_modals.hide())},show_containing_modal:function(){return this.$hidden_modals.show(),this.$hidden_modals=null},setContacts:function(e){if(this.options.array=e.contacts,this.options.larray=e.lcontacts,this.active||this.getToken())return this.getUpdatedChoices()},loadContacts:function(){var e;return e=(function(e){return function(t){var n,i,o,s;return n=e.options.include_fb===!0,null==e.options.include_team&&(e.options.include_team=!0),s=e.options.include_team===!0,o=e.options.include_new_style_groups===!0,i=e.options.include_me===!0,t=e.options.include_from_linked_accounts&&e.options.viewer?t.includeForViewer(e.options.viewer):t.includeForUser(e.user.id),e.options.contact_filter?t=e.options.contact_filter(t):(n||(t=t.excludeFacebook()),o||(t=t.excludeNewStyleGroups()),s||(t=t.excludeTeamMembers()),i||(t=t.excludeMe())),e.setContacts(t)}})(this),function(){var t;return t=Ve.getOrCreateForViewer(),t.load_contacts(!1,function(n){return e(n),t.register_for_updates("autocompleter_contacts",e)})}.defer()},getUpdatedChoices:function(){return this.updateChoices(this.options.selector())},selectEntry:function(){var e,t,n;return t=this.getCurrentEntry(),e=this.options.array[t.value],e.type===k.FB||e.type===k.NEW_STYLE_GROUP?t.innerHTML=e.name:t.innerHTML=e.email,n=this.options.tokens.length>1?this.options.tokens[0]+" ":"",t.innerHTML+=n,this.active=!1,this.updateElement(t),l(this.element).trigger("db:autocompleted")}},ct=function(e,t){var n;return n=l("<div>"),n.addClass(e),"string"==typeof t||t instanceof String?n.text(t):n.append(t),n},{
getNumContactsShown:function(){return this._num_contacts_shown},getNumQueryResults:function(){return this._num_query_results},getContactInfoFromEmail:function(e){var t,n,i,o;for(o=this.options.array,n=0,i=o.length;n<i;n++)if(t=o[n],t.email===e)return{display_name:t.name,email:e,avatar_url:t.photo_url};return{display_name:"",email:e,avatar_url:null}},setOptions:function(e){var t;return null==e&&(e={}),t={choices:5,selector:(function(e){return function(){var t,n,i,o,s,r,a,u,_,c,d,h,m,f,p,g,v,w,b,y,x,E,C,T,S,$,D,A,I,R,O,L,M,j,U,F,q,P,z,B,H,Y,W,V,K,G;for(H=[],d=e.getToken().toLowerCase(),E=e.options.array.length,s=e.options.array,R=e.options.larray,B=[],d.indexOf(" ")===-1&&B.push("\\s+"),d.indexOf("+")===-1&&B.push("\\+"),d.indexOf("@")===-1&&B.push("@"),d.indexOf(".")===-1&&B.push("\\."),d.indexOf("&lt;")===-1&&B.push("&lt;"),z=RegExp("("+B.join("|")+")"),v=0;d.length>0&&v<E;){switch(o=s[v],I=R[v],h=-1,c=[],L=[],g="",o.name=o.name?N.em_snippet(o.name,22):"",o.email_snippet=o.email?N.em_snippet(o.email,22):"",o.type){case k.EMAIL:c.push(o.name,o.email_snippet),L.push(I.name,I.email),g="/static/images/icons/mail28-vflHfHPJ0.png";break;case k.FB:c.push(o.name),L.push(I.name),g="https://graph.facebook.com/"+I.fb_id+"/picture";break;case k.NEW_STYLE_GROUP:c.push(o.name,o.members),L.push(I.name,""),g="",null!=__CIRCULAR_DEPENDENCY__.GroupsListController&&(n=__CIRCULAR_DEPENDENCY__.GroupsListController.string_to_color(o.name),i=__CIRCULAR_DEPENDENCY__.GroupsListController.get_initials(o.name),m=l("<span class='group-icon'>").css("border-color",n).css("color",n).text(i));break;default:assert(!1,"should never get here due to type: "+o.type+", "+o.name+", "+o.email+", "+o)}for(y=f=0,S=L.length;f<S;y=++f){for(O=L[y],U=B.length?O.split(z):[O],a=0,b=0,$=U.length;b<$;b++)if(j=U[b]){if(0===j.indexOf(d)){h=a;break}a+=j.length}if(h!==-1){P=(d.length/j.length*9.4).toFixed(0),null!=o.sort_key&&(P+=o.sort_key),C=document.createTextNode(c[y].substr(0,h)),M=l("<strong>").text(c[y].substr(h,d.length)),W=document.createTextNode(c[y].substr(h+d.length)),c[y]=[C,M,W];break}}o.type===k.FB&&c.push(ot("Facebook message")),h!==-1&&(g?p=l('<img width="28px" height="28px">').attr({src:g,alt:""}):m&&(p=m),F=ct("autocomplete-line",c[0]),G=ct("autocomplete-line autocomplete-secondary",c[1]),T=ct("autocomplete-left",p),V=ct(null,[F,G]),A=l("<li>").attr("value",v).append(T,V),H.push([P,A])),v++}for(H.sort(function(e,t){return e[0]<t[0]?1:e[0]>t[0]?-1:0}),e._num_query_results=H.length,H=H.slice(0,e.options.choices),Y=l("<ul>"),x=0,D=H.length;x<D;x++)K=H[x],Y.append(K[1]);return e._num_contacts_shown=H.length,l(e.element).hasClass("no-profile-services-link-handler")||e.profile_services.has_unconnected_services(!0)&&(r=l(e.element).closest(".tokenized_autocompleter_container"),q=r.attr("data-provider"),w=ot(q===ee.GOOGLE?"Select from your Gmail contacts":q===ee.YAHOO?"Select from your Yahoo contacts":"Select from your contacts"),u=!1,q!==ee.GOOGLE&&q!==ee.YAHOO||e.profile_services.service_is_connected(q)?e.profile_services.has_connected_services()&&(u=!1,w=ot("Import Contacts")):u=!0,u?(_=e._autocompleter_profile_services_item_tmpl({email_provider_num:q,email_provider_img:ee.to_img(q)[0],email_provider_name:w,bottom_text:""}).toHTML(),Y.append(_)):(p=pe.make("web","user_add"),F=ct("autocomplete-line autocomplete-line-center",w),T=ct("autocomplete-left",p),V=ct(null,[F]),A=l("<li>").addClass("profile-services-link-handler").append(T,V),Y.append(A))),t=Y.wrap("<span>").parent().html(),e.old_contents=t,t}})(this)},this.options=Object.extend(t,e)}});var dt;dt=Ye.Token=Class.create({initialize:function(e,t,n,i){return this.element=$(e),this.token_manager=n,this.hidden_input=t,this.element.token=this,this.selected=!1,this.info=i,l(this.element).closest(".tokenized_autocompleter_container").click(this.onclick.bindAsEventListener(this))},select:function(){var e;return this.token_manager.token=this,null!=(e=this.hidden_input)&&e.element.activate(),this.selected=!0,this.element.addClassName("token_selected")},deselect:function(){return this.token_manager.token===this&&(this.token_manager.token=null),this.selected=!1,this.element.removeClassName("token_selected")},onclick:function(e){return e&&e.preventDefault&&e.preventDefault(),this.detect(e)&&!this.selected?this.select():this.deselect()},remove:function(e){return this.token_manager.remove(this)},detect:function(e){var t,n,i;for(n=e.target?e.target:e.srcElement,i=n.token,t=n;null==i&&t.parentNode;)t=t.parentNode,i=t.token;return null!=i&&i.element===this.element}});var ht;ht=Ye.TokenManager=Class.create({initialize:function(e,t,n,i){return this.contact_search_logger=i,this.shift_boundary_right_func=t,this.shift_boundary_left_func=n,this.element=e,this.tokens=[],this.token=null},add:function(e){return this.tokens.push(e),this.element.fire("token:add",e.info)},populate:function(){var e,t,n,i,o,s,r;for(r=this.element.select(".token"),i=[],t=0,n=r.length;t<n;t++)s=r[t],e=s.hasClassName("token-warn"),o=new dt(s,null,this,{external:e}),i.push(this.add(o));return i},remove:function(e){var t;if(null==e&&(e=this.token),null!=e)return this.contact_search_logger.flag_record_as_removed(e.info.value),t=this.tokens.indexOf(e),this.tokens.splice(t,1),e.element.remove(),this.token===e&&t<this.tokens.length?this.tokens[t].select():(this.token=null,null!=this.shift_boundary_right_func&&this.shift_boundary_right_func()),this.element.fire("token:remove",e.info)},removeAll:function(){var e,t,n,i,o;for(o=this.tokens.slice(0),this.tokens.clear(),n=[],e=0,t=o.length;e<t;e++)i=o[e],i.element.remove(),n.push(this.element.fire("token:remove",i.info));return n},shift_left:function(){var e;return e=this.token?this.tokens.indexOf(this.token):this.tokens.length,e>0?(this.token&&this.token.deselect(),this.tokens[e-1].select()):null!=this.shift_boundary_left_func?this.shift_boundary_left_func():void 0},shift_right:function(){var e;return e=this.tokens.indexOf(this.token),this.token&&this.token.deselect(),e+1<this.tokens.length?this.tokens[e+1].select():null!=this.shift_boundary_right_func?this.shift_boundary_right_func():void 0}});var mt;mt=Ye.HiddenInput=Class.create({initialize:function(e,t,n){return this.element=$(e),this.auto_complete_element=t,this.token_manager=n,Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},onKeyPress:function(e){switch(e.keyCode){case Event.KEY_LEFT:e.preventDefault(),this.token_manager.shift_left();break;case Event.KEY_TAB:e.preventDefault(),this.token_manager.shift_right();break;case Event.KEY_RIGHT:e.preventDefault(),this.token_manager.shift_right();break;case Event.KEY_BACKSPACE:case Event.KEY_DELETE:this.token_manager.remove()}return!1}});var ft=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Autocompleter.ContactsTokenizer=Class.create(Autocompleter.Contacts,{initialize:function($super,e,t,n,i,o){var s;return this.user=e,$super(this.user,t,n,o),this.contact_search_logger=new h.ContactSearchLogger,this.token_manager=new ht(this.element,this.generate_shift_boundary_right_func(),null,this.contact_search_logger),this.hidden_input=new mt(i,this.element,this.token_manager),this.textbox_height=0,this.element.hacks||(this.element.should_use_borderless_hack=Prototype.Browser.WebKit,this.element.should_use_shadow_hack=Prototype.Browser.IE||Prototype.Browser.Opera,this.element.hacks=!0),(this.element.should_use_borderless_hack||this.element.should_use_shadow_hack)&&l(this.element).parent().addClass("tokenizer_input_borderless"),this.options.onShow=function(e,t){return je.clone_position(l(t),l(e.parentNode.parentNode),{setHeight:!1,setTop:!1,setLeft:!1}),t.show()},this.options.onHide=function(e,t){return t.hide()},this.max_textbox_height=270,null!=o.max_textbox_height&&(this.max_textbox_height=o.max_textbox_height),this.members=[],null!=o.members&&(this.members=o.members),this.invitees=[],null!=o.invitees&&(this.invitees=o.invitees),this.new_style_groups=[],null!=o.new_style_groups&&(this.new_style_groups=o.new_style_groups),this.contacts_only=!1,null!=o.contacts_only&&(this.contacts_only=o.contacts_only),s=q.get_url().indexOf("/referrals")!==-1?l("#retrieve-contacts-button"):l(this.element).closest("form").find(".tokenizer-submit-button")[0],l(s).on("mousedown",this.beforeSubmit.bindAsEventListener(this)),l(this.element).on("focus",this.onFocus.bindAsEventListener(this)),this.import_links=[],o.hide_import_contacts||(this.import_links=l(".import-contacts-link")),this.calculate_input_size(),this.dynamically_resize_input(),this.check_populated(),setInterval(this.check_populated.bind(this),100)},onClick:function(e){var t,n;if(t=e.findElement("li"),this.index=t.autocompleteIndex,n=this.selectEntry(),!n)return this.hide()},onBlur:function($super,e){return $(this.element.parentNode).removeClassName("focused"),this.element.up(".tokenizer").removeClassName("focused"),$super(e)},onFocus:function(e){return $(this.element.parentNode).addClassName("focused"),this.element.up(".tokenizer").addClassName("focused")},beforeSubmit:function(e){return this.tokenize_emails_input(!0)},clearTokens:function(e){return this.token_manager.removeAll(),this.calculate_input_size(),this.dynamically_resize_input()},getTokenCount:function(){return this.token_manager.tokens.length},getEmails:function(){var e,t;return e=l(this.element).closest(".tokenized_autocompleter_container").find(".token-valid").find('[name="emails"]'),(function(){var n,i,o;for(o=[],n=0,i=e.length;n<i;n++)t=e[n],o.push(l(t).val());return o})().join(", ")},check_populated:function(){var e,t;return e=$(this.element.parentNode),t=""===this.element.value&&0===this.token_manager.tokens.length,e.hasClassName("populated")&&t?e.removeClassName("populated"):e.hasClassName("populated")||t?void 0:e.addClassName("populated")},clean_email_addr:function(e,t){var n,i,o;for(i=0,o=e.length;i<o;i++)n=e[i],t=t.sub(n,"");return t.trim()},get_regexp_from_delimiters:function(e){var t,n,i,o;for(n="",i=0,o=e.length;i<o;i++)t=e[i],n+=t+"|";return new RegExp("["+n+"\\r\\n|\\r|\\n|\\t]+")},createTokenInfo:function(e,t,n){var i,o;return o=!0,i=t,n===k.FB&&(i=e),n!==k.EMAIL||rt.validate_email(t)?ft.call(this.members,t)>=0?(o=!1,i=ot("Already member")):ft.call(this.invitees,t)>=0?(o=!1,i=ot("Already invited")):n===k.NEW_STYLE_GROUP&&(ft.call(this.new_style_groups,t)>=0?(o=!1,i=ot("Already member group")):(o=!0,i=ot("Group"))):o=!1,t!==this.user.email&&t!==this.user.id||(i=ot("You"),o=!this.contacts_only),!e&&t&&(e=t.toString()),{display:e,value:t,type:n,valid:o,bubble_title:i}},COMPOUND_EMAIL_REGEX:/([^<>]+)<([^@>]+@[^@>]+)>/,parse_compound_email:function(e){var t;return t=e.match(this.COMPOUND_EMAIL_REGEX),t?this.createTokenInfo(t[0],t[2],k.EMAIL):null},tokenize_emails_input:function(e,t){var n,i,o,s,r,a,l,u,_,c,d,h,m,f,p,g,v,w,b;if(i=this.options.tokens,g=this.get_regexp_from_delimiters(i),s=this.options.single_token?[this.element.value]:this.element.value.split(g),w="",e||(w=s[s.length-1],p=this.clean_email_addr(i,w),s=s.slice(0,s.length-1)," "!==(f=w[w.length-1])&&">"!==f||(p.match(this.COMPOUND_EMAIL_REGEX)||rt.validate_email(p))&&(s.push(p),w="")),n=!1,b=[],s.length>0)for(a=0,_=s.length;a<_;a++)o=s[a],v=this.parse_compound_email(o),(null!=v?v.valid:void 0)?(n=!0,this.set_input_size(1),this.addContact(v)&&(h={sort_variant:null,context:"legacy_tokenizer",contact_type:k.EMAIL,contact_id:v.value,contact_name:v.display,did_select_suggestion:!1},this.contact_search_logger.add_record(h))):b.push(o);if(s=b,!this.options.single_token){for(m=[],l=0,c=s.length;l<c;l++)o=s[l],m.push.apply(m,o.split(" "));s=m}if(s.length>0)for(u=0,d=s.length;u<d;u++)if(o=s[u],o=this.clean_email_addr(i,o)){if(v=this.createTokenInfo(o,o,k.EMAIL),v.valid)n=!0;else if(t)continue;this.set_input_size(1),this.addContact(v)&&(h={sort_variant:null,context:"legacy_tokenizer",contact_type:k.EMAIL,contact_id:o,did_select_suggestion:!1},this.contact_search_logger.add_record(h))}return this.element.value!==w&&(this.element.value=w),r=this.element.up("form"),n&&kt.clear_errors(r),this.dynamically_resize_input()},generate_shift_boundary_right_func:function(){var e;return e=this.element,function(){return e.focus()}},set_input_size:function(e){return(null==e||e<0)&&(e=20),this.element.setStyle({width:e+"px"})},calculate_input_size:function(){if(this.import_links.length)return this.import_links_width=this.import_links.width(),this.import_links_visible=this.import_links.is(":visible")},dynamically_resize_input:function(){var e,t,n,i,o,s,r,a,u,_,c,d,h,m,f,p,g,v,w,b;for(f=$(this.element.parentNode.parentNode),g=parseInt(f.getStyle("width"),10)-15,p=parseInt(f.getStyle("height"),10),p!==this.textbox_height&&(this.textbox_height=p,p>=this.max_textbox_height?f.setStyle({"overflow-y":"auto"}):f.setStyle({"overflow-y":"hidden"})),r=g,e=l(".tokenizer-link",f.parentNode),e.length>0&&(r-=e.width()),w=this.token_manager.tokens,_=!1,b=0,o=0,a=w.length;o<a;o++)v=w[o],i=v.element,n=parseInt(i.getStyle("width"),10)+parseInt(i.getStyle("margin-right"),10),d=b+n,d>g?(b=n,_=!0):n>g?(b=0,_=!0):b=d;if(c=r-b,t=7*this.element.value.length,t>c&&(c=g),this.set_input_size(c),this.import_links.length&&this.import_links_visible&&(_||g-b-t<1.25*this.import_links_width)){for(this.import_links_visible=!1,h=this.import_links,m=[],s=0,u=h.length;s<u;s++)i=h[s],m.push(l(i).fadeOut(100));return m}},onKeyPress:function(e){var t,n;if(this.dynamically_resize_input(),this.active)switch(e.keyCode){case 44:case 188:case 59:case 186:return e.shiftKey||(this.has_selected_profile_services_entry()||this.has_selected_profile_services())&&this.tokenize_emails_input(!0),void this.reset_observer();case Event.KEY_TAB:case Event.KEY_RETURN:return this.has_selected_profile_services_entry()||this.has_selected_profile_services()?(this.tokenize_emails_input(!0),this.hide(),void Event.stop(e)):(this.selectEntry(),this.hide(),this.active=!1,void Event.stop(e));case Event.KEY_ESC:return this.hide(),this.active=!1,void Event.stop(e);case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:return this.markPrevious(),this.render(),void Event.stop(e);case Event.KEY_DOWN:return this.markNext(),this.render(),void Event.stop(e)}else{if(this.tokenize_emails_input(!1),e.keyCode===Event.KEY_TAB||e.keyCode===Event.KEY_RETURN)return this.element.value&&e.preventDefault&&e.preventDefault(),void this.tokenize_emails_input(!0);if(""===this.element.value)(t=e.keyCode)!==Event.KEY_LEFT&&t!==Event.KEY_BACKSPACE||this.token_manager.shift_left();else if((n=e.keyCode)===Event.KEY_LEFT||n===Event.KEY_RIGHT||n===Event.KEY_UP||n===Event.KEY_DOWN)return}return this.update_typeahead(),this.reset_observer()},update_typeahead:function(){return this.changed=!0,this.hasFocus=!0},reset_observer:function(){return this.observer&&clearTimeout(this.observer),this.observer=setTimeout(this.onObserverEvent.bind(this),1e3*this.options.frequency)},onObserverEvent:function($super){var e,t,n,i,o,s;if(this.active){for(s=this.element.value,o=this.options.tokens,n=0,i=o.length;n<i;n++)if(e=o[n],t=s.indexOf(e),t!==-1){if(this.has_selected_profile_services_entry())return this.tokenize_emails_input(!0),void this.hide();this.element.value=s.substr(0,t),this.selectEntry(),this.hide(),this.active=!1,this.element.value=s.substr(t+1);break}this.update_typeahead()}return this.tokenize_emails_input(!1),$super()},has_selected_profile_services:function(e){return null==e&&(e=this.getCurrentEntry()),l(e).hasClass("profile-services-link-handler")},has_selected_profile_services_entry:function(e){var t;return null==e&&(e=this.getCurrentEntry()),0===e.value&&0!==(null!=(t=e.id)?t.length:void 0)},selectEntry:function(){var e,t,n,i,o,s,r,a,l;return t=this.getCurrentEntry(),this.has_selected_profile_services(t)?(h.SharedFolderActivityLogger.log("web","import_contacts_button_clicked",this.user),this.profile_services_show(),!0):this.has_selected_profile_services_entry(t)?(s="suggestion",n=t.id.split("_")[0],assert(ft.call(ee.importable_contact_services(),n)>=0,"The 'id-value' of an autocompleter-entry is not a valid Third Party contact import service"),a=ee.to_name(n),this.profile_services.service_is_connected(n)?void Pe.success(ot("You're already connected to %(service_name)s").format({service_name:a})):ft.call(ee.importable_contact_services(),n)>=0?this.link_handler.auth_service_with_user(n,this.user.id,(function(e){return function(t){return e.link_callback(t)}})(this),s):assert(!1,"Should never get here. entry_value: "+n)):(e=this.options.array[t.value],i=e.type===k.FB?e.fb_id:e.type===k.NEW_STYLE_GROUP?e.group_id:e.email,this.set_input_size(1),r=this.element.value,l=this.createTokenInfo(e.name.trim(),i,e.type),this.addContact(l)&&(o={sort_variant:null,context:"legacy_tokenizer",search_expr:r,selected_pos:this.index,num_query_results:this.getNumQueryResults(),contact_type:e.type,contact_id:i,contact_name:e.name.trim(),did_select_suggestion:!0},this.contact_search_logger.add_record(o)),kt.clear_errors(this.element.up("form")),this.dynamically_resize_input(),this.index=0,this.element.focus())},addContact:function(e){var t,n,i,o,s,r,a,u,_,c,d,h,m,f,p,g,v,w,b;for(b=this.token_manager.tokens,i=0,u=b.length;i<u;i++)if(h=b[i],e.value===h.info.value)return!1;switch(this.element.value="",e.type){case k.FB:r="fb_ids",o=new Element("img",{src:"/static/images/icons/fb_16-vflbiYTkC.png",alt:ot("Facebook")});break;case k.EMAIL:r="emails",o=new Element("img",{src:"/static/images/icons/email_16-vflcFyDTl.png",alt:""});break;case k.NEW_STYLE_GROUP:r="new_style_group_ids",o=new Element("img",{src:"/static/images/icons/icon_spacer-vflN3BYt2.gif",class:"sprite sprite_groups s_groups_group",alt:ot("Group")});break;case k.INVALID:r="invalids",o=new Element("span",{class:"hidden"});break;default:assert(!1,"should never get here due to type: "+e.type)}for(m=this.getTokenClass(e),w=l("<span class='x'>").addClass(m),w.on("click",function(e){return this.parentNode.parentNode.parentNode.parentNode.parentNode.token.remove(e),!1}),p=new Element("input",{type:"hidden",name:r,value:e.value.toString()}),h=new Element("a",{class:"title_bubble token "+m,href:"#",tabindex:"-1",title:e.bubble_title}),s=new Element("span"),this.options.wrap_name?(g=new Element("div",{class:"token-display-text"}),g.__sert(e.display),f=g,t=1):(f=e.display,t=0),c=[p,o,f],a=0,_=c.length;a<_;a++)n=c[a],s.__sert(n);return l(s).append(w),h.__date(new Element("span").__date(new Element("span").__date(new Element("span").__date(s)))),null!=(d=$(h).down(5).next(t))&&(d.innerHTML="&nbsp;"),v=new dt(h,this.hidden_input,this.token_manager,e),this.token_manager.add(v),this.element.up().__sert({before:h}),!0},getTokenClass:function(e){return e.valid?"token-valid":"token-error"},isTeamOnly:function(){return!1}});var ft=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Autocompleter.TeamTokenizer=Class.create(Autocompleter.ContactsTokenizer,{initialize:function($super,e,t,n,i,o){return $super(e,t,n,i,o),this.warn_only=!o.team_only,this.element.observe("token:remove",this.notifyExternal.bind(this)),this.element.observe("token:add",this.notifyExternal.bind(this)),this.team_contacts={},this.suspended_contacts={},this.pending_contacts={},this.reloadContacts(!0)},isTeamOnly:function(){return!this.warn_only},setTeamOnly:function(e){return this.warn_only=!e,this.reloadContacts()},reloadContacts:function(e){var t;return null==e&&(e=!1),t=Ke.getOrCreateForViewer(),t.load_contacts(e=e,(function(e){return function(t){return e.setContacts(t)}})(this))},setContacts:function($super,e){var t,n,i,o;for(this.team_contacts={},this.team_contacts[ke.get_viewer().work_email]=1,l(this.element).hasClass("team-admin")||(e=e.excludeSuspended()),e=e.sortByTeamFirst(),o=e.contacts,n=0,i=o.length;n<i;n++)t=o[n],t.team&&"active"===t.join_state&&(this.team_contacts[t.email]=1),t.team&&"suspended"===t.join_state&&(this.suspended_contacts[t.email]=1),t.team&&"pending"===t.join_state&&(this.pending_contacts[t.email]=1);return $super(this.options.contact_filter?this.options.contact_filter(e):e)},createTokenInfo:function(e,t,n){var i,o,s,r;return r=!0,o=!1,i=t,s=!1,n===k.FB&&(i=e),n!==k.EMAIL||rt.validate_email(t)?ft.call(this.members,t)>=0?(r=!1,i=ot("Already member")):ft.call(this.invitees,t)>=0?(r=!1,i=ot("Already invited")):n!==k.EMAIL||this.team_contacts[t]||this.pending_contacts[t]?n===k.FB?(r=this.warn_only,o=!0):n===k.NEW_STYLE_GROUP&&(ft.call(this.new_style_groups,t)>=0?(r=!1,i=ot("Already member group")):(r=!0,i=ot("Group"))):(r=this.warn_only,o=!0):r=!1,t!==this.user.email&&t!==this.user.id||(i=ot("You"),r=!this.contacts_only),this.suspended_contacts[t]&&(i=ot("Suspended user"),s=!0),!e&&t&&(e=t.toString()),{display:e,value:t,type:n,valid:r,external:o,bubble_title:i,suspended:s}},getTokenClass:function(e){return e.valid?e.suspended?"token-warn token-suspended":e.external?"token-warn":"token-valid":"token-error"},notifyExternal:function(e){var t,n,i;if(i=e.memo,i.external)return n=this.token_manager.tokens.filter(function(e){return e.info.external}),t=n?n.length:0,this.element.fire("sf:token:external",{count:t})}});var pt,ft=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};pt=INLINE_JS.SharingModel=Ye.SharingModel={ALBUM_THUMB_SIZE:260,ALBUM_PADDING:40,THUMBS_BATCH_SIZE:12,SHARING_URL_PREFIXES:["/sh","/scl","/sc"],filename:null,c2d_vars:{},is_folder:!1,is_album:!1,gallery_enabled:!1,gallery_showing:!1,file_viewer_files:[],send_link_autocompleter:null,team_only_shmodel:!1,owner_name:null,account_menu_options:null,sync_vars:{},init:function(e,t){return this.filename=e,this.c2d_url=null!=t?t:"/sm/c2d",this.init_logger(),l(".nav-close").on("click",this.close_embedded_fileviewer.bind(this)),l((function(e){return function(){var t,n,i;if(n=$("login-create-an-account"),n&&n.writeAttribute("href","/register?signup_tag=shmodel"),scrollTo(1,0),scrollTo(0,0),l("#download_button_link[data-dl-link]").on("click",e.download_zip),e.set_viewport_size(),t=function(t,n){return e.do_c2d(n.id)},l("#c2d-modal .login-form").on("db:login:success",t),l("#c2d-modal .register-form").on("db:register:success",t),i=ze.parse(window.location.href),i.getQuery().force_dl)return i.updateQuery({force_dl:0,dl:1}),A.get({url:i.toString(),__do_not_use_expected_domain:"dl.dropboxusercontent.com"})}})(this))},init_folder:function(e,t,n,i,o,s,r,a,u,_,c,d){var h;if(this.c2d_vars=e,this.sync_vars=t,null==a&&(a=!1),this.shared_link_infos=null!=u?u:null,this.share_tokens=null!=_?_:null,this.share_permissions=null!=c?c:null,null==d&&(d=null),this.is_folder=!0,this.gallery_enabled=n,this.gallery_showing=i,this.file_viewer_files=o,this.file_view_target=s,this.account_menu_options=d,this.file_view_target===De.FileViewTargetType.SHARED_CONTENT_LINK?this.file_view_origin=De.FileViewOriginType.SHARED_CONTENT_LINK_PAGE:this.file_view_origin=De.FileViewOriginType.SHARED_LINK_PAGE,h=this._get_sharing_url_prefix(),ft.call(pt.SHARING_URL_PREFIXES,h)>=0&&q.add_callback(h,this._handle_url_change,!0),l((function(e){return function(){return e._open_file_viewer(r),e.load_thumbs(),l("#gallery-toggle").click(function(){return e.switch_mode("gallery")}),l("#list-toggle").click(function(){return e.switch_mode("list")}),l(".file-link").click(function(t){return e._open_file_viewer(l(t.currentTarget).data("mediaIndex"))})}})(this)),s===De.FileViewTargetType.SHARED_CONTENT_LINK)return this._log_scl_ttv()},_get_sharing_url_prefix:function(){var e;return e=window.location.pathname.match(/^(\/s[hc]l?)\//),e?e[1]:""},_handle_url_change:function(e,t){var n;if(n=ie.isShown(),n&&!t.preview)return ie.close()},_open_file_viewer:function(e){var t,n,i;if(a.isNumber(e)&&!(e<0))return i=ke.get_viewer(),t=i.is_role_signed_in("work")?i.get_user_by_role("work"):ke.get_viewer().get_users()[0],n="react-file-viewer",ie.open(this.file_viewer_files,e,t,n,{fileViewTarget:this.file_view_target,fileViewOrigin:this.file_view_origin,fileViewAction:De.FileViewActionType.CLICK,sharedLinkInfos:this.shared_link_infos,shareTokens:this.share_tokens,sharePermissions:this.share_permissions,accountMenuOptions:this.account_menu_options}),!1},init_album:function(){return this.is_album=!0,this._resize_album_view(),Event.observe(window,"resize",this._resize_album_view.bind(this))},init_file:function(e,t,n){if(this.c2d_vars=t,null==n&&(n=!1),this.is_folder=!1,!n&&!this.c2d_vars.subpath&&!this.c2d_vars.is_package)return this.c2d_vars.subpath="/"+e},init_logger:function(){return l((function(e){return function(){var e;return e=l("#login-hover-link")[0],e&&e.observe("click",function(){return un.log(un.CLICK_SIGN_IN)}),$("download_button_link")&&un.attachLogListener(un.CLICK_DOWNLOAD,$("download_button_link")),e=$("add_to_my_dropbox_link"),e&&un.attachLogListener(un.CLICK_ADD_TO_MY_DROPBOX,e),$$(".remove-link").length&&un.attachLogListener(un.REMOVE_LINK,$$(".remove-link")[0]),$$(".shmodel-filename").length&&un.attachLogListener(un.CLICK_FILENAME,$$(".shmodel-filename")[0]),e=$("default_content_download_button"),e&&un.attachLogListener(un.CLICK_DOWNLOAD,e),e=$("default_content_a2md"),e&&un.attachLogListener(un.CLICK_ADD_TO_MY_DROPBOX,e),e=l("#login-create-an-account")[0],un.attachLogListener(un.CLICK_SIGNUP_THRU_DEFAULT_DROPDOWN,e),e=l("#login-hover-cont .login-form")[0],un.attachLogListener(un.LOGIN_THRU_DEFAULT_DROPDOWN,e),l("#share-button").click(function(e){return un.log(un.CLICK_SHARE)})}})(this))},_log_scl_ttv:function(){var e,t,n,i,o,s,r;if(e=(new Date).getTime(),o=xe.start_time(),t={ns_id:null!=(n=this.sync_vars)?n.sf_id:void 0,timing:e-o},r=ke.get_viewer().get_users(),r[0])return s=r[0].id,i=_e.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE,h.ShareTibEventLogger.log(s,"PREVIEW_RENDER",i,t)},set_team_only_shmodel:function(e,t){return this.team_only_shmodel=e,this.owner_name=t},_resize_album_view:function(){var e;return e=Math.floor((je.viewport_dimensions().width-2*this.ALBUM_PADDING)/this.ALBUM_THUMB_SIZE)*this.ALBUM_THUMB_SIZE,$("content-wrapper").setStyle({display:"block",width:e+"px"})},load_thumbs:function(){var e,t,n;if(n=this.gallery_showing?$$(".gallery-icon-view img"):$$(".browse-files .icon"),t=function(e){return e.src.endsWith(pe.SPACER)||e.addClassName("thumbnail"),xe.mark_time_to_view(),xe.mark_time_to_interactive()},e=X.batch_load_thumbs(n,this.THUMBS_BATCH_SIZE,t),0===e)return xe.mark_time_to_interactive()},switch_mode:function(e){var t,n,i,o,s,r,a;for(a=$A(["gallery","list"]),i=0,o=a.length;i<o;i++)r=a[i],n=$(r+"-view-container"),t=$(r+"-toggle"),e===r?(n.show(),t.addClassName("selected")):(n.hide(),t.removeClassName("selected"));return history.replaceState&&(s=window.location.pathname,"list"===e&&(s+="?lst"),history.replaceState({},"",s)),this.gallery_showing=!this.gallery_showing,this.load_thumbs()},set_viewport_size:function(){var e;if($(document.body).hasClassName("mobile"))return e=new Element("meta",{name:"viewport",content:"width = 480"}),document.head.appendChild(e)},toggle_dropdown:function(e,t,n){var i,o;if(e&&Event.extend(e).preventDefault(),!t.visible())return this.is_album?Ct.show(t,n,null,!0):(o=$$(".nav-header").first().getHeight(),i=$$(".nav-header .buttons").first().cumulativeOffset().top-4,Ct.show(t,n,o-i,!0))},prepare_confirm_remove_modal:function(e,t,n,i,o,s,r,a){var u,_,c;return n?(c=ot(i?"Unshare?":"Unshare album?"),u=l("#album-disable-token-modal")[0],at.fillVal(e.escapeHTML(),"album_unshare_name")):(s?(c=ot("Remove link created by %(name)s").format({name:r}),_=ot("You are removing the link to %(fname)s created by <b>%(owner)s</b>.  This link will no longer work for anyone who has it.<br/><br/>We'll notify <b>%(owner_email)s</b>.  Do you want to continue?"),_=_.format({fname:N.em_snippet(e,17),owner:r,owner_email:a})):(c=ot("Delete link to %(name)s?").format({name:N.em_snippet(e,17)}),_=ot("This link will no longer work for anyone who has it.")),u=l("#disable-token-modal")[0],at.fillVal(_,"disable-token-desc")),{title:c,contents:u}},confirm_remove:function(e,t,n,i,o,s,r,a,l,u){var _;return null==n&&(n=!1),null==i&&(i=!1),null==o&&(o=!1),null==s&&(s=null),null==r&&(r=!1),null==a&&(a=null),null==l&&(l=null),null==u&&(u=null),assert(t,"confirm_remove missing tkey"),assert(e,"confirm_remove missing name"),assert(s,"confirm_remove missing user_id"),assert(!r||!i,"admin removal of collections not supported"),assert(!r||a,"missing link owner name for admin removal"),assert(!r||l,"missing link owner email for admin removal"),ke.get_viewer().is_uid_signed_in(s)?(_=pt.prepare_confirm_remove_modal(e,n,i,o,s,r,a,l),St.show(_.title,_.contents,{token:t,name:e,is_album:i,user_id:s,success_callback:u})):void W.show_modal({user_id:s,on_success:(function(u){return function(){return u.confirm_remove(e,t,n,i,o,s,r,a,l)}})(this)})},confirm_remove_from_event_gid:function(e,t,n,i,o,s,r,a){var l;return null==o&&(o=!1),null==s&&(s=null),null==r&&(r=null),null==a&&(a=null),assert(t,"confirm_remove missing event gid"),assert(e,"confirm_remove missing name"),assert(i,"confirm_remove missing user_id"),assert(ke.get_viewer().is_uid_signed_in(i),"user not logged in"),assert(!o||s,"missing link owner name for admin removal"),assert(!o||r,"missing link owner email for admin removal"),l=pt.prepare_confirm_remove_modal(e,n,!1,!1,i,o,s,r),St.show(l.title,l.contents,{name:e,user_id:i,activity_log_event_gid_dbase64:t,redirect_to_member_id:a})},do_remove:function(e){var t,n,i;return assert(e.token||e.activity_log_event_gid_dbase64,"missing token or event gid_dbase64"),t=l("#modal-content input").first(),t.attr("disabled",!0),l("#modal-content").addClass("ajax-loading"),i=window.location.pathname,"/links"===i||"/links/your_links"===i||"/recents"===i||i.match("^/home|^/work|^/personal")?new Ajax.DBRequest("/sm/disable/"+e.token,{subject_user:e.user_id,onSuccess:(function(t){return function(){var t;return St.hide(),"function"==typeof e.success_callback&&e.success_callback(),t=ot(e.is_album?"Unshared '%(name)s'":"Deleted link to %(name)s"),t=t.format({name:e.name}),Pe.success(t),document.fire(O.LINKS_REMOVE,{token:e.token})}})(this),onComplete:(function(e){return function(){return t.attr("disabled",!1),l("#modal-content").removeClass("ajax-loading")}})(this)}):(e.token?n=ze({path:"/sm/disable/"+e.token}):(n=ze({path:"/sm/disable_by_event_gid/"+e.activity_log_event_gid_dbase64}),n.updateQuery("redirect_to_member_id",e.redirect_to_member_id).toString()),kt.postRequest(n.updateQuery("_subject_uid",e.user_id).toString()))},show_shmodal_onload:function(e,t,n,i){return null==i&&(i=null),l((function(o){return function(){return q.remove_query_param("m"),ke.get_viewer().is_uid_signed_in(i)?null!=i&&We.get_for_user(ke.get_viewer().get_user_by_id(i)).verified_or_show()?o.show_shmodal(e,t,n,i):null==i?(assert(ke.get_viewer().is_paired,"Expected viewer to be paired."),o.show_share_shmodel_role_chooser(e,t,n)):void 0:void W.show_modal({user_id:i,on_success:function(){return o.show_shmodal_onload(e,t,n,i)}})}})(this))},show_shmodal:function(t,n,i,o){var s,r,a,u,_,c,d,h,m,f;if(this.url=t,this.short_url=n,!ke.get_viewer().is_uid_signed_in(o))return void W.show_modal({user_id:o,on_success:(function(e){return function(){return e.show_shmodal(e.url,e.short_url,i,o)}})(this)});if(f=ke.get_viewer().get_user_by_id(o),We.get_for_user(f).verified_or_show()){if(h="shmodal-user-"+o,St.show(this._get_shmodal_title(f.is_team),at.fromElm($(h))),_={},_._subject_uid=o,kt.add_vars("shmodal-send-form",_),this._get_thumbnail_type())for(m=$$(".shmodal-image"),c=0,d=m.length;c<d;c++)u=m[c],u.addClassName("thumbnail");return a="contacts"===i?Autocompleter.ContactsTokenizer:Autocompleter.TeamTokenizer,this.send_link_autocompleter=new a(f,h+"-new-collab-input",h+"-new-whobulk",h+"-hidden-input",{tokens:[",",";"],include_fb:!0,include_team:!0,team_only:"team_only"===i,user_id:o}),this.configure_dropdown(),this.disabled||(e.installed?(s=g.clipboard_overlay(this.url,l("#"+h+"-copy-link"),pt.copied_to_clipboard),s.css({position:"fixed",zIndex:1001}),s.children().height(s.height()),clearInterval(this.follow_freshbutton),r=(function(e){
return function(){return je.clone_position(s,l("#"+h+"-copy-link"),{offsetHeight:6,offsetWidth:6})}})(this),this.follow_freshbutton=setInterval(r,500)):$(h+"-copy-link").hide()),$t._create($("modal").down(".custom-message-container")),$t._create($("modal").down(".fb-post-sickinput")),$(h+"-new-collab-input").focus(),un.log("shmodal_show")}},configure_dropdown:function(){var e,t,n,i,o;for(i=$$(".dropdown-menu-container"),t=0,n=i.length;t<n;t++)e=i[t],o=e.down(".dropdown-menu-trigger"),null!=o&&o.observe("click",(function(e){return function(e){var t;return t=e.target.up(".dropdown-menu-container"),t.toggleClassName("dropdown-shown")}})(this));return document.on("click",(function(e){return function(e){var t,n,i,o,s;if(!e.target.hasClassName("dropdown-menu-trigger")&&!e.target.up(".dropdown-menu-trigger")){for(o=$$(".dropdown-shown"),s=[],n=0,i=o.length;n<i;n++)t=o[n],s.push(t.removeClassName("dropdown-shown"));return s}}})(this))},copied_to_clipboard:function(){return Pe.success(ot("Link copied to clipboard")),St.hide(),un.log("shmodal_copy_link"),h.ViralLogger.log(ke.get_viewer().get_user_ids(),"shmodel","send",{src:"shmodel_copy_link",file_type:pt.is_album?"collection":pt.is_folder?"folder":pt.filename.indexOf(".")===-1?"file":on.EXTENSION_TO_CATEGORY[L.file_extension(pt.filename).toLowerCase()]||"file"})},get_shmodel_send_recipients:function(e){var t,n,i,o,s,r,a,l,u,_,c,d,h;for(assert(e,"Must pass the shmodal send form into get_shmodel_send_recipients"),t=e.select('input[name="emails"]'),n=e.select('input[name="fb_ids"]'),i=e.select('input[name="group_ids"]'),_=e.select('input[name="new_style_group_ids"]'),d=[],h=[t,n,i,_],o=0,l=h.length;o<l;o++)for(r=h[o],a=0,u=r.length;a<u;a++)s=r[a],c=s.up().innerHTML.stripTags().escapeHTML(),d.push(c.substring(0,c.indexOf("&")));return d},close_embedded_fileviewer:function(e){var t;return e.preventDefault(),t=new U,t.configureParentMessaging(function(){},["parent-ready"]),t.startListening(),t.postMessageToParent("close-fileviewer")},send_shmodel_link:function(e){var t,n,i,o;return t=$("shmodal-send-form"),assert(t,"Couldn't find the shmodal send form."),o=this.get_shmodel_send_recipients(t),i=(function(e){return function(e){var t;return t=_t.success_string_for_recipients(o),Pe.success(t),St.hide(),un.log("shmodal_send")}})(this),n=(function(e){return function(e){return kt.remove_loading()}})(this),kt.ajax_submit(t,"/sm/share",i,n,t.down(".tokenizer-submit-button"))},show_content:function(e){var t,n,i,o;for($("shmodal-title-text").__date(gt.to_title_str(e)),i=gt.list,t=0,n=i.length;t<n;t++)o=i[t],o!==e&&($(gt.to_toggle_str(o)).removeClassName("toggled"),$(gt.to_content_str(o)).hide());return $(gt.to_content_str(e)).show(),$(gt.to_toggle_str(e)).addClassName("toggled"),l("#modal .focusarea").focus()},show_send_content:function(){return this.show_content(gt.SEND)},show_fb_content:function(){return this.show_content(gt.FB)},start_fb_post:function(e,t){var n,i,o,s;return i=(function(n){return function(){return b.do_auth(n.do_fb_post.curry(e,t),t)}})(this),n=l("#modal:visible, #modal-overlay:visible"),o=function(){return n.show()},b.authed_user_id===t?this.do_fb_post(e,t):ke.get_viewer().is_uid_associated(b.authed_user_id)?(n.hide(),s=new w(ke.get_viewer().get_user_by_id(t),o,i.bind(this)),s.show()):i()},do_fb_post:function(e,t){return b.custom_show_posting=function(){return kt.add_loading($("shmodal-fb-post-submit"))},b.custom_show_complete=function(){return St.hide(),Pe.success(ot("Successfully posted to Facebook")),un.log("shmodal_fb_post"),h.ViralLogger.log(ke.get_viewer().get_user_ids(),"shmodel","send",{src:"shmodel_fb_post",file_type:pt.is_album?"collection":pt.is_folder?"folder":pt.filename.indexOf(".")===-1?"file":on.EXTENSION_TO_CATEGORY[L.file_extension(pt.filename).toLowerCase()]||"file"})},b.post($F("shmodal-fb-post-input"),e,null,null,null,function(){return St.hide()},t)},_get_shmodal_title:function(e){return null==e&&(e=!1),this.generate_title_content(this._get_shmodal_title_text(),(function(e){return function(){return e.show_send_content()}})(this),(function(e){return function(){return e.show_fb_content()}})(this),e)},generate_title_content:function(e,t,n,i){var o,s,r,a,u;return null==i&&(i=!1),a=l("<div/>",{id:"shmodal-title"}),u=l("<div/>",{id:"shmodal-title-text",text:e}),a.append(u),i||(r=l("<a/>",{id:"shmodal-send-toggle",class:"freshtoggle ft-left toggled"}),r.html(pe.make("web","email_20")),r.on("click",t),s=l("<a/>",{id:"shmodal-fb-toggle",class:"freshtoggle ft-middle"}),s.html(pe.make("web","fb_20")),s.on("click",n),a.append([r,s])),o=l("<div/>",{class:"clear"}),a.append(o),a[0]},_get_shmodal_title_text:function(){var e,t;return this.is_folder?(e=ot("Share link to %(folder_name)s"),e=e.format({folder_name:N.em_snippet(this.filename,15)})):(t=this._get_thumbnail_type(),t===on.CATEGORY_TO_TRANSLATION.IMAGE?ot("Share this image"):t===on.CATEGORY_TO_TRANSLATION.VIDEO?ot("Share this video"):ot("Share '%(filename)s'").format({filename:N.em_snippet(this.filename,18)}))},_get_thumbnail_type:function(){var e,t;return this.filename.indexOf(".")!==-1&&(t=L.file_extension(this.filename).toLowerCase(),e=on.EXTENSION_TO_CATEGORY[t],!(!e||"IMAGE"!==e&&"VIDEO"!==e)&&on.CATEGORY_TO_TRANSLATION[e])},download_zip:function(e){var t,n,i,o,s;return t=l("#download_button_link").attr("data-dl-link"),s=l("#download_button_link").attr("data-test-link"),o="true"===l("#download_button_link").attr("data-owner"),i=(function(e){return function(e){var n;return"OK"===e?window.location=t:0===e.indexOf("err:")?(n=ot(o?"The zip file is too large.":"The zip file is too large. Please add it to your Dropbox."),Pe.error(n)):Pe.error(ot("Failed to download zip file.")),!1}})(this),n=(function(e){return function(e){return Pe.error(ot("Failed to download zip file.")),!1}})(this),s&&l.support.cors===!0?d.SilentBackgroundRequest({url:s,success:i,error:n}):window.location=t,!1},show_share_shmodel_role_chooser:function(e,t,n){return null==this.shmodel_select_role_modal&&(this.shmodel_select_role_modal=new Ft({element_id:"share-shmodel-select-role-modal",link_url:e,short_url:t,tokenizer_type:n})),this.shmodel_select_role_modal.show().set_title(this._get_shmodal_title_text())},prompt_login_then_share:function(e,t,n,i){var o;return o=(function(o){return function(){var o;return St.hide(),l("#role-selector option").removeClass("disabled"),o=ke.get_viewer().get_uid_by_role(i),ke.get_viewer().sign_in_user_by_id(o),h.ShmodelUILogger.log("via-shmodel-viewer"),pt.show_shmodal(e,t,n,o)}})(this),ke.get_viewer().is_role_signed_in(i)?o():W.show_modal({role:i,on_success:o})},show_c2d_modal:function(e,t){var n,i,o,s,r;if(null==e&&(e=""),null==t&&(t=!1),e){if("personal"===e&&assert("forbid"!==this.team_only_shmodel,"Can't copy to personal Dropbox if restricted"),!ke.get_viewer().is_role_signed_in(e))return void W.show_modal({role:e,on_success:(function(t){return function(){return t.show_c2d_modal(e)}})(this)})}else if(ke.get_viewer().is_paired)return void new qt({element_id:"select-role-modal"}).show();return h.WebMiscActivityLogger.log("show-c2d-modal",{filename:this.filename,auth_google:null!=l.find(".auth-google")}),s=e?"#c2d-modal-"+e:"#c2d-modal",r=this._c2d_modal_msg(e,ke.get_viewer().team_name),n=this._c2d_modal_button_msg(e,ke.get_viewer().team_name),i=this._c2d_modal_desc(e,ke.get_viewer().team_name),t&&(i=this._c2d_modal_team_only_desc(ke.get_viewer().team_name)+"<br/><br/>"+i),o=this._c2d_modal_login_desc(e,ke.get_viewer().team_name),at.fillVal(i,"c2d-desc"),at.fillVal(o,"c2d-login-desc"),l(".c2d-submit-button").val(n),l(".c2d-login-register-desc").hide(),this.is_album?l(".c2d-login-register-album-desc").show():this.is_folder?l(".c2d-login-register-folder-desc").show():l(".c2d-login-register-file-desc").show(),St.show(r,l(s)[0],!1,!1,!1,!1)},_c2d_modal_msg:function(e,t){var n,i;return null==e&&(e=""),null==t&&(t=""),this.c2d_vars.title?i=this.c2d_vars.title:"personal"===e?(i=ot("Save '%(filename)s' to my personal Dropbox"),i.format({filename:N.em_snippet(this.filename,10)})):"work"===e?(i=ot("Save '%(filename)s' to my %(team_name)s Dropbox"),n=Math.max(10,15-new N(t).length),i.format({filename:N.em_snippet(this.filename,n),team_name:t})):(i=ot("Save '%(filename)s' to my Dropbox"),i.format({filename:N.em_snippet(this.filename,15)}))},_c2d_modal_button_msg:function(e,t){var n;return null==e&&(e=""),null==t&&(t=""),"personal"===e?n=ot("Save to my personal Dropbox"):"work"===e?(n=ot("Save to my %(team_name)s Dropbox"),n.format({team_name:t})):ot("Save to my Dropbox")},_c2d_modal_team_only_desc:function(e){var t;return t=ot(this.is_album?"You can only add this album to your <b>%(team_name)s Dropbox</b> because <b>%(owner_name)s</b> has restricted the album to members of <b>%(team_name)s</b>.":this.is_folder?"You can only add this folder to your <b>%(team_name)s Dropbox</b> because <b>%(owner_name)s</b> has restricted the folder to members of <b>%(team_name)s</b>.":"You can only add this file to your <b>%(team_name)s Dropbox</b> because <b>%(owner_name)s</b> has restricted the file to members of <b>%(team_name)s</b>."),t.format({owner_name:this.owner_name,team_name:e})},_c2d_modal_desc:function(e,t){var n;return null==e&&(e=""),null==t&&(t=""),"personal"===e?this.is_album?"warn"===this.team_only_shmodel?(n=ot("The photos and videos in this album were sent from <b>%(owner_name)s</b> on your <b>%(team_name)s</b> team.  Are you sure you want to copy them to your personal Dropbox?"),n.format({owner_name:this.owner_name,team_name:t})):n=ot("The photos and videos in this album will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):this.is_folder?"warn"===this.team_only_shmodel?(n=ot("This folder was sent from <b>%(owner_name)s</b> on your <b>%(team_name)s</b> team.  Are you sure you want to copy it to your personal Dropbox?"),n.format({owner_name:this.owner_name,team_name:t})):n=ot("This folder will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):"warn"===this.team_only_shmodel?(n=ot("This file was sent from <b>%(owner_name)s</b> on your <b>%(team_name)s</b> team.  Are you sure you want to copy it to your personal Dropbox?"),n.format({owner_name:this.owner_name,team_name:t})):n=ot("This file will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):"work"===e?(n=ot(this.is_album?"The photos and videos in this album will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":this.is_folder?"This folder will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":"This file will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account."),n.format({team_name:t})):ot(this.is_album?"The photos and videos in this album will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.":this.is_folder?"This folder will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.":"This file will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.")},_c2d_modal_login_desc:function(e,t){var n;return null==e&&(e=""),null==t&&(t=""),"personal"===e?n=ot(this.is_album?"Once you sign in to your personal Dropbox, the photos and videos in this album will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account.":this.is_folder?"Once you sign in to your personal Dropbox, this folder will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account.":"Once you sign in to your personal Dropbox, this file will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):"work"===e?(n=ot(this.is_album?"Once you sign in to your %(team_name)s Dropbox, the photos and videos in this album will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":this.is_folder?"Once you sign in to your %(team_name)s Dropbox, this folder will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":"Once you sign in to your %(team_name)s Dropbox, this file will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account."),n.format({team_name:t})):void 0},do_c2d:function(e){var t;return assert(e,"Must specify a user_id for saving to Dropbox."),t=ot("Saving to your Dropbox..."),ke.get_viewer().is_paired&&(ke.get_viewer().get_user_by_id(e).is_team?(t=ot("Saving to your %(team_name)s Dropbox..."),t=t.format({team_name:ke.get_viewer().team_name})):t=ot("Saving to your personal Dropbox...")),Pe.success(t),St.hide(),new Ajax.DBRequest(this.c2d_url,{parameters:this.c2d_vars,job:this.is_folder,progress_text:t,subject_user:e,onSuccess:(function(e){return function(e){if(e.responseText)return Oe.redirect(e.responseText)}})(this)})},request_shared_folder_sync:function(e){var t;return null==e&&(e=""),t=_e.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE,me.mountSharedFolder(this.sync_vars.sf_id,e,t)}};var gt;gt=Ye.ShmodalPanes={SEND:0,FB:1,list:[0,1],_content_str:["shmodal-send-content","shmodal-fb-content"],_toggle_str:["shmodal-send-toggle","shmodal-fb-toggle"],_title_str:["Share by Email",ot("Share on Facebook")],to_content_str:function(e){return this._content_str[e]},to_toggle_str:function(e){return this._toggle_str[e]},to_title_str:function(e){return 0===e?pt._get_shmodal_title_text():this._title_str[e]},to_focus_str:function(e){return this._focus_str[e]}};var vt=function(e,t){return function(){return e.apply(t,arguments)}},wt=function(e,t){function n(){this.constructor=e}for(var i in t)bt.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},bt={}.hasOwnProperty;INLINE_JS.ShareLinkModal=Ye.ShareLinkModal=(function(e){function t(e,n,i,o,s){var r,a;this.user_id=e,null==o&&(o=!1),null==s&&(s=void 0),this.before_show=vt(this.before_show,this),this.show=vt(this.show,this),this.prompt_login_then_show=vt(this.prompt_login_then_show,this),h.LegacySharingVortexLogger.log("construct-share-link-modal"),a={origin:i},a._subject_uid=this.user_id,r=s?ze({path:"/sm/get_link_modal_content/"+s}).toString():ze({path:"/sm/share_link"+n}).toString(),t.__super__.constructor.call(this,{element_id:"share-link-modal",endpoint_url:r,parameters:a})}return wt(t,e),t.prototype.prompt_login_then_show=function(){var e;return e=(function(e){return function(){return St.hide(),l("#role-selector option").removeClass("disabled"),ke.get_viewer().sign_in_user_by_id(e.user_id),h.ShmodelUILogger.log("via-shmodel-viewer"),e.show()}})(this),ke.get_viewer().is_uid_signed_in(this.user_id)?e():W.show_modal({user_id:this.user_id,on_success:e})},t.prototype.show=function(){var e;if(h.LegacySharingVortexLogger.log("show-share-link-modal"),e=ke.get_viewer().get_user_by_id(this.user_id),We.get_for_user(e).verified_or_show(c.SHMODAL))return t.__super__.show.call(this)},t.prototype.before_show=function(){var e,t,n;if(this.$modal_window.find(".share-link-modal-content").length)return e={class:"ajax-loading-indicator",src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",alt:ot("Loading...")},n=l("<img />",e),t=l("<div />",{class:"loading-spinner"}).append(n),this.$modal_window.find(".dynamic-content").html(t)},t})(T),Ye.ShareLinkModalContent=(function(){function e(e,t,n,i,o,s,r,a,u,_,c){var d,h;this.owner_id=e,this.tkey=t,this.fq_path=n,this.link=i,this.filename=o,this.is_dir=s,this.tokenizer_type=r,this.tokenizer_ctx_str=a,this.is_restricted_to_members=u,this.fq_path_of_restricting_sf=c,this._send_link=vt(this._send_link,this),this._show_shared_link_remove_confirm_modal=vt(this._show_shared_link_remove_confirm_modal,this),this._show_shared_folder_settings_modal=vt(this._show_shared_folder_settings_modal,this),this._select_all_text=vt(this._select_all_text,this),this._toggle_send_link_button=vt(this._toggle_send_link_button,this),this._toggle_recipients_outside_team_warning=vt(this._toggle_recipients_outside_team_warning,this),this._toggle_close_button_text=vt(this._toggle_close_button_text,this),this._mark_onboarding_as_seen=vt(this._mark_onboarding_as_seen,this),this._add_message_checkbox_changed=vt(this._add_message_checkbox_changed,this),this._toggle_comment_option=vt(this._toggle_comment_option,this),this._listen=vt(this._listen,this),this._init_autocompleter=vt(this._init_autocompleter,this),this.$content=l(".share-link-modal-content"),this.modal=Ge.get_containing_modal(this.$content),this.modal&&("shared_folder"===this.tokenizer_type&&(this.shared_folder_members=y.create_contacts_list(_)),h={filename:this.filename,fq_path:this.fq_path,tkey:this.tkey,user_id:this.owner_id},document.fire(O.LINKS_ADD,h),l(document).trigger(O.LINKS_ADD,h),this.modal.set_title(ot("Share link to %(filename)s").format({filename:N.em_snippet(this.filename,15)})),this.collab_input_id=this.tokenizer_ctx_str+"-new-collab-input",this.$collab_input=this.$content.find("#"+this.collab_input_id),this.$send_link_button=this.$content.find(".confirm-button"),this.$share_link_url_input=this.$content.find(".copy-link-input-container input[type='text']"),this.$cancel_button=this.$content.find(".cancel-button"),this.$custom_message_textarea=this.$content.find("#share-link-modal-custom-message"),this.$comment_option_container=this.$content.find(".add-message-as-comment-container"),this._init_autocompleter(),this._listen(),null!=(d=this.$share_link_url_input[0])&&d.select())}return e.prototype._init_autocompleter=function(){var e,t;return e={tokens:[",",";"],include_fb:!0,include_team:!0,team_only:"team_only"===this.tokenizer_type,user_id:this.owner_id},"shared_folder"===this.tokenizer_type?this.autocompleter=new Autocompleter.SharedFolderTokenizer(ke.get_viewer().get_user_by_id(this.owner_id),this.collab_input_id,this.tokenizer_ctx_str+"-new-whobulk",this.tokenizer_ctx_str+"-hidden-input",e,this.shared_folder_members):"contacts"===this.tokenizer_type?this.autocompleter=new Autocompleter.ContactsTokenizer(ke.get_viewer().get_user_by_id(this.owner_id),this.collab_input_id,this.tokenizer_ctx_str+"-new-whobulk",this.tokenizer_ctx_str+"-hidden-input",e):this.autocompleter=new Autocompleter.TeamTokenizer(ke.get_viewer().get_user_by_id(this.owner_id),this.collab_input_id,this.tokenizer_ctx_str+"-new-whobulk",this.tokenizer_ctx_str+"-hidden-input",e),t=(function(e){return function(t){return function(){return e.autocompleter.contact_search_logger.log_records(e.owner_id,t)}}})(this),this.modal.logger_keydown_close_handler=t(!0),this.modal.$overlay.on("click",t(!0)),this.modal.$db_modal_x.on("click",t(!0)),this.$send_link_button.on("click",t(!1)),this.$cancel_button.on("click",t(!0)),$t.init(),this.$collab_input.focus()},e.prototype._listen=function(){var e,t,n,i,o,s,r;return this.$send_link_button.on("click",this._send_link),this.$share_link_url_input.on("click",this._select_all_text),this.$cancel_button.on("click",(function(e){return function(e){return Je.pop()}})(this)),this.$content.find("#shared-folder-options-link").on("click",this._show_shared_folder_settings_modal),this.$content.find("#shared-link-delete-link").on("click",this._show_shared_link_remove_confirm_modal),this.$comment_option_container.length>0&&(this.$custom_message_textarea.on("input",this._toggle_comment_option),this.$comment_option_container.find("#add-message-as-comment").on("change",this._add_message_checkbox_changed),e=this.$comment_option_container.find(".bubble-dropdown-x"),e.length>0&&e.on("click",this._mark_onboarding_as_seen)),null!=(t=this.$collab_input)&&t.keyup(this._toggle_send_link_button),null!=(n=this.$collab_input)&&n.on("input",this._toggle_send_link_button),null!=(i=this.$collab_input[0])&&i.observe("token:remove",this._toggle_send_link_button),null!=(o=this.$collab_input[0])&&o.observe("token:add",this._toggle_close_button_text),null!=(s=this.$collab_input[0])&&s.observe("token:remove",this._toggle_close_button_text),null!=(r=this.$collab_input[0])?r.observe("sf:token:external",this._toggle_recipients_outside_team_warning):void 0},e.prototype._toggle_comment_option=function(e){var t;return t=this.$custom_message_textarea.val().length,t>0?this.$comment_option_container.css("visibility","visible"):this.$comment_option_container.css("visibility","hidden")},e.prototype._add_message_checkbox_changed=function(e){return d.SilentBackgroundRequest({url:"/file_activity/set_share_modal_checkbox_preference",data:{fq_path:this.fq_path,checked:e.currentTarget.checked},subject_user:this.owner_id})},e.prototype._mark_onboarding_as_seen=function(e){return d.SilentBackgroundRequest({url:"/file_activity/has_seen_add_message_as_comment_onboarding",data:{fq_path:this.fq_path},subject_user:this.owner_id})},e.prototype._toggle_close_button_text=function(e){var t,n;return n=0===(null!=(t=this.autocompleter)?t.token_manager.tokens.length:void 0),n?this.$cancel_button.text(ot("Close")):this.$cancel_button.text(ot("Cancel"))},e.prototype._toggle_recipients_outside_team_warning=function(e){var t,n;if(t=l(".external-recipient-warning-message"),t.length)return n=e.memo.count,e.memo.shared_folder_warning?n>0?t.show():t.hide():n>1?(t.find(".external-recpient-num").text(n),t.removeClass("single").show()):1===n?t.addClass("single").show():t.hide()},e.prototype._toggle_send_link_button=function(e){var t,n;return n=0===(null!=(t=this.autocompleter)?t.token_manager.tokens.length:void 0),n=n&&""===l.trim(this.$collab_input.val()),this.$send_link_button.prop("disabled",n)},e.prototype._select_all_text=function(e){return l(e.currentTarget)[0].select()},e.prototype._show_shared_folder_settings_modal=function(e){var t;return e.preventDefault(),t=ke.get_viewer().get_user_by_id(this.owner_id),nt(t,{fqPath:this.fq_path_of_restricting_sf,isFolder:!0,origin:"SHARE_LINK_MODAL"}),Je.pop()},e.prototype._show_shared_link_remove_confirm_modal=function(e){var t;return e.preventDefault(),t=(function(e){return function(){return Je.pop(),l(document).trigger(O.LINKS_REMOVE,{fq_path:e.fq_path})}})(this),pt.confirm_remove(this.filename,this.tkey,this.is_dir,!1,!1,this.owner_id,!1,null,null,t)},e.prototype._send_link=function(e){var t,n,i,o,s;return i=this.$content.find(".share-link-modal-send-form")[0],o=this.get_shmodel_send_recipients(i),s=(function(e){return function(e){var t;return t=_t.success_string_for_recipients(o),Pe.success(t),Je.pop(),un.log("shmodal_send")}})(this),n=(function(e){return function(e){return kt.remove_loading()}})(this),t=this.$content.find(".tokenizer-submit-button")[0],kt.ajax_submit(i,"/sm/share",s,n,t)},e.prototype.get_shmodel_send_recipients=function(e){var t,n,i,o,s,r,a,l,u,_,c,d,h;for(assert(e,"Must pass the shmodal send form into get_shmodel_send_recipients"),t=e.select('input[name="emails"]'),n=e.select('input[name="fb_ids"]'),i=e.select('input[name="group_ids"]'),_=e.select('input[name="new_style_group_ids"]'),d=[],h=[t,n,i,_],o=0,l=h.length;o<l;o++)for(r=h[o],a=0,u=r.length;a<u;a++)s=r[a],c=s.up().innerHTML.stripTags().escapeHTML(),d.push(c.substring(0,c.indexOf("&")));return d},e})();var yt;yt=INLINE_JS.FileOps=Ye.FileOps={do_folder_restore:function(e,t){var n;return n=function(t){var n,i;return n=ot("Restoring '%(folder_name)s'").format({folder_name:L.filename(e)}),i=t.responseText,i.startsWith("err:")?(i=i.substring(4),l("#async-result").html(i),Pe.error(new Fe(i),60)):(n=ot("Restored '%(folder_name)s'").format({folder_name:L.filename(e)}),l("#status-of-files").text(ot("Restored files")),Pe.success(n,60)),l("#restore-done-heading").text(n),l(".pre-restore").hide(),l(".post-restore").show()},new Ajax.DBRequest("/cmd/restore",{parameters:{files:[e]},job:!0,html_in_error_msg:!0,progress_text:ot("Restoring..."),onSuccess:n,onFailure:n,subject_user:t})}};var kt,bt={}.hasOwnProperty;kt=INLINE_JS.Forms=Ye.Forms={submitOnlyOnce:function(){var e;return e=kt.submitted!==!0,kt.submitted=!0,e},disable:function(e){if(e)return setTimeout(function(){return e.disabled=!0},0)},enable:function(e){if(e)return setTimeout(function(){return e.disabled=!1},0)},_button_on_change:function(e,t,n,i){var o,s,r,a;return o=l(e),o[t](),null==i&&(i=o.closest("form")),s=i[0],null==this.next_id&&(this.next_id=0),r=this.next_id++,null==this.initial_vars&&(this.initial_vars={}),this.initial_vars[r]=this.collect_form_vars(s),o.attr("data-id",r),i.data("button-id",r),a=(function(e){return function(){var i,a,l;o[t](),a=e.collect_form_vars(s),Object.keys(a).length!==Object.keys(e.initial_vars[r]).length&&o[n](),l=[];for(i in a)a[i]!==e.initial_vars[r][i]?l.push(o[n]()):l.push(void 0);return l}})(this),i.change(a),i.find("input").filter(":text").on("input",a),i.find("textarea").on("input",a)},show_button_on_change:function(e,t){return this._button_on_change(e,"hide","show",t)},hide_button_on_change:function(e,t){return this._button_on_change(e,"show","hide",t)},add_vars:function(e,t){var n,i,o;e=$(e),o=[];for(i in t)bt.call(t,i)&&(n=new Element("input",{type:"hidden",name:i}),n.setValue(t[i]),o.push(e.__sert(n)));return o},collect_form_vars:function(e,t){var n,i,o,s,r,a;for(null==t&&(t=!1),e=e||$(document.body),i=e.select("input").concat(e.select("textarea")).concat(e.select("select")),r={},o=0,s=i.length;o<s;o++)n=i[o],n.name&&"t"!==n.name&&!l(n).attr("data-ignore-var")&&(a=n.getValue(),(a||t)&&("string"!=typeof a&&(a=a.join(",")),null!=r[n.name]?"string"==typeof r[n.name]?r[n.name]=[r[n.name],a]:r[n.name].push(a):r[n.name]=a));return r},add_loading:function(e,t){var n;if(e)return e=$(e),n=new Element("img",{src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"}),n.addClassName("text-img ajax_submit_loading"),"after"===t?l(e).after(n):l(e).before(n)},remove_loading:function(e){return l(".ajax_submit_loading").remove()},ui_form_submit:function(e,t){return t=t||e.action,!e.ajax_submitted&&(e.ajax_submitted=!0,new S(l(e),t,{data:kt.collect_form_vars(e),success:(function(t){return function(n,i,o){var s,r;if(r=l(e).data("button-id"),null!=r)return s=l(e).find("*[type='submit'][data-id='"+r+"']"),t.initial_vars[r]=t.collect_form_vars(e),s.hide()}})(this),complete:(function(t){return function(t,n){return e.ajax_submitted=!1}})(this)}))},ajax_submit_obj:function(e){var t,n,i,o,s,r,a,l,u,_,c;return o=e.form,c=e.url,_=e.success_callback,i=e.fail_callback,t=e.button,a=e.more_vars,l=e.position,r=e.job,s=e.html_response,n=e.complete_callback,u=e.progress_text,kt.ajax_submit(o,c,_,i,t,a,l,r,s,n,u)},ajax_submit:function(e,t,n,i,o,s,r,a,l,u,_){var c;return null==l&&(l=!1),!e.ajax_submitted&&(e.ajax_submitted=!0,o&&kt.add_loading(o,r),c=kt.collect_form_vars(e),s&&Object.extend(c,s),new Ajax.DBRequest(t||e.action,{noAutonotify:!0,parameters:c,job:a,progress_text:_,evalJSON:!1,onSuccess:function(e){if(kt.remove_loading(),n&&"function"==typeof n)return n(e)},onFailure:function(t){var n,o;if(t&&(0===t.responseText.indexOf("err:")?(n=t.responseText.substr(4),0===n.indexOf("{")?(o=n.evalJSON(!0),kt.fill_errors(e,o)):(l&&(n=new Fe(n)),Pe.error(n))):Pe.error(ot("There was a problem completing this request.")),kt.remove_loading(),i&&"function"==typeof i))return i(t)},onComplete:function(t){if(e.ajax_submitted=!1,u&&"function"==typeof u)return u(t)}}),!1)},clear_errors:function(e){return e=e||$(document.body),this.hide_errors(e),e.select(".error-removable").invoke("remove")},fill_errors:function(e,t){var n,i,o,s,r,a;t=t||{},e=e||$(document.body),kt.clear_errors(e);for(r in t)bt.call(t,r)&&(i=e.down("[data-error-field-name='"+r+"']")||e.down("[name='"+r+"']"),i&&(n=new Element("br",{class:"error-removable"}),o=new Element("span",{class:"error-message error-removable"}),s=t[r],assert(s.message_html||s.message_text,"Error message must have a message_html or message_text property"),s.message_html?o.update(s.message_html):o.__date(s.message_text),l(i).before(o),l(i).before(n),a=l(e).find("input[name='"+r+"'], textarea[name='"+r+"']"),a&&a.addClass("input-error")));return this.show_errors(e)},value:function(e){var t,n,i,o,s;for(i=$$('input[name="'+e+'"]'),s=null,t=0,o=i.length;t<o;t++)n=i[t],s=$(n).getValue()||s;return s},postRequest:function(e,t,n){var i;return null==t&&(t={}),null==n&&(n={}),assert(null!=e,"postRequest missing action"),t.t=Me.read("__Host-js_csrf"),i=new Element("form",{action:e,method:"POST"}),n.target&&(i.target=n.target),document.body.appendChild(i),kt.add_vars(i,t),i.submit()},hide_errors:function(e){var t,n,i,o,s;for(t=this.get_errors(e),o=[],n=0,i=t.length;n<i;n++)s=t[n],s.down("span.error-message")?o.push(s.hide()):o.push(void 0);return o},show_errors:function(e){var t,n,i,o;for(t=this.get_errors(e),n=0,i=t.length;n<i;n++)o=t[n],o.down("span.error-message")&&o.show();return l(".sick-input").find("label").css("top","")},get_errors:function(e){var t;return t=".error-bubble, .error-plain-text",e?e.select(t):$$(t)}},l(function(){return kt.show_errors()});var xt;xt=Ye.ActAsBlock={elm_list:["margin-left","margin-right","padding-left","padding-right","border-left-width","border-right-width"],parent_list:["padding-left","padding-right","border-left-width","border-right-width"],register:function(e,t){var n,i,o,s;for(null==t&&(t=document.body),o=$(t).getElementsByClassName("act_as_block"),s=[],n=0,i=o.length;n<i;n++)e=o[n],s.push(this.resize(e));return s},resize:function(e){var t,n,i,o;if(e=$(e),n=e.up(),t=rt.sumStyles(e,this.elm_list),i=rt.sumStyles(n,this.parent_list),e.style.width="1px",o=n.getWidth()-t-i,o>0)return e.style.width=o+"px"}};Ye.BrowseStyleRows={register_all:function(){var e,t,n,i;for(n=$$(".bs-row"),e=0,t=n.length;e<t;e++)i=n[e],this.register(i);return Event.observe(document,"click",this.kill_current.bind(this)),l(document).on("dropdown-opened",this.kill_current.bind(this))},register:function(e){var t;if(e=$(e),e.db_observe("mouseover",this.mouseover.bind(this)),e.db_observe("mouseout",this.mouseout.bind(this)),t=e.down(".action-button"))return t.db_observe("click",this.click.bind(this))},mouseover:function(e,t){if(!t.hasClassName("no-hover"))return t.addClassName("hover")},mouseout:function(e,t){return t.removeClassName("hover")},click:function(e,t){var n,i,o;if("A"!==e.target.tagName)return i=t.up(".bs-row"),Event.stop(e),i.hasClassName("selected")?void this.kill_current(!1):(l(document).trigger("dropdown-opened"),this.kill_current(!1),o=$(e.target),o.match(".bs-actions-list *")||i.addClassName("selected"),n=o.hasClassName("bs-row")?o:o.up(".bs-row"),n.style.zIndex=9)},kill_current:function(e){var t,n,i,o,s;for(o=$$(".bs-row.selected"),s=[],n=0,i=o.length;n<i;n++)t=o[n],t.removeClassName("selected"),s.push(t.style.zIndex="");return s}};var Et;Et=Ye.Bubble={make:function(e,t,n,i,o){var s,r,a,l,u,_,c,d,h,m,f,p,g,v,w,b,y,k,x,E;return null==t&&(t="left"),o=null!=o?o:{},["left","right"].contains(t)?(n=n||"middle",assert(["top","middle","bottom"].contains(n),"expected tail position ['top', 'middle', 'bottom'], got "+n)):["bottom","top"].contains(t)?(n=n||"center",assert(["left","center","right"].contains(n),"expected tail position ['left', 'center', 'right'], got "+n)):["none"].contains(t)||assert(!1,"unexpected tail side, got "+t),p=new Element("table"),"titled"===o.style?(p.addClassName("bluebubble"),g="bluebubble"):(p.addClassName("bubble"),g="bubble"),i&&(p.style.width=i+"px"),w=new Element("tbody"),k=new Element("tr"),b=new Element("td"),b.addClassName("tl"),f=new Element("td"),f.addClassName("t"),"titled"===o.style&&i&&(f.style.width=i-42+"px"),y=new Element("td"),y.addClassName("tr"),"top"===t&&(v=new Element("img",{src:"/static/images/"+g+"_arrow_top.png"}),v.addClassName("tarrow"),"titled"===o.style?(v.addClassName("arrow-"+n),r=new Element("div"),r.addClassName("arrow-container"),i&&(r.style.width=i-42+"px"),
r.__sert(v),f.__sert(r)):(f.style.textAlign=n,f.__sert(v))),k.__sert(b),k.__sert(f),k.__sert(y),w.__sert(k),x=new Element("tr"),d=new Element("td"),d.addClassName("l"),"left"===t&&(s="titled"===o.style?new Element("img",{src:"/static/images/bluebubble_arrow_left-vfl8zzy_-.png"}):new Element("img",{src:"/static/images/bubble_arrow-vfl8m7tk-.png"}),s.addClassName("arrow"),d.__sert(s),d.vAlign=n),c=new Element("td"),c.addClassName("c"),c.update(e),h=new Element("td"),h.addClassName("r"),"right"===t&&(m=new Element("img",{src:"/static/images/bubble_arrow_right-vflmW3_2s.png"}),m.addClassName("rarrow"),h.__sert(m),h.vAlign=n),x.__sert(d),x.__sert(c),x.__sert(h),w.__sert(x),E=new Element("tr"),u=new Element("td"),u.addClassName("bl"),a=new Element("td"),a.addClassName("b"),"bottom"===t&&(l=new Element("img",{src:"/static/images/"+g+"_arrow_bottom.png"}),l.addClassName("barrow"),"titled"===o.style?(l.addClassName("arrow-"+n),r=new Element("div"),r.addClassName("arrow-container"),i&&(r.style.width=i-42+"px"),r.__sert(l),a.__sert(r)):(a.style.textAlign=n,a.__sert(l))),_=new Element("td"),_.addClassName("br"),E.__sert(u),E.__sert(a),E.__sert(_),w.__sert(E),p.__sert(w),p}};var Ct;Ct=INLINE_JS.FreshDropdown=Ye.FreshDropdown={show:function(e,t,n,i){var o,s,r,a;return null==i&&(i=!1),l(document).trigger("dropdownOpened",[1]),o=l(t),n||(n=o[0].offsetHeight+10),this.hide_all(),s=l(e).show(),a=s[0].offsetWidth,r=o[0].offsetWidth,je.clone_position(s,o,{setHeight:!1,setWidth:!1,offsetLeft:-1*(a-r)+22,offsetTop:n}),i&&s.width(a),o.addClass("pressed"),(function(e){return function(){return document.observe("click",Ct.hide_all)}})(this).defer()},hide_all:function(e){var t,n;return n=l(".freshdropdown-menu"),t=0,n.each(function(){if(l(this).is(":visible"))return t+=1}),n.hide(),l(document).trigger("dropdownClosed",[t]),$$(".freshdropdown-button").invoke("removeClassName","pressed"),document.stopObserving("click",Ct.hide_all)}};var Tt;Tt=Ye.JumpWatcher={inverval:null,last_hash:null,last_page_offset:0,check:function(){return window.location.href.endsWith("#")&&0===window.pageYOffset&&0!==Tt.last_page_offset?this.report():(this.last_page_offset=window.pageYOffset,this.last_hash=ze.parse(window.location.href).fragment)},report:function(){return clearInterval(Tt.interval),reportStack("Hash jump detected, last hash = "+this.last_hash+". You may have an onclick handler that isn't firing, or you are not preventing the default action (eg. by returning false in your handler)")}};var St;St=INLINE_JS.Modal=Ye.Modal={KEY_SCOPE:"modal",width:640,vertical_offset:90,show:function(e,n,i,o,s,r,a,u,_){var c,d,h,m,f;return null==i&&(i=!1),null==o&&(o=!1),null==s&&(s=!1),null==r&&(r=!1),null==a&&(a=""),null==u&&(u=!0),null==_&&(_=!1),St.shown()&&St._cleanup(),s=s||this.width,d="#modal-content .error-message, #modal-content .error-removable, #modal-content .error-bubble",$$(d).invoke("hide"),assert(n,"Missing modal content!"),f=this.vars._prev_scope,this.vars=i||{},this.vars._prev_scope=f,$("modal").setStyle({width:s+"px",margin:"0 0 0 "+Math.floor(-s/2).toString()+"px"}),this.vars.extra_class="",a&&($("modal").addClassName(a),this.vars.extra_class=a),r||(m=rt.childElement($("modal-content"),0),m&&m!==n&&$("grave-yard").__sert(m),c=new Element("div"),c.update(n),$("modal-content").__sert(c),n.show&&n.show(),Element.show("modal")),l("#modal-overlay").off("click"),u?l("#modal-overlay").on("click",function(e){return St.hide(null,!1,!0),e.preventDefault(),e.stopPropagation()}):l("#modal-overlay").on("click",function(e){return e.preventDefault(),e.stopPropagation()}),this.fix_position(),$("modal-overlay").show(),$("modal-behind").setStyle({width:s+20+"px",margin:"0 0 0 "+Math.floor(-s/2-10).toString()+"px"}),l("#modal-behind").css("opacity",.2),$("modal-behind").show(),o?$("modal-content").select("#"+o.id).first().focus():rt.ie||(h=$("modal").down("input[type=submit]")||$("modal").down("input[type=button]"),h&&h.focus()),this.track_id||this.track_resizes(),e?(rt.isElm(e)?l("#modal-title").html(e):l("#modal-title").text(e),l("#modal-title").show(),l("#modal-title").text()):l("#modal-title").hide(),xt.register(!1,"modal"),this.keydownHandler=this.keydown.bind(this),document.observe("keydown",this.keydownHandler),$("modal-content").style.height="auto",t.getScope()!==this.KEY_SCOPE&&(this.vars._prev_scope=t.getScope()),t.setScope(this.KEY_SCOPE),this.prevent_hide_if_loading=_,l("#modal").find("input").filter(":visible:first").focus(),this.in_viewport()&&(this.scroll_locked=!0,je.scroll_lock_document()),l(document).trigger("modalOpened",[1]),!1},in_viewport:function(){var e,t,n,i,o;return e=l("#modal"),t=e.height(),o=e.width(),n=je.viewport_dimensions(),i=je.viewport_offset(e),i.left>0&&i.top>0&&i.left+o<n.width&&i.top+t<n.height},fix_position:function(e){var t,n;return n=document.viewport.getScrollOffsets().top+this.vertical_offset,t=parseInt($("modal").getStyle("height"),10),t+this.vertical_offset<document.viewport.getHeight()?($("modal").setStyle({position:"fixed",top:this.vertical_offset+"px"}),$("modal-behind").setStyle({position:"fixed",height:t+20+"px",top:this.vertical_offset-10+"px"})):($("modal").setStyle({position:"absolute",top:n+"px"}),$("modal-behind").setStyle({position:"absolute",height:t+20+"px",top:n-10+"px"}))},keydown:function(e){var t,n,i,o;if(i=e.keyCode||e.which||e.charCode,(27===i||8===i&&!je.focus_in_input())&&(e.preventDefault(),this.hide(null,!1,!0)),9===i&&!je.focus_in_input()){for(n=$("modal").down("input[type=text], input[type=email]"),o=$("modal").down(".modal-tabs"),t=o;t&&t.next();)if(t=t.next(),t.visible()){n=t.down("input[type=text], input[type=email]");break}if(n)return e.preventDefault(),n.focus()}},shown:function(){return $("modal").visible()},hide:function(e,n,i){return e&&Event.stop(e),!this.should_prevent_hide()&&(this.prevent_hide_if_loading=!1,this.onHide?void this.onHide(i):(this.onHide=null,Element.hide("modal-behind"),Element.hide("modal-overlay"),$("modal").removeClassName(this.vars.extra_class),n?$("modal").style.marginLeft="-10000000px":Element.hide("modal"),St._cleanup(),this.track_id&&(clearInterval(this.track_id),this.track_id=!1),document.stopObserving("keydown",this.keydownHandler),document.activeElement&&[document,window,document.body].indexOf(document.activeElement)===-1&&$(document.activeElement).blur(),t.setScope(this.vars._prev_scope)))},_cleanup:function(){if(l(document).trigger("modalClosed",[1]),this.scroll_locked)return je.scroll_unlock_document()},should_prevent_hide:function(){return this.prevent_hide_if_loading&&a.some(l("#modal form"),function(e){return e.ajax_submitted})},track_resizes:function(){return this.track_id=setInterval(this.on_resize.bind(this),150)},on_resize:function(){var e;if(e=$("modal").getHeight(),this.old_height!==e||$("modal-behind").getHeight()<e)return this.old_height=e,this.fix_position()},vars:{}};var $t;$t=Ye.SickInput={init:function(){var e,t,n,i,o;for(i=$$(".sick-input"),o=[],t=0,n=i.length;t<n;t++)e=i[t],e.hasClassName("sickified")||o.push(this._create(e));return o},_create:function(e){var t,n,i;if(null!=e)return n=e.identify(),i=e.down("input")||e.down("textarea")||e.down("select"),i.observe("focus",function(){return e.addClassName("focused")}),i.observe("blur",function(){return e.removeClassName("focused")}),t=function(){if(e.hasClassName("populated")&&""===i.getValue()?e.removeClassName("populated"):e.hasClassName("populated")||""===i.getValue()||e.addClassName("populated"),n in $t._handler_map)return $t._handler_map[n]()},kt.show_errors(),t(),setInterval(t,100)},_handler_map:{},add_interval_handler:function(e,t){var n;return n=e.identify(),this._handler_map[n]=t},remove_interval_handler:function(e,t){var n;if(n=e.identify(),this._handler_map[n]===t)return delete this._handler_map[n]}};var Dt;Dt=Ye.TitleBubble=(function(){var e,t,n,i,o,s,r;return r=0,e=0,s=function(e){return r=e},o=function(i){var o,s,a,u,_,c,d,h,m,f,p;return s=l(i.currentTarget),p=s.attr("title"),(null!=p?p.length:void 0)&&(s.attr("data-title",p),s.removeAttr("title")),_=parseInt(s.data("title-delay")),u="title-bubble-"+e++,s.data("bubble-id",u),o=l("<div/>",{id:u,class:"title_bubble_container"}),_||(o.css({opacity:0}),o.addClass("has-transition")),s.hasClass("white")&&o.addClass("white"),s.hasClass("black")&&o.addClass("black"),o.text(s.attr("data-title")),h=s.attr("data-title-html"),o.html(h),f="yes"!==s.attr("data-title-hide-tail"),f&&(a=l("<div/>",{class:"tail"}),o.append(a)),l(document.body).append(o),d=n(s[0],o[0]),c=t(d,o[0],s[0]),je.clone_position(o,s,{setWidth:!1,setHeight:!1,offsetTop:c.top-r,offsetLeft:c.left}),o.addClass("position-"+d),f&&je.clone_position(a,s,{setWidth:!1,setHeight:!1,setTop:!1,offsetLeft:c.left+c.tail_offset_left+l(o).outerWidth()/2}),m=function(){var e;if(o.data("pending-delay")&&s.data("bubble-id")===u)return e=parseInt(s.data("title-fade-time"))||400,o.fadeIn(e)},_?(o.hide(),o.data("pending-delay",!0),setTimeout(m,_)):o.css({opacity:""})},n=function(e,t){var n,i,o;if(e=$(e),o=e.getAttribute("data-title-position"),n=document.viewport.getDimensions(),i=e.viewportOffset(),"above"!==o&&"below"!==o&&"right"!==o&&"left"!==o&&(o="above"),"left"===o){if(i.left<t.width)return"right"}else if("right"===o){if(n.width-(i.left+e.getWidth())<t.width)return"left"}else if("below"===o){if(n.height-(i.top+e.getHeight())<t.height)return"above"}else if("above"===o&&i.top<t.height)return"below";return o},t=function(e,t,n){var i,o,s,r,a,l,u,_,c,d;return t=$(t),n=$(n),s=document.viewport.getDimensions(),i=t.getDimensions(),r=n.viewportOffset(),o=6,a=0,l=0,c=0,d=0,"below"!==e&&"above"!==e||(l="below"===e?n.getHeight()+o:-1*i.height-o,u=n.getWidth()/2-i.width/2,r.left+u+i.width>s.width?(a=s.width-r.left-i.width,c=u-a-5):(a=u,c=-5)),"left"!==e&&"right"!==e||(a="right"===e?n.getWidth()+o:-1*i.width-o,_=n.getHeight()/2-i.height/2,r.top+_+i.height>s.height?(l=s.height-r.top-i.height,d=_-l-5):(l=_,d=-5)),{left:a,top:l,tail_offset_left:c,tail_offset_top:d}},i=function(e){var t,n,i;return n=l(null!=e?e.currentTarget:void 0),t=l("#"+n.data("bubble-id")),t.data("pending-delay")?(t.removeData("pending-delay"),i=parseInt(n.data("title-fade-time"))||400,t.fadeOut(i,function(){return t.remove()})):t.remove()},{init:function(){return l(document).on("mouseenter",".title_bubble",o),l(document).on("mouseleave",".title_bubble",i).on("mouseup",".title_bubble",i),l(document).on("mouseenter",".title_bubble_sticky",o),l(document).on("mouseleave",".title_bubble_sticky",i)},set_vertical_space:s,hide_all:function(){return l(".title_bubble_container").remove()}}})();var At;At=INLINE_JS.Tooltip=Ye.Tooltip={attach:function(e,t,n,i){var o,s;return null==i&&(i={}),e=$(e),n=n?$(n):null,o=Et.make(t,e.tail_position,i.tail_position,i.width,i),o.setStyle({display:"none",position:"absolute"}),$("floaters").__sert(o),e.match("#modal-content *")||e.match(".db-modal-content *")?o.style.zIndex="13001":o.style.zIndex="","right"===e.tail_position&&(s=rt.ie?32:12,o.style.marginLeft=-(o.getWidth()+e.getWidth()+s)+"px"),e.tooltip=o,e.out_target=!!n,e.observe("mouseout",this.mouseout("target",e)),e.observe("mouseover",this.mouseover("target",e)),e.out_trigger=!n,n&&(n.observe("mouseout",this.mouseout("trigger",e)),n.observe("mouseover",this.mouseover("trigger",e))),e.out_tooltip=!0,o.observe("mouseout",this.mouseout("tooltip",e)),o.observe("mouseover",this.mouseover("tooltip",e))},update:function(e,t){if(e.tooltip)return $(e.tooltip).update(t)},mouseover:function(e,t){return function(){return t["out_"+e]=!1}},mouseout:function(e,t){return function(){return t["out_"+e]=!0,At.hide_if_out.defer(t)}},show_by:function(e){var t,n;return t=l(e.tooltip),e=l(e),t.show(),n=Math.floor(t[0].offsetHeight/2),je.clone_position(t,e,{setWidth:!1,setHeight:!1,offsetTop:Math.floor(e[0].offsetHeight/2)-n,offsetLeft:e[0].offsetWidth+1})},hide_if_out:function(e){var t;if(e.out_target&&e.out_trigger&&e.out_tooltip)return t=$(e.tooltip),t.hide()},show:function(e,t,n,i,o){return null==i&&(i="left"),e=$(e),e.tail_position||(e.tail_position=i),n=n?$(n):null,e.tooltip||this.attach(e,t,n,o),this.show_by(e)}};INLINE_JS.TreeView=Ye.TreeView={tv:{},loaded:!1,user:null,role_icon:"",set_params:function(e){return this.ajax_params=e},init:function(e,t,n){var i;return null==n&&(n="treeview"),this.tv[n]={},i=this.tv[n],i.autohide=null===t||t,i.handler=e,i.viewdiv=$(n),i.hidefunc=this.hide.bindAsEventListener(this),this.ajax_params={}},schedule_reset:function(){return this.loaded=!1},reset:function(e){var t,n,i,o,s,r,a;return t={url:"/ajax_subtreeview",data:l.extend({},this.ajax_params),success:(function(t){return function(n){var i,o;i=[];for(o in t.tv)t.tv.hasOwnProperty(o)?(t.tv[o].viewdiv.down(".treeview-folders").update(n),e&&e.onSuccess?i.push(e.onSuccess(n)):i.push(void 0)):i.push(void 0);return i}})(this)},(null!=e?e.user:void 0)?(e.user.id!==(null!=(n=this.user)?n.id:void 0)&&(s=l("<p />",{id:"treeview-loading"}),r=l("<img />",{src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"}),s.append(r),a=" "+ot("Loading your folders"),s.append(a),l("#dest-treeview .treeview-folders").html(s),this.user=e.user),t.subject_user=e.user,o=ke.get_role_title(e.user),i=ke.get_viewer().is_paired?e.user.is_team?"s_briefcase":"s_house":"dropbox",o||(o=ot("Dropbox")),l("#first-treeview-link span").text(o),pe.replace(l("#root-img")[0],"web",this.role_icon,i),this.role_icon=i):l("#first-treeview-link span").text(ot("Dropbox")),d.SilentBackgroundRequest(t)},toggle:function(e,t){var n;return Event.stop(e),n=this.tv[t||"treeview"],n.shown?(n.shown=!1,this.hide(e,t)):(n.shown=!0,this.show(e.target,t)),!1},hide:function(e,t){var n;if(n=this.tv[t||"treeview"],!e||!$(e.target).descendantOf(n.viewdiv))return n.viewdiv.hide(),Event.stopObserving(window,"click",n.hidefunc),n.shown=!1},show:function(e,t){var n,i;return i=this.tv[t||"treeview"],e=$(e),e.blur(),n=e.cumulativeOffset(),i.viewdiv.setStyle({top:n.top+e.getHeight()+"px",left:n.left-4+"px"}),i.viewdiv.show(),Event.observe(window,"click",i.hidefunc)},toggleNode:function(e){var t;return e=$(e),t=e.down("img"),t.className.match("bullet_plus")?pe.replace(t,"web","bullet_plus","bullet_minus"):pe.replace(t,"web","bullet_minus","bullet_plus"),e.up().next("div").toggle(),e.blur(),!1},toggleNodeAjax:function(e,t,n){var i,o;return e.fetched_children?this.toggleNode(e):(e=$(e),i=e.down("img"),o=pe._get(i),i.src="/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",d.SilentBackgroundRequest({url:"/ajax_subtreeview"+t,data:l.extend({},this.ajax_params),subject_user:n,success:(function(t){return function(n){var s;return s=new Element("div",{style:"display: none;"}).update(n),e.up().__sert({after:s}),e.fetched_children=!0,pe._set(i,o),t.toggleNode(e)}})(this),complete:function(){if(/loading/.match(i.src))return pe._set(i,o)}}),!1)},handle:function(e,t){var n,i;if(n=$H(this.tv).keys(),i=$(t).ancestors().find(function(e){return n.include(e.id)}))return i=this.tv[i.id],l(document).trigger("db:treeview_selected",[e]),i.handler&&i.handler(e,t),i.autohide&&this.hide(i.id),!1},move:function(e,t,n){var i;return i=$(e),this.loaded?n&&n.onSuccess&&n.onSuccess():this.reset({onSuccess:(function(i){return function(){return i.loaded=1,i.move(e,t,n)}})(this),user:null!=n?n.user:void 0}),assert(i,"Couldn't find tree_id"),assert($(t),"Couldn't find location_id"),$(t).appendChild(i),i.show()}};Ye.ULSelectMenu=(function(){var e,t,n,i,o,s,r,a,u,_,c;return e=function(e){return e.removeClassName("shown")},c=function(e){return e.toggleClassName("shown")},r=function(){return this.removeClassName("hover")},s=function(){return this.addClassName("hover")},a=function(e,t){var n,i,o,s;for(o=[],n=0,i=t.length;n<i;n++)s=t[n],o.push(e.insert(s));return o},i=function(e,t,n){if(a(e,n),e.firstChild!==t)return e.__sert({top:t})},u=function(e,t){var n;return n="selected",l(e).find("."+n).removeClass(n),l(t).addClass(n)},_=function(e,t){var n,i,o,s,r;for(s=e.select("li"),r=[],i=0,o=s.length;i<o;i++)n=s[i],n.getAttribute("data-value")===t?r.push(u(e,n)):r.push(void 0);return r},o=function(t,n,o){return function(s){return t.hasClassName("selected")?(i(n,t,o),c(n)):(u(n,t),n.fire("db:change",t.getAttribute("data-value")),e(n))}},t=function(t){var n,i,a,l,u,_,c,d;if(l=t.select("li"),assert(l.length,"Empty list of options "+t.identify()),u=void 0,1===l.length)t.addClassName("one");else{for(i=0,a=l.length;i<a;i++)n=l[i],c=n.getAttribute("data-value"),assert(c,n.identify()+" missing data value"),n.observe("click",o(n,t,l)),n.observe("mouseenter",s),n.observe("mouseleave",r),n.hasClassName("selected")&&(u=n);$(document.body).observe("click",function(n){if($(n.target).up(".ul_select_menu")!==t)return e(t)})}return u||(u=l[0]),u.addClassName("selected"),d=new Element("span"),_=u.getDimensions(),d.setStyle({width:_.width+"px",height:_.height+"px",position:"relative",display:"inline-block"}),t.wrap(d)},n=function(){var e,n,i,o,s;for(o=$$(".ul_select_menu"),s=[],n=0,i=o.length;n<i;n++)e=o[n],s.push(t(e));return s},l(n),{init:function(e){return t(e)},set_selected_by_value:_}})();var Nt;Nt=Ye.DBCalendar=Class.create({initialize:function(e,t){return this.options=t||{},this.container=$(e),assert(this.container,"Couldn't find the element"),this.today=new Date,this.options.disable_future&&(this.options.last_day=rt.start_of_day(this.options.last_day||this.today)),this.options.disable_past&&(this.options.first_day=rt.start_of_day(this.options.first_day||this.today)),this.view_date=rt.start_of_day(this.options.selected_date||this.today),this.selected_date=rt.start_of_day(this.options.selected_date||this.today),this.render()},_change_month:function(e,t){return Event.stop(e),this.view_date.setMonth(t),this.render()},is_valid_date:function(e,t,n,i,o){var s;return e=parseInt(e,10),t=parseInt(t,10),n=parseInt(n,10),i=parseInt(i,10),o=parseInt(o,10),i=i||1970,o=o||(new Date).getFullYear()+1,t+=1,!(n<i)&&(!(n>o)&&(!(t<1||t>12)&&(!(e<=0)&&(2===t?(s=n%4===0&&(n%100!==0||n%400===0),s?e<=29:e<=28):4===t||6===t||9===t||11===t?e<=30:e<=31))))},change_date:function(e,t,n){var i;if(this.is_valid_date(e,t,n))return i=n!==this.view_date.getFullYear()||t!==this.view_date.getMonth(),this.selected_date=new Date(n,t,e),i?(this.view_date.setMonth(t),this.view_date.setFullYear(n),this.render()):(l(this.container).find(".selected").removeClass("selected"),l(this.container).find("a#day"+e+"-"+t).addClass("selected")),this.options.onDateChange?this.options.onDateChange(this.selected_date):void 0},render:function(){var e,t,n,i,o,s,r,a,u,_;return t=this.render_days(),i=l(".current-month",t),r=i.first().data("date"),s=i.last().data("date"),_=r<=this.options.first_day,u=s>=this.options.last_day,e=new Element("div"),e.addClassName("calendar clearfix"),u||(this._next_month=function(e){return this._change_month(e,this.view_date.getMonth()+1)}.bind(this),o=new Element("a"),o.addClassName("changemonth next"),o.update(pe.make("web","arrowright",{})),Event.observe(o,"click",this._next_month),e.__sert(o)),_||(this._prev_month=function(e){return this._change_month(e,this.view_date.getMonth()-1)}.bind(this),a=new Element("a"),a.addClassName("changemonth prev"),a.update(pe.make("web","arrowleft",{})),Event.observe(a,"click",this._prev_month),e.__sert(a)),n=new Element("h5"),n.update(ot("%(month)s %(year)s",{comment:"For example 'January 2010'. This is used as part of a calendar."}).format({month:E.month_name(this.view_date.getMonth()),year:this.view_date.getFullYear()})),e.__sert(n),e.__sert(t),this.container.__date(e)},render_days:function(){var e,t,n,i,o,s,r,a,l;for(t=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),1),a=t.getDay(),e=new Element("div"),e.addClassName("days"),n=o=l=a;l<=0?o<0:o>0;n=l<=0?++o:--o)r=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r.setDate(r.getDate()-n),e.__sert(this.render_day(r,!0));for(i=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),1);i.getMonth()===this.view_date.getMonth();)e.__sert(this.render_day(i)),i=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),i.getDate()+1);for(s=new Date(this.view_date.getFullYear(),this.view_date.getMonth()+1,0);6!==s.getDay();)s=new Date(s.getFullYear(),s.getMonth(),s.getDate()+1),e.__sert(this.render_day(s,!0));return e},render_day:function(e,t){var n,i;return i=!t,this.options.last_day&&(t=t||e>this.options.last_day),this.options.first_day&&(t=t||e<this.options.first_day),n=new Element(t?"span":"a"),l(n).data("date",e),i&&n.addClassName("current-month"),n.update(e.getDate()),n.addClassName("date"),n.writeAttribute("id","day"+e.getDate()+"-"+e.getMonth()),this.selected_date.getDate()===e.getDate()&&this.selected_date.getMonth()===e.getMonth()&&this.selected_date.getFullYear()===e.getFullYear()&&n.addClassName("selected"),t?n.addClassName("inactive"):(this._handler=function(e){var t;return t=e.target.identify().substr(3).split("-"),this.change_date(t[0],this.view_date.getMonth(),this.view_date.getFullYear())}.bind(this),Event.observe(n,"click",this._handler)),n}});Ye.DatePickerInput=Class.create({initialize:function(e,t){var n;return this.container=e,this.options={},Object.extend(this.options,t||{}),this.input=this.container.down(".input-date"),this.display=this.container.down(".visible-date"),this.cal_container=this.container.down(".cal-container"),this.container.observe("click",this.show_cal.bindAsEventListener(this)),$(document.body).observe("click",this.hide_cal.bind(this)),n=this.input.value?rt.from_mysql_date(this.input.value):new Date,this.onDateChange(n)},init_cal:function(){var e,t,n,i;if(!this.calendar)return i=this.input.value?rt.from_mysql_date(this.input.value):new Date,this.container.hasAttribute("data-first")&&(n=rt.from_mysql_date(this.container.getAttribute("data-first"))),e=null==this.options.disable_future||this.options.disable_future,t=null==this.options.disable_past||this.options.disable_past,this.calendar=new Nt(this.cal_container,{onDateChange:this.onDateChange.bind(this),first_day:n,disable_future:e,disable_past:t,selected_date:i})},show_cal:function(e){var t;if(e&&Event.stop(e),t=$(e.target),!t.match(".cal-container")&&!t.up(".cal-container"))return l(".cal-container").hide(),this.init_cal(),this.cal_container.show()},hide_cal:function(){return this.cal_container.hide()},onDateChange:function(e){return this.input.value=rt.to_mysql_date(e,!1),this.display.update(rn.localize(e)),this.hide_cal()}});Ye.TextInputDatePicker=Class.create({initialize:function(e,t){var n,i,o,s;return this.options={include_seconds:!0,include_microseconds:!0,choose_eod:!1},Object.extend(this.options,t||{}),this.input=$(e),assert(this.input,"Couldn't find the element "+e.toString()),o=new Date,s=!!this.input.value&&rt.from_mysql_date(this.input.value),i=new Date(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate()),this.cal_icon=pe.make("web","calendar_view_month",{align:"absmiddle"}),this.cal_container=new Element("div",{id:"cal_container_"+e,style:"display: none; position: absolute; z-index: 1"}),this.calendar=new Nt(this.cal_container,{onDateChange:this.onDateChange.bind(this),last_day:i,selected_date:s}),this.input.__sert({after:this.cal_icon}),this.cal_icon.observe("click",this.toggle_cal.bindAsEventListener(this)),n=l(this.input),je.clone_position(l(this.cal_container),n,{setWidth:!1,setHeight:!1,offsetTop:n[0].offsetHeight}),this.cal_icon.__sert({after:this.cal_container})},toggle_cal:function(e){return e&&Event.stop(e),this.cal_container.toggle()},hide_cal:function(e){return e&&Event.stop(e),this.cal_container.hide()},onDateChange:function(e){return this.options.choose_eod&&e.setTime(rt.start_of_day(e).getTime()+86399999),this.input.value=rt.to_mysql_date(e,this.options.include_seconds,this.options.include_microseconds),this.hide_cal()}}),I.window_load(xt.register.bind(xt)),l($t.init.bind($t)),Event.observe(window,"scroll",function(){return Dt.hide_all()}),l(function(){return Tt.interval=setInterval(Tt.check.bind(Tt),500),Dt.init()});var It;It=INLINE_JS.BonusTable=Ye.BonusTable={_tmpl:null,_inited:null,_next_page:0,_fetching_page:!1,init:function(e){if(this.user_id=e,!It._inited&&$("bonus-loading"))return It._inited=!0,$("bonus-loading").show(),It._tmpl=Fe.tmpl("bonus_row_tmpl"),It.listen(),It.get_next_page()},_render:function(e){var t,n,i,o;for(t=[],n=0,i=e.length;n<i;n++)o=e[n],t.push(It._tmpl({row:o,Sprite:pe}));return $("bonus-table").__sert(t)},get_next_page:function(){if(!It._fetching_page)return It._fetching_page=!0,new Ajax.DBRequest("/account/bonus_page/"+It._next_page,{onSuccess:function(e){var t,n,i;return t=e.responseText.evalJSON(),i=t.rows,n=t.has_more,It._render(i),$("bonus-loading").hide(),n?(It._next_page+=1,$("load-more-bonus").show()):$("load-more-bonus").hide(),It._fetching_page=!1},subject_user:this.user_id})},_max_referral_over:function(e){var t,n,i;return n=l(e.currentTarget),i=ot("You've earned the maximum amount of referral space. Thanks for inviting people to Dropbox!"),t=l(Et.make(i,"right","middle")),Element.absolutize(t[0]),n.append(t),je.clone_position(t,n,{setWidth:!1,setHeight:!1}),t.css({width:"200px",left:parseInt(t.css("left"),10)-210+"px",top:parseInt(t.css("top"),10)-55+"px"})},_max_referral_out:function(e){var t,n,i,o,s;for(o=l(".reached-max-referral-bonus .bubble"),s=[],n=0,i=o.length;n<i;n++)t=o[n],s.push(t.remove());return s},listen:function(){return l("#load-more-bonus").on("click",It.get_next_page.bind(It)),l(document).on("mouseenter",".reached-max-referral-bonus",It._max_referral_over),l(document).on("mouseleave",".reached-max-referral-bonus",It._max_referral_out)},toggle:function(){return l("#bonus-list").is(":visible")?(this.hide(),l("#space-earned-link").text(ot("View all space earned"))):(this.show(),l("#space-earned-link").text(ot("Hide space earned")))},show:function(){return l("#bonus-list").slideDown(150)},hide:function(){return l("#bonus-list").slideUp(150)}};var Rt;INLINE_JS.DowngradeReasons=Ye.DowngradeReasons={reasons:{},addReason:function(e){return this.reasons[e]=!0},addReasons:function(e){var t,n,i,o;for(o=[],t=0,i=e.length;t<i;t++)n=e[t],o.push(this.addReason(n));return o},change:function(e,t,n){var i,o,s,r,a,l;e=parseInt(e,10),o=$(t),assert(o,"Couldn't find container for DowngradeReason"),i=!1,a=this.reasons;for(r in a)s=a[r],l=$(n+r),assert(l,"Couldn't find container for "+(n+r)),s&&parseInt(r,10)===e?(l.show(),i=!0):l.hide();return i?o.show():o.hide()}},Rt=Ye.DowngradeReasons2={init:function(){var e,t,n,i;for(i=["input[name=downgrade_reason_id]","input[name=other_reason_id]"],e=0,t=i.length;e<t;e++)n=i[e],l(n).change(function(e){var t;return t=e.target.id.indexOf("other")>=0,Rt.change(t,e.target.getValue())});return l(".shared-additional-info").attr("name","shared_additional_info")},change:function(e,t){var n;if(l(".downgrade-other-reason .error-message").hide(),!e)return n="#downgrade-info-"+t,l(".downgrade-info").hide(),l(n).show(),l(".downgrade-info textarea").removeAttr("name"),l(n+" textarea").attr("name","additional_info"),l("input[name=other_reason_id]").removeAttr("checked")}},Ye.DowngradeSurvey={init:function(){var e;return e="#downgrade-survey-form",l(""+e).on("submit",(function(t){return function(t){var n,i;if(i=l(e+" input[name=other_reason_id]:checked").length,n=l(e+" input[id=downgrade-radio-8]"),n.is(":checked")&&0===i)return l(".downgrade-other-reason .error-message").show(),t.preventDefault()}})(this))}},Ye.TrialDowngradeReasons={init:function(){return l(document).on("click",".reasons-option",function(e){var t,n,i,o;if(i=e.target.getValue(),o=e.target.name,"other_reason_id"===o&&(n="#other-info-"+i,l(".other-info").hide(),l(n).show()),"downgrade_reason_id"===o)return t="#downgrade-info-"+i,l(".downgrade-info").hide(),l(t).show()}),l("#downgrade-survey-form").on("submit",function(e){var t,n;return n=l("#downgrade-survey-form input[id=downgrade-radio-207]"),n.is(":checked")&&0===l(".q1-other-reason.textinput").val().length?(l(".trial-downgrade--error-message").show(),void e.preventDefault()):(t="",l(".reasons-option:checked").each(function(e,n){var i,o,s;if(i=n.getValue(),o=l("#downgrade-info-"+i+" textarea").val(),s=l("#other-info-"+i+" textarea").val(),(null!=o?o.length:void 0)>0&&(t=i+":"+o),(null!=s?s.length:void 0)>0)return t=t+" "+i+":"+s}),l(".downgrade-info textarea").removeAttr("name"),l(".other-info textarea").removeAttr("name"),l('#downgrade-survey-form input:hidden[name="additional_info"]').val(t))})}};var Ot;Ot=INLINE_JS.GetSpace=Ye.GetSpace={_current_space:null,_why_msg:null,_twitter_url:null,offer_highlight_color:"#ffa",init:function(e,t,n){var i;if(Ot._current_space=e,Ot._why_msg=t,Ot._twitter_url=n,$("space-actions").on("click",".space-action",Ot.perform_action),i=ze.parse(window.location.href).fragment)return Ot.highlight_offer(i)},highlight_offer:function(e){var t,n;return t=l("#"+e),n=t.css("background-color"),t.css("background-color",Ot.offer_highlight_color).delay(2e3).animate({"background-color":n}).queue(function(){return t.css("background-color","")})},perform_action:function(e){var t,n;return e.preventDefault(),n={contact_sales:Ot._contact_sales,contact_support:Ot._contact_support,teams:Ot._teams,upgrade:Ot._upgrade,plans:Ot._plans,refer:Ot._refer,get_started:Ot._get_started,fb_link:Ot._fb_link,twitter_follow:Ot._twitter_follow,why_like:Ot._why_like,mailbox_link:Ot._mailbox_link},t=$(e.target),t.hasClassName("space-action")||(t=t.up(".space-action")),n[t.id]()},_teams:function(){return window.location.href="/business?tk=dropbox&ag=getspace&ad=v1"},_contact_sales:function(){return window.location.href="mailto:sales@dropbox.com"},_contact_support:function(){return window.location.href="/support"},_plans:function(){return window.location.href="/plans"},_upgrade:function(){return window.location.href="/upgrade"},_refer:function(){return window.location.href="/referrals"},_get_started:function(){return window.location.href="/gs"},_fb_link:function(){return b.do_auth(function(){return Ot._refresh_link_bonuses(),Ot._completed($("fb_link"))},ke.get_viewer().personal_user.id)},_twitter_follow:function(){return ln.do_auth_and_follow_dropbox(ke.get_viewer().personal_user.id)},_why_like:function(){return St.show(ot("Tell us why you love Dropbox"),$("why-i-like-modal")),$("why-i-like-input").focus(),rt._track_twitter_chars_left("why-i-like-input",90)},_mailbox_link:function(){return window.location.href="http://www.mailboxapp.com/"},submit_why:function(){return Ot._why_msg=$F("why-i-like-input"),kt.ajax_submit($("why-i-like-form"),!1,function(){return St.hide(),Ot._completed($("why_like"))},!1,$("why-i-like-submit"))},_completed:function(e){var t,n;return e.addClassName("completed"),null!=(n=e.down(".icon-col"))&&n.__date(Element("img",{src:"/static/images/check_36-vflimxFPn.png"})),l(e).css("opacity",.5).fadeTo(500,1),setTimeout(function(){return l(e).css("opacity",1).slideUp().animate({opacity:0},{queue:!1,duration:"normal"})},1500),t=parseInt(e.down(".space").readAttribute("data-space"),10),Ot._current_space+=t,$("current-space").__date(D.format_bytes(Ot._current_space)),$("current-space").addClassName("updated"),setTimeout(function(){return $("current-space").removeClassName("updated")},5e3)},_refresh_link_bonuses:function(){return new Ajax.DBRequest("/social_recheck")}};Ye.Help={toggle_more_help:!1,show_os:function(e,t,n){return t=$(t),$$(".os-filter").invoke("removeClassName","selected"),t.addClassName("selected"),$$(".help-os-section").invoke("hide"),$$(".help-os-"+n).invoke("show"),Event.stop(e)},vote:function(e,t){return new Ajax.DBRequest("/help/"+e+"/vote/"+t),l("#help-vote-cont").fadeOut(),Pe.success(ot("Thanks for your feedback!"))}};var Lt,vt=function(e,t){return function(){return e.apply(t,arguments)}},wt=function(e,t){function n(){this.constructor=e}for(var i in t)bt.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},bt={}.hasOwnProperty;Lt=Ye.DeleteFailuresModal=(function(e){function t(){return this.on_show=vt(this.on_show,this),this.on_confirm_button_click=vt(this.on_confirm_button_click,this),t.__super__.constructor.apply(this,arguments)}return wt(t,e),t.prototype.on_confirm_button_click=function(e){
return e.preventDefault(),window.location.href="/delete_failures?host_id="+this.host_id,this.hide()},t.prototype.on_show=function(e){var t;return t=it("Dropbox couldn't delete %(num_failures)d file from the computer <strong>%(host_name)s</strong>. You can download the name of this file and the reason why it couldn't be deleted.","Dropbox couldn't delete %(num_failures)d files from the computer <strong>%(host_name)s</strong>. You can download the names of these files and the reasons why they couldn't be deleted.",this.num_failures).format({host_name:this.name.escapeHTML(),num_failures:this.num_failures}),this.$modal_window.find(".failures_message").html(t)},t})(Ge),INLINE_JS.show_delete_failures_modal=Ye.show_delete_failures_modal=function(e,t,n){var i;return i=new Lt({element_id:"delete-failures-modal"}),i.host_id=e,i.name=t,i.num_failures=n,i.show(),!1};var Mt;Mt=Ye.News={DEFAULT_TAB:"recent-news",init:function(){return $("news-home").on("click","#nav a",function(e,t){var n;if(t.hasAttribute("data-div"))return e.preventDefault(),n=t.readAttribute("data-div"),q.push_state("/news/"+n)}),q.add_callback("/news",Mt.history_change)},change_tab:function(e){var t;if(t=$$("#nav a[data-div="+e+"]").first(),$(t))return $$(".section").invoke("removeClassName","selected"),$$("#nav a").invoke("removeClassName","selected"),$(t).addClassName("selected"),$(e).addClassName("selected")},history_change:function(e){return e=e||Mt.DEFAULT_TAB,Mt.change_tab(e)}};Ye.Recover={init:function(){var e;return e=$("recover-form"),e.observe("submit",this.form_submit.bind(this))},form_submit:function(e){return this.clear_error(),e.preventDefault(),kt.ajax_submit($("recover-form"),null,this.submit_response.bind(this))},submit_response:function(e){var t;if(t=JSON.parse(e.responseText),"error"===t.status&&this.show_error(t.msg),"ok"===t.status&&this.show_hosts(t),"redirect"===t.status)return window.location.href=t.url},show_hosts:function(e){var t,n,i,o,s,r,a;for(kt.add_vars($("recover-form"),{check_file:"true"}),$("filename-to-create").update(e.filename),n=$("trusted-hosts"),n.update(),a=e.hosts,i=0,s=a.length;i<s;i++)t=a[i],r=new Element("li"),o="lnx","mac"===t.platform&&(o="osx"),"win"===t.platform&&(o="win"),r.__sert(pe.make("web",o)),r.__sert(new Fe(t.display_name.escapeHTML())),n.appendChild(r);return $("login-step").hide(),$("hosts-step").show()},show_error:function(e){return $("error-messages").update(e),$("error-messages").show()},clear_error:function(){return $("error-messages").update()}};var jt;jt=Ye.Restore={next:function(e,t){var n,i;return i=l("ul.selected"),n=i.next("ul"),n.addClass("selected"),i.removeClass("selected"),n.next("ul").length?l("#next-page").show():l("#next-page").hide(),l("#prev-page").show(),jt.inc_page(1)},prev:function(e,t){var n,i;return i=l("ul.selected"),n=i.prev("ul"),n.addClass("selected"),i.removeClass("selected"),n.prev("ul").length?l("#prev-page").show():l("#prev-page").hide(),l("#next-page").show(),jt.inc_page(-1)},inc_page:function(e){var t,n;return t=parseInt(l("#page_num").text(),10),n=t+e,l("#page_num").text(n)},init:function(e,t,n){var i;return i=ke.get_viewer().get_user_by_id(n),l("#next-page").on("click",function(e){return jt.next(e),!1}),l("#prev-page").on("click",function(e){return jt.prev(e),!1}),l("#restore-submit-button").on("click",function(t){return yt.do_folder_restore(e,i),!1}),l("#restore-cancel-button").on("click",function(e){return Oe.redirect(t)}),l("#restore-back-button").on("click",function(e){return Oe.redirect(t)})}};var Ut,Ft,qt,vt=function(e,t){return function(){return e.apply(t,arguments)}},wt=function(e,t){function n(){this.constructor=e}for(var i in t)bt.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},bt={}.hasOwnProperty;Ut=Ye.SelectRoleModal=(function(e){function t(){return this.on_show=vt(this.on_show,this),t.__super__.constructor.apply(this,arguments)}return wt(t,e),t.prototype.on_select_role=null,t.prototype.on_show=function(){return l(".role-options li").click((function(e){return function(t){var n,i;return n=l(t.target).closest("li"),i=n.data("role"),assert(e.on_select_role,"missing on_select_role implementation"),e.on_select_role(i),e.hide()}})(this))},t})(Ge),qt=Ye.ShmodelC2DSelectRoleModal=(function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return wt(t,e),t.prototype.on_select_role=function(e){var t;return t=function(){return pt.show_c2d_modal(e)},ke.get_viewer().is_role_signed_in(e)?t():W.show_modal({role:e,on_success:t})},t})(Ut),Ft=Ye.ShareShmodelSelectRoleModal=(function(e){function t(){return this.on_select_role=vt(this.on_select_role,this),t.__super__.constructor.apply(this,arguments)}return wt(t,e),t.prototype.on_select_role=function(e){return pt.prompt_login_then_share(this.options.link_url,this.options.short_url,this.options.tokenizer_type,e)},t})(Ut);Ye.TabController=Class.create({initialize:function(e,t){var n;return n=$(e),assert(n,e+" is missing."),this.container=n,this.options={killEvent:!0},Object.extend(this.options,t),this.listen()},listen:function(){var e,t,n,i,o,s;for(s=this,i=this.container.select("a"),o=[],t=0,n=i.length;t<n;t++)e=i[t],assert(e.id&&e.id.length>0,"Element is missing an id"),o.push(e.observe("click",function(e){return this.click(e)}.bindAsEventListener(s)));return o},click:function(e){return this.options.killEvent&&Event.stop(e),this.toggle($(e.target))},toggle:function(e){var t,n,i,o,s;if(s=this.container.down("a.selected"),s&&(o=$(s.id+"-content"),o&&o.hide()),this.container.select(".selected").invoke("removeClassName","selected"),n=!1,e||(e=this.container.down("a"),n=!0),e.addClassName("selected"),t=$(e.id+"-content"),t&&t.show(),this.options.onTabChange&&this.options.onTabChange(e,s),this.options.url_prefix)return i=this.options.url_prefix,n||(i+="/"+e.id),q.push_state(i)}});var Pt,zt,Bt,Ht,Yt,Wt,Vt,Kt,Gt,Jt,Xt,Zt,Qt,en,tn,nn,vt=function(e,t){return function(){return e.apply(t,arguments)}},wt=function(e,t){function n(){this.constructor=e}for(var i in t)bt.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},bt={}.hasOwnProperty;Be(["modules/core/browser"],function(e){}),Gt={ACTIVE:1,PENDING:2,ERROR:3,REMOVED:4,SUSPENDED:5},nn=function(){var e,t,n,i,o,s,r,a,u,_,c,h,m,f,p,g,v,w;for(i=l(".feature-list .enroll-button"),t=l(".feature-list .disenroll-button"),n=l(".feature-list .enroll-button-admins"),s=l(".feature-list .feedback-button"),r=l(".generate-smart-sync-hosts-report"),a=0,h=i.length;a<h;a++)e=i[a],o=l(e).data("feature"),l(e).click((function(e){return function(){return new Bt(e,!0).show()}})(o)),e.disabled=!1;for(u=0,m=n.length;u<m;u++)e=n[u],o=l(e).data("feature"),l(e).click((function(e){return function(){return new Bt(e,!1).show()}})(o)),e.disabled=!1;for(_=0,f=t.length;_<f;_++)e=t[_],o=l(e).data("feature"),l(e).click((function(e){return function(){return new zt(e,!0).show()}})(o)),e.disabled=!1;for(c=0,p=s.length;c<p;c++)e=s[c],o=l(e).data("feature"),l(e).click((function(e){return function(){return new Ht(e).show()}})(o));for(w=[],v=0,g=r.length;v<g;v++)e=r[v],w.push(l(e).click((function(e){return function(){return d.WebRequest({url:"/team/smartsync/hosts/csv",data:{team_id:e.team_id,tzoffset:(new Date).getTimezoneOffset().toString()},dataType:"json",success:function(e){return 0===e.status?Pe.success(ot("Report started. Well email you when its ready.")):(console.error("Unexpected status from /team/smartsync/hosts/csv: "+e),Pe.error(ot("There was a problem completing this request.")))}})}})(this)));return w},Zt=INLINE_JS.Team=Ye.Team={_use_async_reset:!1,team_id:ke.get_viewer().team_id,set_team_id:function(e){this.team_id=e},setup_beta_modal_listeners:nn,init_admin:function(){return Dt.set_vertical_space(2),l("form.activity-report-generator").submit(this.submit_report_form.bind(this))},init_team_name_change_notice:function(){return l(".team_name_change_notice .hide_link").click((function(e){return function(t){return e.hide_team_name_change_banner()}})(this))},show_demo_signup_modal:function(e,t,n,i,o){var s,r,a,l;return this.webinar_key=e,this.webinar_iso_datetime=t,this.webinar_date=n,this.webinar_title=i,this.tab_url=o,l=ot("Register for a webinar on %(start_time)s").format({start_time:this.webinar_date}),r=new Yt({element_id:"demo-signup-modal",title:l}),r.show(),r.$modal_window.find("input[name=webinar_key]").attr("value",this.webinar_key),r.$modal_window.find("input[name=webinar_title]").attr("value",this.webinar_title),r.$modal_window.find("input[name=Sales_Webinar_Topic__c]").attr("value",this.webinar_title),r.$modal_window.find("input[name=Sales_webinar_date__c]").attr("value",this.webinar_iso_datetime),a=r.$modal_window.find("input[name=retURL]"),a.attr("value",a.val()+"#"+this.tab_url),s=r.$modal_window.find("#demo-signup-form")[0],s.on("submit",r.on_confirm_button_click)},show_unsuspend_modal:function(e,t,n,i){var o;return o=new Kt({element_id:"dfe-unsuspend-modal",focus:"confirm"}),o.user_name=e||n,o.email=n,o.user_id=t,o.team_id=this.team_id,o.refresh_cb=i,o.show(),!1},show_remove_or_deactivate_modal:function(e,t,n,i,o,s,r,a,l){var u;return u=new Wt({element_id:"dfe-remove-or-deactivate-user-modal",focus:".new-collab-input"}),u.user_name=t||i,u.email=i,u.user_id=n,u.team_id=this.team_id,u.invited=o,u.limited=r,u.num_api_apps=s,u.hide_transfer_wipe=a,u.refresh_cb=l,u.show(),!1},show_remove_modal:function(e,t,n,i,o,s,r,a,l,u){var _;return _=new Vt({element_id:"dfe-remove-user-modal",focus:".new-collab-input"}),_.user_name=t||i,_.email=i,_.user_id=n,_.team_id=this.team_id,_.invited=o,_.num_api_apps=s,_.hide_transfer_setting=r,_.hide_remote_wipe_setting=a,_.refresh_cb=u,_.user_is_managed=l,_.show(),!1},show_reinvite_modal:function(e,t,n,i){var o;return at.fillVal(i,"reinvite-user-email"),at.fillVal(t,"reinvite-user-team"),o=ot("Resend invite to '%(email_address)s'").format({email_address:N.em_snippet(i,18)}),St.show(o,$("reinvite-user-modal"),{user_id:n,button:e})},email_verification:this.email_verification=new We("work"),show_email_verification_modal:function(){return this.email_verification.show_verify_modal(null,c.NEW_DFB_TEAM_BUY)},reinvite_user:function(e){var t;return Event.stop(e),t=St.vars.user_id,new Ajax.DBRequest("/account/team/reinvite_user",{parameters:{team_id:this.team_id,user_id:t},onSuccess:function(e){var t;return Pe.success(ot("Invite sent.")),null!=(t=$("team-member-info"))?t.update(e.responseText):void 0},cleanUp:function(){return St.hide()}})},show_request_license_modal:function(e,t){var n;return n=ot("Send upgrade request?"),St.show(n,$("request-license-modal"),{user_id:t,button:e})},request_license:function(e){var t;return Event.stop(e),t=St.vars.user_id,new Ajax.DBRequest("/team/request_license",{parameters:{team_id:this.team_id,user_id:t},onSuccess:function(e){return l("#request_license_text").hide(),l("#request-license-section").hide(),Pe.success(ot("Request sent."))},cleanUp:function(){return St.hide()}})},show_user_activity_log_modal:function(e,t,n){var i;return i=l("#activity-log-modal"),i.find(".activity-log-email").text(t),i.find(".activity-log-name").text(n),i.find("#activity-log-user-message").show(),St.show(ot("Create activity report"),i[0],{user_id:e})},show_team_activity_log_modal:function(e,t){var n;return n=l("#activity-log-modal"),n.find(".activity-log-email").text(e),n.find(".activity-log-name").text(t),n.find("#activity-log-team-message").show(),St.show(ot("Create full activity report"),n[0])},generate_activity_log:function(e){var t,n,i,o,s,r,a;return Event.stop(e),n=l("#activity-log-modal"),i=n.find("input[name='from_date']").val(),s=n.find("input[name='to_date']").val(),i>s?void Pe.error(ot("Your start date is after your end date.")):(o=this.team_id,a=St.vars.user_id,r=(new Date).getTimezoneOffset().toString(),t=l(".activity-report-generator .freshbutton-blue"),t.prop("disabled",!0),new Ajax.DBRequest("/team/events_report/csv",{parameters:{from_date:i,to_date:s,team_id:o,user_id:a,tzoffset:r},onSuccess:function(e){return Pe.success(ot("Report started. We'll email you when it's ready."))},cleanUp:function(){return St.hide(),t.prop("disabled",!1)}}))},show_reset_password_modal:function(e,t,n){var i,o;return o=ze({path:"/team/admin/members/member",query:{id:n}}).toString(),l("#reset-password-modal .member-name").text(t),l("#reset-password-modal .member-page-link").attr("href",o),i=ot("Reset password for '%(user_name)s'").format({user_name:t}),St.show(i,$("reset-password-modal"),{user_id:n,button:e})},reset_password:function(e){var t;return Event.stop(e),t=St.vars.user_id,new Ajax.DBRequest("/account/team/reset_password",{parameters:{team_id:this.team_id,user_id:t},onSuccess:function(e){return Pe.success(ot("User's password reset."))},cleanUp:function(){return St.hide()}})},show_admin_status_modal:function(e,t,n,i,o,s){var r,a,l,u;return a=o.trim()||i,l=void 0,r=void 0,u=void 0,s?(u=ot("Add admin permissions for '%(person_name)s'").format({person_name:a.escapeHTML()}),l=ot("Are you sure you want to add admin permissions for <strong>%(person_name)s</strong>?").format({person_name:a.escapeHTML()}),r=ot("Add admin permissions",{comment:"make this user an admin; give them the permissions an admin has"})):(u=ot("Remove admin privileges from '%(person_name)s'").format({person_name:a.escapeHTML()}),l=ot("Are you sure you want to remove admin permissions from <strong>%(person_name)s</strong>?").format({person_name:a.escapeHTML()}),r=ot("Remove admin permissions",{comment:"clicking this button completes the action: it removes a person's admin status"})),at.fillVal(i,"admin-status-email"),at.fillVal(l,"admin-status-action"),at.fillVal(r,"admin-status-button-action"),St.show(u,$("admin-status-modal"),{user_id:n,button:e,admin_on:s}),!1},set_admin_status:function(e){var t;return Event.stop(e),t=St.vars.user_id,new Ajax.DBRequest("/account/team/set_admin_status",{parameters:{team_id:this.team_id,user_id:t,on:St.vars.admin_on?"yes":"no"},onSuccess:function(e){return ot(St.vars.admin_on?"User's admin status granted.":"User's admin status removed."),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():St.vars.admin_on?window.location="/team/admin/members/member?id=%d&msg=granted".format(St.vars.user_id):window.location="/team/admin/members/member?id=%d&msg=removed".format(St.vars.user_id)},cleanUp:function(){return St.hide()}})},show_disable_2fa_modal:function(e,t,n){return l("#disable-2fa-modal .member-name").text(n),St.show(ot("Disable two-step verification"),$("disable-2fa-modal"),{user_id:t,elm:e})},show_reset_2fa_modal:function(e,t,n){return l("#reset-2fa-modal .member-name").text(n),St.show(ot("Reset two-step verification"),$("reset-2fa-modal"),{user_id:t,user_name:n,elm:e})},reset_2fa:function(){return new Ajax.DBRequest("/account/team/reset_2fa",{parameters:{team_id:this.team_id,user_id:St.vars.user_id},onSuccess:function(e){var t;return l(".tfa_enabled").replaceWith(ot("Disabled")),t=JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():__CIRCULAR_DEPENDENCY__.MemberActionsMenu&&__CIRCULAR_DEPENDENCY__.MemberActionsMenu.update_container_users(".buttons",t),Pe.success(ot("Two-step verification reset for %(user_name)s").format({user_name:St.vars.user_name})),St.hide()}})},disable_2fa:function(){return new Ajax.DBRequest("/account/team/disable_2fa",{parameters:{team_id:this.team_id,user_id:St.vars.user_id},onSuccess:function(e){var t;return l(".tfa_enabled").replaceWith(ot("Disabled")),t=JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():__CIRCULAR_DEPENDENCY__.MemberActionsMenu&&__CIRCULAR_DEPENDENCY__.MemberActionsMenu.update_container_users(".buttons",t),Pe.success(ot("Two-step verification disabled.")),St.hide()}})},show_user_message_modal:function(e,t,n){var i;return at.fillVal(n,"user-message-email"),i=ot("Send email to '%(user_name)s'").format({user_name:e}),$("user-message").value="",St.show(i,$("user-message-modal"),{user_name:e,user_id:t}),rt.focus.defer("user-message")},send_user_message:function(){var e,t;return t=St.vars.user_id,e=$F("user-message").trim(),new Ajax.DBRequest("/account/team/send_user_message",{parameters:{user_id:t,team_id:this.team_id,message:e},onSuccess:function(){var e;return e=St.vars.user_name,Pe.success(ot("Message successfully sent to %(user_name)s.").format({user_name:e})),St.hide()}})},hide_team_name_change_banner:function(){return new Ajax.DBRequest("/account/team/name_change_notice_received",{parameters:{team_id:this.team_id}}),l(".team_name_change_notice").hide(),!1},hide_pin_banner:function(){return new Ajax.DBRequest("/team/invalidate_pin"),l(".pin_notice").hide()},hide_pin_banner_with_user_id:function(e,t){var n;return n=function(e){return l(t).closest("span").removeClass("on").addClass("off")},null===e?new Ajax.DBRequest("/team/invalidate_pin",{onSuccess:n}):new Ajax.DBRequest("/team/invalidate_pin",{parameters:{user_id:e},onSuccess:n})},get_pin_with_user_id:function(e,t,n){var i;return null==n&&(n=null),null===n&&(n=function(e,t){return l(t).closest("span").find(".pin-value").text(e.pin+" -"),l(t).closest("span").removeClass("off").addClass("on")}),i=function(e){var i;return i=JSON.parse(e.responseText),n(i,t)},null===e?new Ajax.DBRequest("/team/generate_pin",{onSuccess:i}):new Ajax.DBRequest("/team/generate_pin",{parameters:{user_id:e},onSuccess:i})},send_team_message:function(e){var t;if(Event.stop(e),t=$F("team-message").trim())return new Ajax.DBRequest("/account/team/send_team_message",{parameters:{team_id:this.team_id,message:t},onSuccess:function(e){return Pe.success(ot("Message successfully sent to team.")),St.hide()}})},show_security_message_modal:function(){return(new Qt).show()},send_team_security_message:function(e){var t;return Event.stop(e),$F("team-security-message").trim(),t=$("team-security-message-form"),new Ajax.DBRequest("/account/team/send_team_message",{parameters:t.serialize(!0),onSuccess:function(e){return Pe.success(ot("Message successfully sent.")),St.hide()}})},used_licenses:0,total_licenses:0,set_used_licenses:function(e,t){return this.used_licenses=e,this.total_licenses=t},decrement_used_licenses:function(){return this.set_used_licenses(this.used_licenses-1,this.total_licenses)},show_migration_link:function(e,t){return $("migration-url").value=t,St.show(ot("Migration link for '%(email)s'").format({email:N.em_snippet(e,18)}),$("migrate-url-modal")),$("migration-url").select()},show_end_session_modal:function(e,t,n){return Dt.hide_all(),l("#end-session-modal .member-name").text(l("#member-name").text()),St.show(ot("Close web session",{comment:"Log out of your current Dropbox web session"}),$("end-session-modal"),{login_id:e,user_id:t,elm:n})},end_session:function(){return new Ajax.DBRequest("/logout_remote_session",{parameters:{remote_login_id:St.vars.login_id,team_id:this.team_id,user_id:St.vars.user_id},onSuccess:function(){return St.hide(),Zt.remove_closest_row(St.vars.elm),Pe.success(ot("Web session closed."))}})},unlink_device:function(e,t,n,i,o,s,r){var a,l;return Dt.hide_all(),a=$("unlink-device-modal-"+s),l=ot("Unlink %(device_name)s").format({device_name:n}),St.show(l,a,{app_id:t,user_id:o,elm:r,device_id:e,display_name:n})},unlink_device_submit:function(){return new Ajax.DBRequest("/account/unlink_team_device",{parameters:{app_id:St.vars.app_id,team_id:this.team_id,user_id:St.vars.user_id,device_id:JSON.stringify(St.vars.device_id)},subject_user:ke.get_viewer().work_user,onSuccess:function(){return St.hide(),Zt.remove_closest_row(St.vars.elm),Pe.success(ot("%(device_name)s unlinked.").format({device_name:St.vars.display_name}))}})},disable_app:function(e,t,n,i){return Dt.hide_all(),l("#disable-app-modal .app-name").text(t),l("#disable-app-modal .member-name").text(l("#member-name").text()),St.show(ot("Disable '%(app_name)s'?").format({app_name:t}),$("disable-app-modal"),{app_id:e,user_id:n,elm:i})},disable_app_submit:function(){return new Ajax.DBRequest("/api/uninstall_app",{parameters:{app_id:St.vars.app_id,keep_sandbox_files:!0,team_id:this.team_id,user_id:St.vars.user_id},subject_user:ke.get_viewer().work_user,onSuccess:function(e){return St.hide(),Zt.remove_closest_row(St.vars.elm),Pe.success(e.responseText)}})},remove_closest_row:function(e){var t,n,i;return t=l(e).closest(".team_admin_table_row"),n=l(t).closest(".team_admin_table"),1===n.find(".team_admin_table_row").length?(i=n.prev(".team_admin_table_title"),i.length||(i=l(".team_apps_table_panel")),i.remove(),n.remove()):t.remove()},submit_report_form:function(e){return l(e.target.elements.tzoffset).val(""+(new Date).getTimezoneOffset()),!0},show_recover_user_modal:function(e,t,n,i,o){var s;return s=new Xt({element_id:"recover-user-modal",focus:"cancel"}),s.user_name=e||n,s.email=n,s.user_id=t,s.team_id=this.team_id,s.refresh_cb=o,s.pre_removal_join_state=i,s.show(),!1}},Bt=Ye.BetaEnrollConfirmationModal=(function(e){function t(e,n){var i;this.feature_name=e,this.on_confirm_button_click=vt(this.on_confirm_button_click,this),i="admins-",n&&(i=""),t.__super__.constructor.call(this,{element_id:"beta-enroll-"+i+"confirmation-modal__"+this.feature_name}),this.enroll_team=i}return wt(t,e),t.prototype.on_confirm_button_click=function(e){var t;return t="#beta-enroll-%(enroll_team)sconfirmation-modal__%(feature_name)s form".format({enroll_team:this.enroll_team,feature_name:this.feature_name}),l("<input>").attr({type:"hidden",name:"feature_name",value:this.feature_name}).appendTo(t),this.$modal_window.addClass("ajax-loading")},t})(Ge),zt=Ye.BetaDisenrollConfirmationModal=(function(e){function t(e,n){this.feature_name=e,this.on_confirm_button_click=vt(this.on_confirm_button_click,this),t.__super__.constructor.call(this,{element_id:"beta-disenroll-confirmation-modal__"+this.feature_name})}return wt(t,e),t.prototype.on_confirm_button_click=function(e){var t;return t="#beta-disenroll-confirmation-modal__%(feature_name)s form".format({feature_name:this.feature_name}),l("<input>").attr({type:"hidden",name:"feature_name",value:this.feature_name}).appendTo(t),this.$modal_window.addClass("ajax-loading")},t})(Ge),Ht=Ye.BetaFeedbackModal=(function(e){function t(e){this.feature_name=e,this.success=vt(this.success,this),t.__super__.constructor.call(this,{element_id:"beta-feedback-modal"}),this.on_confirm_button_click=(function(e){return function(t){var n,i,o;return t.preventDefault(),n=l(t.target),i=n.closest("form"),o={feature_name:e.feature_name},kt.ajax_submit(i[0],!1,e.success,e.error,n[0],o)}})(this)}return wt(t,e),t.prototype.success=function(e){return Pe.success(ot("Thank you for your feedback.")),this.$modal_window.hide()},t.prototype.error=function(e){if(200!==e.status)return Pe.error(ot("Failed to submit feedback. Please try again."))},t})(Ge),Yt=Ye.DemoSignupModal=(function(e){function t(){return this.on_show=vt(this.on_show,this),this.on_confirm_button_click=vt(this.on_confirm_button_click,this),t.__super__.constructor.apply(this,arguments)}return wt(t,e),t.prototype.on_confirm_button_click=function(e){var t,n,i,o,s,r,a,u,_,c,d,h;return e.preventDefault(),d=$("demo-signup-form"),u=$("1210"),r=l(d).find("input[name='first_name']").val(),l(u).find("input[name='FirstName']").attr("value",r),a=l(d).find("input[name='last_name']").val(),l(u).find("input[name='LastName']").attr("value",a),s=l(d).find("input[name='email']").val(),l(u).find("input[name='Email']").attr("value",s),c=l(d).find("input[name='phone_number']").val(),l(u).find("input[name='Phone']").attr("value",c),t=l(d).find("input[name='company_name']").val(),l(u).find("input[name='Company']").attr("value",t),i=l(d).find("select[name='company_size']"),n=i.find("option:selected").val(),l(u).find("input[name='Company_size__c']").attr("value",n),o=$(this.$modal_window.find(".confirm-button")[0]),h=(function(e){return function(t){return e.$modal_window.hide(),u.submit()}})(this),_=kt.collect_form_vars(d,!0),kt.ajax_submit(d,!1,h,!1,o,_,!0)},t.prototype.on_show=function(e){return this.$modal_window.find(".db-modal-content").css({"overflow-y":""}),$t.init()},t})(Ge),Pt=Ye.AccountTransferBaseModal=(function(e){function t(e,n,i){this.file_action_selector=n,this.transfer_choice_selector=i,this._clearInput=vt(this._clearInput,this),this._markInputInvalid=vt(this._markInputInvalid,this),this._markInputValid=vt(this._markInputValid,this),this._tokenRemove=vt(this._tokenRemove,this),this._tokenAdd=vt(this._tokenAdd,this),this._selectChange=vt(this._selectChange,this),this._isTransferSelected=vt(this._isTransferSelected,this),this.checkAndApproveMemberRemoval=vt(this.checkAndApproveMemberRemoval,this),this.on_cancel_button_click=vt(this.on_cancel_button_click,this),this.execute_form=vt(this.execute_form,this),this.get_cancel_button=vt(this.get_cancel_button,this),this.get_confirm_button=vt(this.get_confirm_button,this),this.get_button_class=vt(this.get_button_class,this),this.set_modal_class=vt(this.set_modal_class,this),this.handleAjaxFailure=vt(this.handleAjaxFailure,this),this.on_show=vt(this.on_show,this),t.__super__.constructor.call(this,e,this.file_action_selector,this.transfer_choice_selector)}return wt(t,e),t.prototype.on_show=function(){if(0!==this.$modal_window.find("#manage-files-new-collab-input").length)return this.auto_completer=new Autocompleter.TeamTokenizer(ke.get_viewer().get_user_by_role("work"),"manage-files-new-collab-input","manage-files-new-whobulk","manage-files-hidden-input",{hide_import_contacts:!0,suggestions_disabled:!0,wrap_name:!0,single_token:!0,contact_filter:(function(e){return function(t){return t.excludeNonTeam().excludeNewStyleGroups().excludeByEmail(e.email)}})(this)}),this.tokenAdd=l.proxy(this._tokenAdd,this),this.tokenRemove=l.proxy(this._tokenRemove,this),this.$collab_input=this.$modal_window.find("#manage-files-new-collab-input")[0],this.$collab_input.on("token:add",this.tokenAdd),this.$collab_input.on("token:remove",this.tokenRemove),this.$textinput=this.$modal_window.find(".tokenized_autocompleter_container .textinput"),this.selectChange=l.proxy(this._selectChange,this),this.$modal_window.find(this.file_action_selector).on("change",this.selectChange)},t.prototype.handleAjaxFailure=function(e){if(200===e.status&&this._isTransferSelected())return this._markInputInvalid()},t.prototype.set_modal_class=function(e){var t,n,i,o,s,r;if(i="suspending deleting approve_transfer_to_suspended",o=this.get_form(),o.removeClass(i),null!=e&&o.addClass(e),null!=(s=l(".suspend_option_content"))&&s.removeClass("title_bubble no_suspend"),n=null!=this.limited&&this.limited,t=null!=this.invited&&this.invited,n||t)return l(".suspend_option_content").addClass("title_bubble no_suspend"),r="",r=ot(t?"Invited members can not be suspended":"Limited members can not be suspended"),l(".suspend_option_content").attr("data-title",r)},t.prototype.get_button_class=function(){var e;return e=this.get_form(),e.hasClass("suspending")?".confirm_deactivate_button":e.hasClass("deleting")?".confirm_delete_button":e.hasClass("approve_transfer_to_suspended")?".confirm_transfer_to_suspended_button":void 0},t.prototype.get_confirm_button=function(){var e;return e=this.get_button_class(),null!=e?$(this.$modal_window.find(e+" .confirm-button")):$(this.$modal_window.find(".confirm-button"))},t.prototype.get_cancel_button=function(){var e;return e=this.get_button_class(),null!=e?$(this.$modal_window.find(e+" .cancel-button")):$(this.$modal_window.find(".cancel-button"))},t.prototype.execute_form=function(e){var t,n;return null==e&&(e={}),n=this.get_form()[0],t=this.get_confirm_button(),kt.ajax_submit(n,!1,this.success_callback,this.handleAjaxFailure,t,e)},t.prototype.on_cancel_button_click=function(e){var n;return e.preventDefault(),n=this.get_form(),n.hasClass("approve_transfer_to_suspended")?(this.reset_button_click(this.$confirm_button,this.on_confirm_button_click),this.reset_button_click(this.$cancel_button,this.on_cancel_button_click)):t.__super__.on_cancel_button_click.apply(this,arguments)},t.prototype.reset_button_click=function(e,t){if(e.off("click"),null!=t)return e.on("click",t)},t.prototype.is_evh_message_exposed=function(){return this.$modal_window.find(".evh-message").length>0},t.prototype.checkAndApproveMemberRemoval=function(e,t){var n,i;return null==t&&(t={}),!l("#deactivate_option").is(":checked")&&l("#transfer_files_on").is(":checked")&&!this.invited&&(n=l(".tokenized_autocompleter_container .token-display-text"),i=l(".tokenized_autocompleter_container .token-suspended"),n.length&&i.length)?(this.set_modal_class("approve_transfer_to_suspended"),this.$modal_window.find(".target_user_name").text(n.text()),this.$confirm_button=this.get_confirm_button(),this.reset_button_click(this.$confirm_button,(function(e){return function(n){return e.execute_form(t)}})(this)),this.$cancel_button=this.get_cancel_button(),void this.$cancel_button.on("click",e)):this.execute_form(t)},t.prototype._isTransferSelected=function(){return l(this.transfer_choice_selector).prop("checked")},t.prototype._selectChange=function(e){return this._isTransferSelected()?this.$textinput.removeClass("unselected"):this.$textinput.addClass("unselected")},t.prototype._tokenAdd=function(e){return this.$collab_input.hide(),e.memo.valid?this._markInputValid():this._markInputInvalid()},t.prototype._tokenRemove=function(e){return this.$collab_input.show(),this._clearInput()},t.prototype._markInputValid=function(){return this._clearInput(),this.$textinput.addClass("valid")},t.prototype._markInputInvalid=function(){return this._clearInput(),this.$textinput.addClass("invalid")},t.prototype._clearInput=function(){return this.$textinput.removeClass("valid"),this.$textinput.removeClass("invalid")},t})(Ge),Qt=Ye.TwoFactorMessageModal=(function(e){function t(){t.__super__.constructor.call(this,{element_id:"team-security-message-modal",focus:"#team-security-message"})}return wt(t,e),t.prototype.on_confirm_button_click=function(e){return Zt.send_team_security_message(e),this.hide()},t})(Ge),Kt=Ye.DfeUnsuspendUserModal=(function(e){function t(e){this.on_confirm_button_click=vt(this.on_confirm_button_click,this),this.failure_callback=vt(this.failure_callback,this),this.success_callback=vt(this.success_callback,this),t.__super__.constructor.call(this,e)}return wt(t,e),t.prototype.before_show=function(){var e;return t.__super__.before_show.call(this),e=ot("Unsuspend %(user_name)s").format({user_name:this.user_name}),this.$modal_window.find(".db-modal-title-text").text(e),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.$modal_window.find("[name=email]").attr("value",this.email),this.$modal_window.find(".unsuspended_name").text(this.user_name),this.$modal_window.find(".unsuspended_email").text(this.email)},t.prototype.success_callback=function(e){var t;return null!=(t=__CIRCULAR_DEPENDENCY__.MembersReact)&&t.refresh_member_stats(),this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb("unsuspended"):void 0},t.prototype.failure_callback=function(e){return this.$modal_window.find(".cancel-button").attr("disabled",!1)},t.prototype.on_confirm_button_click=function(e){var t,n;return e.preventDefault(),n=this.$modal_window.find(".dfe-unsuspend-modal")[0],t=$(this.$modal_window.find(".confirm-button")[0]),this.$modal_window.find(".cancel-button").attr("disabled",!0),kt.ajax_submit(n,!1,this.success_callback,this.failure_callback,t)},t})(Ge),Wt=Ye.DfeRemoveOrDeactivateUserModal=(function(e){function t(e){this.on_confirm_button_click=vt(this.on_confirm_button_click,this),this.handleAjaxFailure=vt(this.handleAjaxFailure,this),this.success_callback=vt(this.success_callback,this),this.on_show=vt(this.on_show,this),this.handle_change_action=vt(this.handle_change_action,this),this.switch_to_removal_mode=vt(this.switch_to_removal_mode,this),this.switch_to_deactivation_mode=vt(this.switch_to_deactivation_mode,this),
this.show_removal_content=vt(this.show_removal_content,this),this.show_deactivation_content=vt(this.show_deactivation_content,this),t.__super__.constructor.call(this,e,"input[name=transfer_files]","#transfer_files_on")}return wt(t,e),t.prototype.get_form=function(){return this.$modal_window.find(".dfe-remove-or-deactivate-user-modal")},t.prototype.set_form_action_to_deactivate=function(){return l(".dfe-remove-or-deactivate-user-modal").attr("action","/account/team/suspend_user")},t.prototype.set_form_action_to_remove=function(){return l(".dfe-remove-or-deactivate-user-modal").attr("action","/account/team/remove_user")},t.prototype.show_deactivation_content=function(){return this.set_modal_class("suspending")},t.prototype.show_removal_content=function(){return this.set_modal_class("deleting")},t.prototype.switch_to_deactivation_mode=function(){return this.show_deactivation_content(),this.set_form_action_to_deactivate()},t.prototype.switch_to_removal_mode=function(){if(this.show_removal_content(),this.set_form_action_to_remove(),this.invited)return this.$modal_window.find(".remote_wipe_setting").remove()},t.prototype.handle_change_action=function(e){return e.preventDefault(),l("#deactivate_option").is(":checked")?this.switch_to_deactivation_mode():this.switch_to_removal_mode()},t.prototype.on_show=function(e){var n,i;if(t.__super__.on_show.call(this),l("input[name=deactivate_or_remove]").on("change",this.handle_change_action),this.$modal_window.find(".deleted_user_name").text(this.user_name),this.num_api_apps?(n=it("%(num)s API app","%(num)s API apps",this.num_api_apps).format({num:this.num_api_apps}),this.$modal_window.find(".num_api_apps").text(n)):this.$modal_window.find(".api_app_warning").hide(),i=ot("Suspend or delete %(user_name)s").format({user_name:this.user_name}),this.limited||this.invited?(l("#deactivate_option").prop("disabled",!0),l("#delete_option").attr("checked","checked"),this.switch_to_removal_mode()):(l("#deactivate_option").attr("checked","checked"),this.switch_to_deactivation_mode()),this.$modal_window.find(".db-modal-title-text").text(i),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.hide_transfer_wipe)return this.$modal_window.find(".transfer_data_on_remove_setting").remove(),this.$modal_window.find(".transfer_data_on_remove_setting_limited_by_evh").remove(),this.$modal_window.find(".remote_wipe_setting").remove()},t.prototype.success_callback=function(e){var t,n,i,o,s;return null!=__CIRCULAR_DEPENDENCY__.MembersReact&&__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats(),t="",i=null,o={user_id:this.user_id,team_id:this.team_id,user_name:this.user_name,email:this.email},s=null,l("#deactivate_option").is(":checked")?(t="suspended",n=ot("User suspended"),i=null,o=null):(t="deleted",n=ot("User deleted"),s=ot("Restore",{comment:"Undo message that enables restoring a recently deleted user"}),l("#transfer_files_on").is(":checked")||this.invited?(i=null,o=null):i=function(e){return Zt.show_recover_user_modal(e.user_name,e.user_id,e.email,Gt.ACTIVE,function(e){return Pe.success(ot("User %(msg)s".format({msg:e})))})}),this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb(t,n,o,i,s):void 0},t.prototype.handleAjaxFailure=function(e){return t.__super__.handleAjaxFailure.call(this,e),this.$modal_window.find(".cancel-button").attr("disabled",!1)},t.prototype.on_confirm_button_click=function(e){var t,n;return e.preventDefault(),this.$modal_window.find(".cancel-button").attr("disabled",!0),n=this.is_evh_message_exposed(),t={admin_seen_evh_message:n},this.checkAndApproveMemberRemoval(this.switch_to_removal_mode,t)},t})(Pt),Vt=Ye.DfeRemoveUserModal=(function(e){function t(e){this.on_confirm_button_click=vt(this.on_confirm_button_click,this),this.switch_to_removal_mode=vt(this.switch_to_removal_mode,this),this.handleAjaxFailure=vt(this.handleAjaxFailure,this),this.success_callback=vt(this.success_callback,this),this.on_show=vt(this.on_show,this),t.__super__.constructor.call(this,e,"input[name=transfer_files]","#transfer_files_on")}return wt(t,e),t.prototype.get_form=function(){return this.$modal_window.find(".dfe-remove-user-modal")},t.prototype.on_show=function(e){var n,i;if(t.__super__.on_show.call(this),this.$modal_window.find(".remove_user_name").text(this.user_name),i=this.invited?ot("Uninvite %(user_name)s").format({user_name:this.user_name}):ot("Delete %(user_name)s").format({user_name:this.user_name}),this.$modal_window.find(".db-modal-title-text").text(i),this.num_api_apps?(n=it("%(num)s API app","%(num)s API apps",this.num_api_apps).format({num:this.num_api_apps}),this.$modal_window.find(".num_api_app").text(n)):this.$modal_window.find(".api_app_warning").hide(),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.user_is_managed?this.$modal_window.find(".remove-content-limited-member").remove():(this.$modal_window.find(".remove_content").remove(),this.$modal_window.find(".remote_wipe_setting").remove()),this.invited&&(this.$modal_window.find(".transfer_files_option").remove(),this.$modal_window.find(".remote_wipe_setting").remove(),this.get_form().addClass("invited")),this.hide_transfer_setting&&this.$modal_window.find(".transfer_files_option").remove(),this.hide_remote_wipe_setting)return this.$modal_window.find(".remote_wipe_setting").remove()},t.prototype.success_callback=function(e){var t,n,i,o,s;return null!=__CIRCULAR_DEPENDENCY__.MembersReact&&__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats(),t="",i=null,o=null,s=null,this.invited?(t="uninvited",n=ot("User uninvited")):(t="deleted",n=ot("User deleted"),l("#transfer_files_on").is(":checked")||(s=ot("Restore",{comment:"Undo message that enables restoring a recently deleted user"}),o={user_id:this.user_id,team_id:this.team_id,user_name:this.user_name,email:this.email},i=function(e){return Zt.show_recover_user_modal(e.user_name,e.user_id,e.email,Gt.SUSPENDED,function(e){return Pe.success(ot("User %(msg)s".format({msg:e})))})})),Zt.decrement_used_licenses(),this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb(t,n,o,i,s):void 0},t.prototype.handleAjaxFailure=function(e){return t.__super__.handleAjaxFailure.call(this,e),this.$modal_window.find(".cancel-button").attr("disabled",!1)},t.prototype.switch_to_removal_mode=function(){return this.set_modal_class()},t.prototype.on_confirm_button_click=function(e){var t,n;return e.preventDefault(),this.$modal_window.find(".cancel-button").attr("disabled",!0),n=this.is_evh_message_exposed(),t={admin_seen_evh_message:n},this.checkAndApproveMemberRemoval(this.switch_to_removal_mode,t)},t})(Pt),Jt=Ye.ManageFilesModal=(function(e){function t(e,n,i){this.source_user_id=e,this.source_user_name=n,this.options=i,this.on_confirm_button_click=vt(this.on_confirm_button_click,this),this.switch_to_manage_files=vt(this.switch_to_manage_files,this),this.success_callback=vt(this.success_callback,this),t.__super__.constructor.call(this,this.options,"input[name=file_action]","#transfer_files_on")}return wt(t,e),t.prototype.get_form=function(){return this.$modal_window.find(".manage-files-modal")},t.prototype.on_show=function(){var e;return t.__super__.on_show.call(this),this.$modal_window.find("[name='source_user_id']").attr("value",this.source_user_id),this.$modal_window.find(".source-user-name").text(this.source_user_name),e=ot("Manage %(team_member)s's files").format({team_member:this.source_user_name}),this.$modal_window.find(".db-modal-title-text").text(e)},t.prototype.success_callback=function(e){var t;return t=JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():null!=__CIRCULAR_DEPENDENCY__.MemberActionsMenu&&__CIRCULAR_DEPENDENCY__.MemberActionsMenu.update_container_users(".buttons",t),l("#transfer_files_on").prop("checked")?Pe.success(ot("Transfer started",{comment:"This refers to the start of a file transfer from one Dropbox to another"})):Pe.success(ot("Permanently deleted files")),this.hide()},t.prototype.switch_to_manage_files=function(){return this.set_modal_class("manage-files-modal")},t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this.checkAndApproveMemberRemoval(this.switch_to_manage_files)},t})(Pt),Ye.show_manage_files_modal=function(e,t){var n;return n=new Jt(e,t,{element_id:"manage-files-modal",focus:".new-collab-input"}),n.show()},Xt=Ye.RecoverUserModal=(function(e){function t(e){this.on_cancel_button_click=vt(this.on_cancel_button_click,this),this.on_confirm_button_click=vt(this.on_confirm_button_click,this),this.failure_callback=vt(this.failure_callback,this),this.success_callback=vt(this.success_callback,this),t.__super__.constructor.call(this,e)}return wt(t,e),t.prototype.before_show=function(){var e;return t.__super__.before_show.call(this),e=ot("Restore %(user_name)s?").format({user_name:this.user_name}),this.$modal_window.find(".db-modal-title-text").text(e),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.$modal_window.find(".user_name").text(this.user_name),this.$modal_window.find(".user_email").text(this.email),this.pre_removal_join_state===Gt.SUSPENDED?(this.$modal_window.find(".recover_content_active_user").remove(),this.$modal_window.find(".recover_content_suspended_user").show()):(this.$modal_window.find(".recover_content_active_user").show(),this.$modal_window.find(".recover_content_suspended_user").remove())},t.prototype.success_callback=function(e){var t;return null!=(t=__CIRCULAR_DEPENDENCY__.MembersReact)&&t.refresh_member_stats(),this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb("restored"):void 0},t.prototype.failure_callback=function(e){return this.$modal_window.find(".cancel-button").attr("disabled",!1)},t.prototype.on_confirm_button_click=function(e){var t,n;return e.preventDefault(),this.$modal_window.find(".cancel-button").attr("disabled",!0),n=this.$modal_window.find(".recover-user-modal")[0],t=$(this.$modal_window.find(".confirm-button")[0]),kt.ajax_submit(n,!1,this.success_callback,this.failure_callback,t)},t.prototype.on_cancel_button_click=function(e){return e.preventDefault(),h.TeamsWebActionsLogger.log("admin_restore_user_attempt_cancelled",{restorable_user_id:this.user_id,team_id:this.team_id}),t.__super__.on_cancel_button_click.call(this,e)},t})(Ge),tn=function(){var e;return e=function(e,t){var n,i;return l(t).css("display","none"),n=l(t).closest("#user_generate_liveops_pin"),i=n.find(".user_generate_liveops_pin_value"),i.text(e.pin),l(t).addClass("liveops_pin_elem_invisible"),n.find(".user_generate_liveops_pin_text").removeClass("liveops_pin_elem_invisible")},Zt.get_pin_with_user_id(null,this,e),!1},l("#user_generate_liveops_pin_button").click(tn),en=function(){return l("#help_callus_title").hide(),l("#help_callus_details").show(),!1},l("#help_callus_trigger").click(en);var on;on=Ye.BrowseFile=Class.create({initialize:function(e){}}),on._CATEGORIES={IMAGE:"bmp cr2 gif ico jpeg jpg nef png psd tif tiff svg svgz",VIDEO:"3gp 3gpp 3gpp2 avi dv flv m2t m4v mkv mov mp4 mpeg mpg mts ts vob wmv",AUDIO:"aif flac m4a m4p mp3 ogg wav wma",DOCUMENT:"ai cdr csv doc docx docm eps fla indd keynote numbers otf pages pdf ppt pptx pptm pps ppsx ppsm ps rtf swf txt wpd xls xlsx xlsm",COMPRESSED_FILE:"7z bz2 gz gzip rar tar zip",CODE:"as as3 asm aspx bat c cc cmake coffee cpp cs css cxx diff erb erl groovy gry h haml hh hpp hxx java js json jsx less lst m make ml mm out patch php pl plist properties py rb sass scala scm script scss sh sml sql vb vi vim xml xsd xsl yaml yml",DISK_IMAGE:"dmg iso",EXECUTABLE:"exe",SHORTCUT:"lnk",LINK:"url webloc",FONT:"ttf"},on.EXTENSION_TO_CATEGORY={},on.CATEGORY_TO_TRANSLATION={FILE:ot("file"),FOLDER:ot("folder"),SHARED_FOLDER:ot("shared folder"),TEAM_SHARED_FOLDER:ot("team folder"),PUBLIC_FOLDER:ot("folder"),IMAGE:ot("image"),VIDEO:ot("video"),AUDIO:ot("audio"),DOCUMENT:ot("document"),COMPRESSED_FILE:ot("archive"),CODE:ot("code"),DISK_IMAGE:ot("disk image"),EXECUTABLE:ot("executable"),SHORTCUT:ot("shortcut"),LINK:ot("link"),FONT:ot("font"),SANDBOX:ot("app folder")},on.CATEGORY_TO_DELETED_TRANSLATION={FILE:ot("deleted file"),FOLDER:ot("deleted folder"),SHARED_FOLDER:ot("deleted shared folder"),TEAM_SHARED_FOLDER:ot("deleted team folder"),PUBLIC_FOLDER:ot("deleted folder"),IMAGE:ot("deleted image"),VIDEO:ot("deleted video"),AUDIO:ot("deleted audio"),DOCUMENT:ot("deleted document"),COMPRESSED_FILE:ot("deleted archive"),CODE:ot("deleted code"),DISK_IMAGE:ot("deleted disk image"),EXECUTABLE:ot("deleted executable"),SHORTCUT:ot("deleted shortcut"),LINK:ot("deleted link"),FONT:ot("deleted font"),SANDBOX:ot("deleted app folder")},(function(){var e,t,n,i,o;i=on._CATEGORIES,o=[];for(e in i)n=i[e],o.push((function(){var i,o,s,r;for(s=n.trim().split(" "),r=[],i=0,o=s.length;i<o;i++)t=s[i],r.push(on.EXTENSION_TO_CATEGORY[t]=e);return r})());return o})();var sn;sn=Ye.ProgressWatcher={job_info:{},INIT_POLL_INT:1e3,FAILS_MEAN_FAIL:3,MODAL_WAIT_MS:1e3,watch:function(e,t){var n,i,o;if(e.async_task_id){if(!e.async_task_id.match(/^[A-Za-z0-9_\-=]*$/))return;i=e.async_task_id}else i=e.job_id;return sn.job_info[i]={},n=sn.job_info[i],n.subject_user=e.subject_user||(null!=(o=e.parameters)?o._subject_uid:void 0),n.req=e,n.is_async_task=!!e.async_task_id,n.poll_int=sn.INIT_POLL_INT,n.poll_count=0,n.int_id=setInterval(sn.update_for(i),n.poll_int),n.failures=0,n.start_time=E.time(),n.dont_hide=t},update_for:function(e){return function(){return sn.update(e)}},backoff:function(e){var t;return t=sn.job_info[e],clearInterval(t.int_id),t.poll_int=Math.min(Math.floor(1.5*t.poll_int),3e4),t.int_id=setInterval(sn.update_for(e),t.poll_int)},update:function(e){var t,n;return n=sn.job_info[e],Xe.peek(e)?sn.done(e):(n.poll_count++,n.poll_count%10===0&&sn.backoff(e),!n.modaled&&E.time()-n.start_time>sn.MODAL_WAIT_MS&&(t=n.req.options,Ze.show(t.progress_text),t.onProgress=Ze.update,null!=t.on_modal_shown&&t.on_modal_shown(),n.modaled=!0),n.is_async_task?sn.get_async_task_status(e):sn.get_job_status(e))},get_job_status:function(e){return new Ajax.DBRequest("/job_status/"+e,{method:"post",subject_user:sn.job_info[e].subject_user,onSuccess:function(t){var n,i;if(n=sn.job_info[e],i=t.responseText,0===i.indexOf("err"))return sn.done(e),void(n.req.options.onFailure&&!Xe.handled(e)&&n.req.options.onFailure(t));if(0===i.indexOf("done"))return n.req.options.job=!1,Xe.peek(e)||new Ajax.Request("/job_results/"+e,{method:"post",parameters:{t:Me.read("__Host-js_csrf")},onSuccess:function(t){if(!Xe.handled(e))return lt.clearWorkingMessage(),n.req.options.onSuccess?n.req.options.onSuccess(t):void 0},onFailure:function(t){if(!Xe.handled(e))return lt.clearWorkingMessage(),n.req.options.onFailure?n.req.options.onFailure(t):void 0}}),sn.done(e);try{if(n.req.options.onProgress)return n.req.options.onProgress(t.responseText)}catch(e){}},onFailure:function(t){var n;if(n=sn.job_info[e],n.failures++,n.failures>=sn.FAILS_MEAN_FAIL)return n.req.options.onFailure&&n.req.options.onFailure(t,!0),lt.remove(n.req),sn.done(e)}})},get_async_task_status:function(e){return new Ajax.DBRequest("/async_task_status/"+e,{method:"post",subject_user:sn.job_info[e].subject_user,onSuccess:function(t){var n,i;if(n=sn.job_info[e],i=t.responseText,0===i.indexOf("done:")||0===i.indexOf("err:"))return Xe.handled(e),lt.clearWorkingMessage(),0===i.indexOf("done:")&&(t.responseText=i.substr(5)),n.req.options.onSuccess&&n.req.options.onSuccess(t),n.req.options.onComplete&&n.req.options.onComplete(t),sn.done(e);if(0===i.indexOf("async_task_err:"))return Pe.error(new Fe(i.substr(15))),Xe.handled(e),lt.clearWorkingMessage(),sn.done(e);try{if(n.req.options.onProgress)return n.req.options.onProgress(t.responseText)}catch(e){}},onFailure:function(t){var n;if(n=sn.job_info[e],n.failures++,n.failures>=sn.FAILS_MEAN_FAIL){try{n.req.options.onFailure&&n.req.options.onFailure(t,!0)}catch(e){}return lt.remove(n.req),sn.done(e)}}})},done:function(e){var t;return t=sn.job_info[e],clearInterval(t.int_id),t.dont_hide?Ze.update("1/1"):(delete sn.job_info[e],t.req.async_task_id&&t.req.async_task_id!==e?void 0:Ze.hide(e))}};var rn;rn=Ye.DateUtil={fromSecondsSinceEpochUTC:function(e){var t;return t=new Date(1970,0,1),t.setSeconds(e),t},applyTimezoneOffset:function(e,t){var n,i;return n=parseInt(t,10),i=60*(t-n),e.setHours(e.getHours()+n),e.setMinutes(e.getMinutes()+i)},contextualFormat:function(e){var t,n,i,o;return n=new Date(Date.now()),i=(n.getTime()-e.getTime())/1e3,0,i<28800?E.ago(e):(this.applyTimezoneOffset(n,Re.TIMEZONE_OFFSET),this.applyTimezoneOffset(e,Re.TIMEZONE_OFFSET),o=new Date(Date.now()),this.applyTimezoneOffset(o,Re.TIMEZONE_OFFSET),o.setDate(o.getDate()-1),e.getYear()===n.getYear()&&e.getMonth()===n.getMonth()&&e.getDate()===n.getDate()?(t=ot("Today %(time)s"),t.format({time:rn.format(e,Re.TIME_FORMAT)})):e.getYear()===o.getYear()&&e.getMonth()===o.getMonth()&&e.getDate()===o.getDate()?(t=ot("Yesterday %(time)s"),t.format({time:rn.format(e,Re.TIME_FORMAT)})):rn.format(e,Re.DATETIME_FORMAT))},toUTCDate:function(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())},differenceStr:function(e,t){var n,i,o,s,r,a,l;return r=(e.getTime()-t.getTime())/1e3,r<60?it("%d sec","%d secs",r).format(r):r<3600?(o=parseInt(r/60,10),it("%d min","%d mins",o).format(o)):r<86400?(i=parseInt(r/3600,10),it("%d hour","%d hours",i).format(i)):r<2592e3?(n=parseInt(r/86400,10),it("%d day","%d days",n).format(n)):r<4838400?(a=parseInt(r/604800,10),it("%d week","%d weeks",a).format(a)):r<31536e3?(s=parseInt(r/2592e3,10),it("%d month","%d months",s).format(s)):(l=parseInt(r/31536e3,10),it("%d year","%d years",l).format(l))},localize:function(e){return assert(null!=Re.DATE_FORMAT,"Date format missing."),rn.format(e,Re.DATE_FORMAT)},format:function(e,t){var n;return assert("string"==typeof t,"Date format requires a format string"),n={yy:(function(t){return function(){return e.getFullYear().toString().substring(2)}})(this),yyyy:(function(t){return function(){return e.getFullYear().toString()}})(this),M:(function(t){return function(){return(e.getMonth()+1).toString()}})(this),MM:(function(t){return function(){return(e.getMonth()+1).toString().lpad(2)}})(this),d:(function(t){return function(){return e.getDate().toString()}})(this),dd:(function(t){return function(){return e.getDate().toString().lpad(2)}})(this),h:(function(t){return function(){return(e.getHours()%12||12).toString()}})(this),H:(function(t){return function(){return e.getHours().toString()}})(this),HH:(function(t){return function(){return e.getHours().toString().lpad(2)}})(this),m:(function(t){return function(){return e.getMinutes().toString()}})(this),mm:(function(t){return function(){return e.getMinutes().toString().lpad(2)}})(this),a:(function(t){return function(){return e.getHours()>11?ot("PM",{comment:"PM as in evening"}):ot("AM",{comment:"AM as in morning"})}})(this)},t.replace(/([a-zA-Z]+)/g,function(e){return null!=n[e]?n[e]():e})}};var an;Ye.CreateApp={init:function(e,t){var n,i,o;return this.accepted_tos_by_uid=e,this.form=n=l("#create-app-form"),this.email_verification=null,ke.get_viewer().is_paired||(o=ke.get_viewer().get_users()[0],this.select_user(o.id)),i=(function(e){return function(e){var t;return t=e.target.name,n.find("input[name="+t+"]").each(function(){return l(this).parents("label").removeClass("active"),n.removeClass(l(this).data("next"))})}})(this),n.find("input[type=radio]").change(function(e){return i(e),l(e.target).parents("label").addClass("active"),n.addClass(l(this).data("next"))}),n.find("input[type=checkbox]").change(function(e){var t;l(this).filter("#accept-tos").length||(l(e.target).parents("label").toggleClass("active"),t=n.find("input[name="+l(this).attr("name")+"]:checked"),n.toggleClass(l(this).data("next"),0!==t.length))}),n.find(".role-choice input").change((function(e){return function(t){var o,s;return o=n.find(".role-choice input:checked"),s=o.val(),ke.get_viewer().is_uid_signed_in(s)?e.select_user(s):(o.prop("checked",!1),i(t),W.show_modal({user_id:s,on_success:function(){return o.prop("checked",!0).trigger("change")}}),!1)}})(this)),n.find("input:checked").trigger("change"),n.find("input[name=tos_accept]").change((function(e){return function(t){return e.update_submit_enabled()}})(this)),n.find("#send-verify-email, #resend-verify-email").click((function(e){return function(i){return e.email_verification.send_email(t,function(){return n.addClass("verify-email-sent"),e.email_verification.flash_email_sent_notification(),e.email_verification.ensure_polling(function(){if(e.email_verification.user.is_email_verified)return n.addClass("email-verified"),n.removeClass("verifiy-email-sent"),n.removeClass("email-unverified"),e.update_submit_enabled()})}),!1}})(this)),n.submit(function(e){return n=l(e.target),kt.ajax_submit(n[0],!1,function(e){return window.location.href=e.responseText}),!1})},select_user:function(e){return this.email_verification=We.get_for_user(ke.get_viewer().get_user_by_id(e)),this.form.find("#accept-tos-wrapper").toggle(!this.accepted_tos_by_uid[e]),this.form.find("input[name=tos_accept]").prop("checked",!1),this.form.removeClass("verify-email-sent"),this.form.find("#verify-email-wrapper").toggle(!this.email_verification.user.is_email_verified),this.form.toggleClass("email-verified",this.email_verification.user.is_email_verified),this.update_submit_enabled()},update_submit_enabled:function(){var e,t;return t=this.email_verification.user,e=this.accepted_tos_by_uid[t.id]||this.form.find("input[name=tos_accept]").prop("checked"),this.form.find("#create-button").prop("disabled",!e)}},an=INLINE_JS.Apps=Ye.Apps={init_apps:function(){return l("#show-disabled-apps").click(function(){return l(this).parent().hide(),l("#disabled-apps").show(),!1})},init_app_info:function(e,t,n){return this.user_email=n,l("#app-info .icon-container").each(function(e,t){var n;return n=l(t),n.append(Dropbox.createChooseButton({success:function(e){return n.find(".icon").attr("src",e[0].thumbnailLink),n.find("input[type=hidden]").val(e[0].link)},linkType:"direct",extensions:["images"]}))}),this._hoverable_tmpl=Fe.tmpl("hoverable_tmpl"),l(".modal-okay-triggers-refresh").on("click",function(e){location.reload()}),l("#unlink-users-button").on("click",function(t){an.unlink_all_users_in_dev(e)}),l("#enable-additional-users-button").on("click",function(t){an.enable_users_in_dev(e)}),l("#increase-max-users-button").on("click",function(t){an.enable_users_in_dev(e)}),l("#unlink-teams-button").on("click",function(t){an.unlink_all_teams_in_dev(e)}),l("#enable-additional-teams-button").on("click",function(t){an.enable_teams_in_dev(e)}),this._webhook_info_row_tmpl=Fe.tmpl("webhook_info_row_tmpl"),l("#domain-list").on("click",".img-container",function(t){an.remove_domain(t.currentTarget.parentNode,e)}),l("#oauth-uri-list").on("click",".img-container",function(t){an.remove_oauth_uri(t.currentTarget.parentNode,e)}),l("#webhook-list").on("click",".img-container",function(t){an.remove_webhook(t.currentTarget.parentNode,e)}),l("#webhook-list").on("click",".webhook-actions.enabled .webhook_disable",function(t){an.update_webhook_url(t.currentTarget,e,!1)}),l("#webhook-list").on("click",".webhook-actions.disabled .webhook_enable",function(t){an.update_webhook_url(t.currentTarget,e,!0)}),l("#delete-app-button").on("click",function(n){an.confirm_disable(t,e,0)}),l("#showcase-url-form").on("submit",function(e){e.preventDefault(),an.submit_showcase_url(this)}),l("#webhook_url").on("click change paste focus",function(e){l("#webhook-form").removeClass("error")}),this.init_app_info_add_redirect_uri(),l("#oauth2-allow-implicit-grant").on("change",function(t){return an.set_oauth2_allow_implicit_grant(t.currentTarget,e)})},init_app_info_add_redirect_uri:function(){var e,t,n,i;t=/^\#?add_redirect_uri=(.*)$/.exec(window.location.hash||""),t&&(i=window.decodeURIComponent(t[1]),e=l("#oauth-add-uri-form"),l("input[name=oauth_uri]",e).val(i),n=l("#add-redirect-uri-modal")[0],l("#add-redirect-uri-modal-uri").text(i),St.show(ot("Add OAuth redirect URI"),n,{doit:function(){var e;return window.history&&window.history.replaceState?(e=window.location.href,e=e.substring(0,e.indexOf("#")),window.history.replaceState({},document.title,e)):window.location.hash="",St.hide(),an.submit_new_oauth_uri(l("#oauth-add-uri-form")[0])}}))},init_app_datastores_browse:function(e){if(this.ds_info=e,ke.get_viewer().is_paired)return this.role_picker=Le.get_controller(l("#role-selector")),this.role_picker.on_state_change=this.app_datastores_browse_render.bind(this),W.set_during_login_callback((function(e){return function(t,n){return e.app_datastores_browse_reload_info(function(){return n()},function(){return n("Error displaying datastores"),window.location.reload()})}})(this))},app_datastores_browse_reload_info:function(e,t){return l.ajax({url:"/developers/apps/datastores/info",success:(function(t){return function(n){return t.ds_info=n,t.app_datastores_browse_render(),"function"==typeof e?e():void 0}})(this),error:(function(e){return function(e){return"function"==typeof t?t(e):void 0}})(this)}),!1},app_datastores_browse_render:function(){return this.app_datastores_browse_render_id("#apps_developed_container"),this.app_datastores_browse_render_id("#apps_used_container"),this.app_datastores_browse_render_empty()},app_datastores_browse_render_empty:function(){var e,t,n,i;if(t=l("#no_apps_container").empty(),0===l("#apps_developed_container").children().length&&0===l("#apps_used_container").children().length)switch(e=l("<div class='empty-state'></div>").appendTo(t),null!=(n=this.role_picker)?n.get_state():void 0){case Qe.PERSONAL:case Qe.WORK:return i=ke.get_viewer().get_user_by_role(this.role_picker.get_state()),e.append("You don't have any datastores in your "+ke.get_role_title(i)+" Dropbox.");default:return e.append("You don't have any datastores in your Dropbox.")}},app_datastores_browse_render_id:function(e){var t,n,i,o,s,r,a;for(o=this.app_datastores_browse_get_id_info(e),n=l(e),n.empty(),t="",s=0,r=o.length;s<r;s++)i=o[s],this.app_datastores_should_render(i.uid)&&(t+=i.html);if(t)return n.append(this.app_datastores_browse_get_id_header(e)),a=l("<div class='app-list clearfix'/>").appendTo(n),a.html(t)},app_datastores_should_render:function(e){var t;return null==this.role_picker||(t=ke.get_viewer().get_user_by_id(e),this.role_picker.is_role_visible(t.role))},app_datastores_browse_get_id_info:function(e){switch(e){case"#apps_developed_container":return this.ds_info.apps_developed;case"#apps_used_container":return this.ds_info.apps_used;default:return assert(!1,"invalid ds group id")}},app_datastores_browse_get_id_header:function(e){switch(e){case"#apps_developed_container":return l("<h2>Apps you develop</h2>");case"#apps_used_container":return l("<h2>Apps you use</h2>");default:return assert(!1,"invalid ds group id")}},confirm_disable:function(e,t,n){var i,o;return i=ot(n?"Are you sure you want to disable '%(app_name)s'?":"Are you sure you want to delete '%(app_name)s'?"),at.fillVal(i.format({app_name:e.escapeHTML()}),"app-disable-text"),St.show(ot(n?"Confirm disable":"Confirm delete"),$("app-disable-modal")),o="/developers/disable_app/"+t,$("app-disable-modal").down("form").action=o,$("disable-app-button").setValue(ot(n?"Disable":"Delete"))},enable_app:function(e){var t;return t="/developers/enable_app/"+e,l("#status-button-form").attr("action",t).submit()},show_uninstall:function(e,t,n,i,o,s){var r;if(e&&Event.stop(e),St.vars={app_id:n,user_id:s},r=l("#delete-"+i+"-app-confirm"),"sandbox"===i){if(!o)return void an.do_uninstall();l(".app_folder",r).text(o)}return l(".app_name",r).text(t),St.show(ot("Remove %(app_name)s?").format({app_name:N.em_snippet(t,22)}),r[0],St.vars),null},do_uninstall:function(){var e;return e=St.vars.user_id,new Ajax.DBRequest("/api/uninstall_app",{parameters:{app_id:St.vars.app_id,keep_sandbox_files:$F("keep_sandbox_files")},onSuccess:function(t){var n;if(Pe.success(t.responseText),n=l(".apps-"+e),l("#inst-app-"+St.vars.app_id+"-row",n).hide().removeClass("active_app"),0===l(".active_app",n).length&&n.hide(),0===l(".active_app").length)return l("#empty-explanation").text(ot("You have no apps linked to your Dropbox.")),l("#applications-explanation",n).remove()},subject_user:e}),St.hide()},enable_users_in_dev:function(e,t){return new Ajax.DBRequest("/developers/enable_users_in_dev/"+e,{onSuccess:function(e){var t;return"ok"===e.responseText?St.show(ot("User limit increased"),$("increased-dev-user-limit-modal")):(t=JSON.parse(e.responseText),St.show(ot("Limit raised to %(user_limit)s users").format({user_limit:t.new_limit}),$("increased-dev-user-limit-modal")))}}),!1},unlink_all_users_in_dev:function(e){return St.show(ot("Unlink all users"),$("confirm-unlink-all-users"),{doit:function(){return new Ajax.DBRequest("/developers/unlink_all_users/"+e,{onSuccess:function(e){return St.hide(),location.reload()}})}}),!1},enable_teams_in_dev:function(e){return d.WebRequest({url:"/developers/enable_teams_in_dev/"+e,success:function(e){var t;return t=JSON.parse(e),St.show(ot("Limit raised to %(team_limit)s teams").format({team_limit:t.new_limit}),$("increased-dev-team-limit-modal"))}}),!1},unlink_all_teams_in_dev:function(e){return St.show(ot("Unlink all teams"),$("confirm-unlink-all-teams"),{doit:function(){return d.WebRequest({url:"/developers/unlink_all_teams/"+e,success:function(e){return St.hide(),location.reload()}})}}),!1},submit_app_info:function(e){var t;return t=l(e).find("input[name=name]").val(),kt.clear_errors(e),kt.ajax_submit(e,!1,function(){return Pe.success("App info updated."),t&&l("#app-info h1").text(t),location.reload()})},submit_folder_name:function(e){var t;return t=l(e).find("input[name=folder]").val(),kt.clear_errors(e),kt.ajax_submit(e,!1,function(){return Pe.success("App folder name updated."),l("#folder-name .text").text(t),an.hide_folder_input()})},submit_showcase_url:function(e){return kt.clear_errors(e),kt.ajax_submit(e,!1,function(){return Pe.success("Showcase URL updated.")})},submit_new_webhook:function(e){var t,n,i,o,s,r,a,u,_,c,h,m;return n=l(e),s=l("#webhook-list"),o=l("<img>").attr({src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",alt:ot("Loading")}).css("vertical-align","middle"),i=n.find("input[name=webhook_url]"),h=function(e,t){return t&&t.remove(),0===s.find(".hoverable-url").length&&s.addClass("hide-status"),l("#webhook-form-error").text(e),l("#webhook-form").addClass("error")},a=i.val(),""===a?void h("Empty URI"):(u=ze.parse(a),"http"!==(_=u.scheme)&&"https"!==_?void h("URI scheme must be http or https"):u.authority?"localhost"===(c=u.authority)||"127.0.0.1"===c||0===u.authority.indexOf("[::1]")?void h("Webhooks doesn't support localhost as Dropbox can't contact your local server. Please use an internet accessible URI."):s.find("tbody").length>=Se.MAX_WEBHOOKS_PER_APP?void h("You can register a maximum of %d webhook URIs per app.".format(Se.MAX_WEBHOOKS_PER_APP)):(t=l(this._webhook_info_row_tmpl({url:a,status:"Verifying"}).toHTML()),t.find(".status").append(o),t.find(".webhook-actions").removeClass("disabled").addClass("enabled"),s.append(t),s.removeClass("hide-status"),l("#webhook-form").removeClass("error"),r=kt.collect_form_vars(e),i.val(""),m=(new Date).getTime(),d.WebRequest({url:"/developers/apps/update/add_webhook",dataType:"json",data:r,success:function(e){var n,o;return"invalid"===e.status?(h(e.failure_text,t),i.val(a)):(o=(new Date).getTime()-m,n=Math.max(0,1e3-o),setTimeout(function(){return"ok"===e.status?t.find(".status").text("Enabled"):"error"===e.status?(t.find("textarea").text(e.failure_text),t.find(".status").text(e.status_text).addClass("error"),t.find(".timestamp").text("Just now"),t.find(".webhook-failure-info").css("display","")):void 0
},n))},error:function(){return t.remove(),i.val(a)}})):void h("Improperly formatted URI (typo maybe?)"))},remove_webhook:function(e,t){var n,i;return l("#webhook-form").removeClass("error"),i=l(e).find(".value").text(),n=l("<img>").attr({src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",alt:ot("Loading")}).css("vertical-align","middle"),l(e).find(".status").text("Removing").removeClass("error").append(n),d.WebRequest({url:"/developers/apps/update/remove_webhook",data:{app_id:t,webhook_url:i},dataType:"json",success:function(t){var n,o;if(n=e.parentNode,o=n.parentNode,o.removeChild(n),0===o.getElementsByClassName("hoverable-url").length&&l(o).addClass("hide-status"),!l("#webhook_url").val())return l("#webhook_url").val(i)},error:function(){return Pe.error("Unable to complete your request.")}})},update_webhook_url:function(e,t,n){var i,o,s,r,a;return a=l(e.parentNode.parentNode).find(".value").text(),l("#webhook-form").removeClass("error"),s=e.parentNode.parentNode.parentNode,i=l("<img>").attr({src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",alt:ot("Loading")}).css("vertical-align","middle"),o=l(s).find(".status").text(),n="Disabled"===o,r=n?"Enabling":"Disabling",l(s).find(".status").text(r).removeClass("error").append(i),d.WebRequest({url:"/developers/apps/update/update_webhook_url",data:{app_id:t,webhook_url:a,enable:n},dataType:"json",success:function(e){var t;return o=l(s).find(".status").text(),t="Disabling"===o?"Disabled":"Enabled",l(s).find(".status").text(t).removeClass("error").removeClass("img"),"Disabling"===o?l(s).find(".webhook-actions").removeClass("enabled").addClass("disabled"):l(s).find(".webhook-actions").removeClass("disabled").addClass("enabled")},error:function(e){return Pe.error("Unable to complete your request.")}})},set_oauth2_allow_implicit_grant:function(e,t){return d.WebRequest({url:"/developers/apps/update/oauth2_allow_implicit_grant",data:{app_id:t,allow:l(e).val()},dataType:"json",success:function(e){return Pe.success("OAuth 2 allow implicit grant updated.")},error:function(){return Pe.error("Error updating OAuth 2 allow implicit grant.")}})},submit_new_oauth_uri:function(e){var t;return t=l(e).find("input[name=oauth_uri]").val(),kt.clear_errors(e),kt.ajax_submit(e,!1,function(){return Pe.success("OAuth URI added."),an.add_oauth_uri(t),l(e).find("input[name=oauth_uri]").val("")})},add_oauth_uri:function(e){var t;return t=l("#oauth-uri-list"),t.append(this._hoverable_tmpl({value:e}).toHTML()),t.show()},remove_oauth_uri:function(e,t){var n,i;return i=l(e).find(".value").text(),n=function(t){var n;if(Pe.success("OAuth URI removed."),n=e.parentNode,n.removeChild(e),0===n.getElementsByTagName("div").length)return n.hide()},d.WebRequest({url:"/developers/apps/update/remove_oauth_uri",data:{app_id:t,oauth_uri:i},dataType:"json",success:n,error:function(){return Pe.error("Unable to complete your request.")}})},submit_new_domain:function(e){var t;return t=l(e).find("input[name=domain_name]").val(),kt.clear_errors(e),kt.ajax_submit(e,!1,function(){return Pe.success("Domain added."),an.add_domain(t),l(e).find("input[name=domain_name]").val("")})},add_domain:function(e){var t;return t=l("#domain-list"),t.append(this._hoverable_tmpl({value:e}).toHTML()),t.show()},remove_domain:function(e,t){var n,i;return i=l(e).find(".value").text(),n=function(t){var n;if(Pe.success("Domain removed."),n=e.parentNode,n.removeChild(e),0===n.getElementsByTagName("div").length)return n.hide()},d.WebRequest({url:"/developers/apps/update/remove_domain",data:{app_id:t,domain_name:i},dataType:"json",success:n,error:function(){return Pe.error("Unable to complete your request.")}})},show_need_users_modal:function(e){return St.show(ot("Please test this app",{comment:"Error message"}),$("app-need-users-modal")),!1},show_need_teams_modal:function(e){return St.show(ot("Please test this app",{comment:"Error message"}),$("app-need-teams-modal"))},show_name_branding_modal:function(e){return St.show(ot("Please rename this app",{comment:"Error message"}),$("app-name-branding-modal")),!1},show_need_icon_modal:function(e){return St.show(ot("Please add an icon for this app",{comment:"Error message"}),$("app-need-icon-modal")),!1},show_need_enable_users_modal:function(e){return St.show(ot("Please enable more users for this app",{comment:"Error message"}),$("app-need-enable-users-modal")),!1},show_submit_prod_status_modal:function(e){return St.show(ot("Confirm your application submission",{comment:"Error message"}),$("submit-prod-status-modal")),!1},check_for_nongenerated_oauth_tokens:function(e){var t;return t="/developers/prod_request/"+e,new Ajax.DBRequest("/developers/has_nongenerated_oauth_tokens/"+e,{onSuccess:function(e){return"true"===e.responseText?Oe.redirect(t):St.show(ot("Please auth at least one user with the OAuth flow",{comment:"Error message"}),$("app-need-nongenerated-token"))},onFailure:function(e){return Oe.redirect(t)}}),!1},hide_folder_input:function(){return l("#folder-name").show(),l("#folder-input").hide()},show_folder_input:function(){return l("#folder-name").hide(),l("#folder-input").show(),l("#folder-input input[name=folder]").focus()}};var ln;INLINE_JS.twitter_auth_complete=function(){return ln.onLoginSuccessCallback?ln.onLoginSuccessCallback():window.location.reload(),!1},ln=Ye.Twitter={do_auth_and_follow_dropbox:function(e){var t,n;return assert(null!=e,"user_id must be provided"),n=ze({path:"/twitter/request_token_v2"}).updateQuery("_subject_uid",e).toString(),window.open(n,"twitter_auth","width=800,height=400"),t=function(){return Ot._completed($("twitter_follow"))},ln.onLoginSuccessCallback=t}};var un;return un=Ye.ShmodelLogger={CLICK_SIGN_IN:"click_sign_in",CLICK_ADD_TO_MY_DROPBOX:"click_add_to_my_dropbox",REMOVE_LINK:"remove_link",CLICK_FILENAME:"click_filename",CLICK_DOWNLOAD:"click_download",LOGIN_THRU_DEFAULT_DROPDOWN:"login_thru_default_dropdown",CLICK_SIGNUP_THRU_DEFAULT_DROPDOWN:"click_signup_thru_default_dropdown",CLICK_SHARE:"click_share",log:function(e){return new Ajax.DBRequest("/shmlog",{method:"post",noAutonotify:!0,parameters:{evt:e,url:window.location.href}})},attachLogListener:function(e,t){if(null!=t)return t.observe("click",function(n){if(un.log(e),t.href&&"#"!==t.href&&"_blank"!==t.target)return Event.stop(n),function(){return window.location.href=t.href}.defer()})}},Ye});
//# sourceMappingURL=dropbox.min.js-vflXQfC7A.map